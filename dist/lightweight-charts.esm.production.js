/*!
 * @license
 * TradingView Lightweight Charts v3.8.0-dev+202211041912
 * Copyright (c) 2020 TradingView, Inc.
 * Licensed under Apache License 2.0 https://www.apache.org/licenses/LICENSE-2.0
 */
import{bindToDevicePixelRatio as t}from"fancy-canvas/coordinate-space";var i,n,s,h=function(){function t(t,i){this.x=t,this.y=i}return t.prototype.add=function(i){return new t(this.x+i.x,this.y+i.y)},t.prototype.addScaled=function(i,n){return new t(this.x+n*i.x,this.y+n*i.y)},t.prototype.subtract=function(i){return new t(this.x-i.x,this.y-i.y)},t.prototype.dotProduct=function(t){return this.x*t.x+this.y*t.y},t.prototype.crossProduct=function(t){return this.x*t.y-this.y*t.x},t.prototype.signedAngle=function(t){return Math.atan2(this.crossProduct(t),this.dotProduct(t))},t.prototype.angle=function(t){return Math.acos(this.dotProduct(t)/(this.length()*t.length()))},t.prototype.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y)},t.prototype.scaled=function(i){return new t(this.x*i,this.y*i)},t.prototype.normalized=function(){return this.scaled(1/this.length())},t.prototype.transposed=function(){return new t(-this.y,this.x)},t.prototype.clone=function(){return new t(this.x,this.y)},t}(),r=function(t,i){this.t=new h(Math.min(t.x,i.x),Math.min(t.y,i.y)),this.i=new h(Math.max(t.x,i.x),Math.max(t.y,i.y))},e=function(t,i){this.u=t,this.o=i};function u(t,i){return t.x===i.x&&t.y===i.y}function o(t,i){if(u(t,i))throw new Error("Points should be distinct");return function(t,i,n){return{l:t,v:i,_:n}}(t.y-i.y,i.x-t.x,t.x*i.y-i.x*t.y)}function l(t,i){if(u(t,i))throw new Error("Points of a segment should be distinct");return[t,i]}function a(t,i){var n=i.u;return n.l*t.x+n.v*t.y+n._>0===i.o}function f(t,i){for(var n=0;n<t.length;n++)if(u(t[n],i))return!1;return t.push(i),!0}function c(t,i,n){var s=v(t,i,n.t,new h(n.i.x,n.t.y)),r=v(t,i,new h(n.i.x,n.t.y),n.i),e=v(t,i,n.i,new h(n.t.x,n.i.y)),u=v(t,i,new h(n.t.x,n.i.y),n.t),o=[];if(null!==s&&s>=0&&o.push(s),null!==r&&r>=0&&o.push(r),null!==e&&e>=0&&o.push(e),null!==u&&u>=0&&o.push(u),0===o.length)return null;o.sort((function(t,i){return t-i}));var l=w(t,n)?o[0]:o[o.length-1];return t.addScaled(i.subtract(t),l)}function v(t,i,n,s){var h=function(t,i,n,s){var h=i.subtract(t),r=s.subtract(n),e=h.x*r.y-h.y*r.x;if(Math.abs(e)<1e-6)return null;var u=t.subtract(n);return(u.y*r.x-u.x*r.y)/e}(t,i,n,s);if(null===h)return null;var r=_(n,s,i.subtract(t).scaled(h).add(t));return Math.abs(r.M)<1e-6?h:null}function d(t,i,n){var s=i.subtract(t),h=n.subtract(t).dotProduct(s)/s.dotProduct(s);return{m:h,M:t.addScaled(s,h).subtract(n).length()}}function _(t,i,n){var s=d(t,i,n);if(0<=s.m&&s.m<=1)return s;var h=t.subtract(n).length(),r=i.subtract(n).length();return h<r?{m:0,M:h}:{m:1,M:r}}function w(t,i){return t.x>=i.t.x&&t.x<=i.i.x&&t.y>=i.t.y&&t.y<=i.i.y}function M(t,i){for(var n=t.x,s=t.y,h=!1,r=i.length-1,e=0;e<i.length;e++){var u=i[e],o=i[r];r=e,(u.y<s&&o.y>=s||o.y<s&&u.y>=s)&&u.x+(s-u.y)/(o.y-u.y)*(o.x-u.x)<n&&(h=!h)}return h}function b(t,i){var n=t.l*i.v-i.l*t.v;if(Math.abs(n)<1e-6)return null;var s=(t.v*i._-i.v*t._)/n,r=(i.l*t._-t.l*i._)/n;return new h(s,r)}function m(t,i){return!(t.length<=0||!u(t[t.length-1],i)||!u(t[0],i))||(t.push(i),!1)}function p(t){return[[t.lineWidth,2*t.lineWidth],[5*t.lineWidth,6*t.lineWidth],[6*t.lineWidth,6*t.lineWidth],[t.lineWidth,4*t.lineWidth],[2*t.lineWidth,t.lineWidth]][t.lineStyle-1]||[]}function g(t,i){t.lineStyle=i,y(t,p(t))}function y(t,i){t.setLineDash?t.setLineDash(i):void 0!==t.mozDash?t.mozDash=i:void 0!==t.webkitLineDash&&(t.webkitLineDash=i)}function k(t,i,n,s){t.beginPath();var h=t.lineWidth%2?.5:0;t.moveTo(n,i+h),t.lineTo(s,i+h),t.stroke()}function x(t,i,n,s){t.beginPath();var h=t.lineWidth%2?.5:0;t.moveTo(i+h,n),t.lineTo(i+h,s),t.stroke()}function C(t,i,n,s,h){isFinite(i)&&isFinite(n)&&isFinite(s)&&isFinite(h)&&(0!==t.lineStyle?function(t,i,n,s,h){t.save(),t.beginPath(),y(t,p(t)),t.moveTo(i,n),t.lineTo(s,h),t.stroke(),t.restore()}(t,i,n,s,h):function(t,i,n,s,h){t.beginPath(),t.moveTo(i,n),t.lineTo(s,h),t.stroke()}(t,i,n,s,h))}function N(t,i,n,s,e,a){if(u(t,i))return null;var v=new h(0,0),d=new h(n,s);if(e){if(a){var _=function(t,i){if(0===t.l){var n=-t._/t.v;return i.t.y<=n&&n<=i.i.y?l(new h(i.t.x,n),new h(i.i.x,n)):null}if(0===t.v){var s=-t._/t.l;return i.t.x<=s&&s<=i.i.x?l(new h(s,i.t.y),new h(s,i.i.y)):null}var r=[],e=function(n){var s=-(t._+t.l*n)/t.v;i.t.y<=s&&s<=i.i.y&&f(r,new h(n,s))},o=function(n){var s=-(t._+t.v*n)/t.l;i.t.x<=s&&s<=i.i.x&&f(r,new h(s,n))};switch(e(i.t.x),o(i.t.y),e(i.i.x),o(i.i.y),r.length){case 0:return null;case 1:return r[0];case 2:return u(r[0],r[1])?r[0]:l(r[0],r[1])}throw new Error("We should have at most two intersection points")}(o(t,i),new r(v,d));return Array.isArray(_)?_:null}var w;return null===(w=c(i,t,new r(v,d)))||u(i,w)?null:l(i,w)}if(a)return null===(w=c(t,i,new r(v,d)))||u(t,w)?null:l(t,w);_=function(t,i){var n=t[0].x,s=t[0].y,r=t[1].x,e=t[1].y,o=i.t.x,a=i.t.y,f=i.i.x,c=i.i.y;function v(t,i,n,s,h,r){var e=0;return t<n?e|=1:t>h&&(e|=2),i<s?e|=4:i>r&&(e|=8),e}for(var d=!1,_=v(n,s,o,a,f,c),w=v(r,e,o,a,f,c),M=0;;){if(M>1e3)throw new Error("Cohen - Sutherland algorithm: infinity loop");if(M++,!(_|w)){d=!0;break}if(_&w)break;var b=_||w,m=void 0,p=void 0;8&b?(m=n+(r-n)*(c-s)/(e-s),p=c):4&b?(m=n+(r-n)*(a-s)/(e-s),p=a):2&b?(p=s+(e-s)*(f-n)/(r-n),m=f):(p=s+(e-s)*(o-n)/(r-n),m=o),b===_?_=v(n=m,s=p,o,a,f,c):w=v(r=m,e=p,o,a,f,c)}return d?u(new h(n,s),new h(r,e))?new h(n,s):l(new h(n,s),new h(r,e)):null}(l(t,i),new r(v,d));return Array.isArray(_)?_:null}function S(t,i,n,s){i.save(),i.fillStyle="#000000",i.beginPath(),i.arc(t.x*s,t.y*s,n*s,0,2*Math.PI,!1),i.fill(),i.restore()}function T(t,i,n,s,h){if(!(i.subtract(t).length()<1))for(var r=function(t,i,n){var s=.5*n,h=Math.sqrt(2),r=i.subtract(t).normalized(),e=5*n,u=1*s;if(e*h*.2<=u)return[];var o=r.scaled(e),l=i.subtract(o),a=r.transposed(),f=1*e,c=a.scaled(f),v=l.add(c),d=l.subtract(c),_=v.subtract(i).normalized().scaled(u),w=d.subtract(i).normalized().scaled(u),M=i.add(_),b=i.add(w),m=s*(h-1),p=a.scaled(m),g=Math.min(e-1*s/h,s*h*1),y=r.scaled(g),k=i.subtract(p),x=i.add(p),C=i.subtract(y);return[[v,M],[d,b],[k,C.subtract(p)],[x,C.add(p)]]}(t,i,s),e=0;e<r.length;++e){var u=r[e][0],o=r[e][1];C(n,u.x*h,u.y*h,o.x*h,o.y*h)}}function A(t,i){if(!t)throw new Error("Assertion failed"+(i?": "+i:""))}function L(t){if(void 0===t)throw new Error("Value is undefined");return t}function E(t){if(null===t)throw new Error("Value is null");return t}function B(t){return E(L(t))}!function(t){t[t.Simple=0]="Simple",t[t.WithSteps=1]="WithSteps",t[t.WithStepsUpsideDown=2]="WithStepsUpsideDown"}(i||(i={})),function(t){t[t.Normal=0]="Normal",t[t.Arrow=1]="Arrow",t[t.Circle=2]="Circle"}(n||(n={})),function(t){t[t.Solid=0]="Solid",t[t.Dotted=1]="Dotted",t[t.Dashed=2]="Dashed",t[t.LargeDashed=3]="LargeDashed",t[t.SparseDotted=4]="SparseDotted",t[t.SmallDashed=5]="SmallDashed"}(s||(s={}));var D={khaki:"#f0e68c",azure:"#f0ffff",aliceblue:"#f0f8ff",ghostwhite:"#f8f8ff",gold:"#ffd700",goldenrod:"#daa520",gainsboro:"#dcdcdc",gray:"#808080",green:"#008000",honeydew:"#f0fff0",floralwhite:"#fffaf0",lightblue:"#add8e6",lightcoral:"#f08080",lemonchiffon:"#fffacd",hotpink:"#ff69b4",lightyellow:"#ffffe0",greenyellow:"#adff2f",lightgoldenrodyellow:"#fafad2",limegreen:"#32cd32",linen:"#faf0e6",lightcyan:"#e0ffff",magenta:"#f0f",maroon:"#800000",olive:"#808000",orange:"#ffa500",oldlace:"#fdf5e6",mediumblue:"#0000cd",transparent:"#0000",lime:"#0f0",lightpink:"#ffb6c1",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",midnightblue:"#191970",orchid:"#da70d6",mediumorchid:"#ba55d3",mediumturquoise:"#48d1cc",orangered:"#ff4500",royalblue:"#4169e1",powderblue:"#b0e0e6",red:"#f00",coral:"#ff7f50",turquoise:"#40e0d0",white:"#fff",whitesmoke:"#f5f5f5",wheat:"#f5deb3",teal:"#008080",steelblue:"#4682b4",bisque:"#ffe4c4",aquamarine:"#7fffd4",aqua:"#0ff",sienna:"#a0522d",silver:"#c0c0c0",springgreen:"#00ff7f",antiquewhite:"#faebd7",burlywood:"#deb887",brown:"#a52a2a",beige:"#f5f5dc",chocolate:"#d2691e",chartreuse:"#7fff00",cornflowerblue:"#6495ed",cornsilk:"#fff8dc",crimson:"#dc143c",cadetblue:"#5f9ea0",tomato:"#ff6347",fuchsia:"#f0f",blue:"#00f",salmon:"#fa8072",blanchedalmond:"#ffebcd",slateblue:"#6a5acd",slategray:"#708090",thistle:"#d8bfd8",tan:"#d2b48c",cyan:"#0ff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkgray:"#a9a9a9",blueviolet:"#8a2be2",black:"#000",darkmagenta:"#8b008b",darkslateblue:"#483d8b",darkkhaki:"#bdb76b",darkorchid:"#9932cc",darkorange:"#ff8c00",darkgreen:"#006400",darkred:"#8b0000",dodgerblue:"#1e90ff",darkslategray:"#2f4f4f",dimgray:"#696969",deepskyblue:"#00bfff",firebrick:"#b22222",forestgreen:"#228b22",indigo:"#4b0082",ivory:"#fffff0",lavenderblush:"#fff0f5",feldspar:"#d19275",indianred:"#cd5c5c",lightgreen:"#90ee90",lightgrey:"#d3d3d3",lightskyblue:"#87cefa",lightslategray:"#789",lightslateblue:"#8470ff",snow:"#fffafa",lightseagreen:"#20b2aa",lightsalmon:"#ffa07a",darksalmon:"#e9967a",darkviolet:"#9400d3",mediumpurple:"#9370d8",mediumaquamarine:"#66cdaa",skyblue:"#87ceeb",lavender:"#e6e6fa",lightsteelblue:"#b0c4de",mediumvioletred:"#c71585",mintcream:"#f5fffa",navajowhite:"#ffdead",navy:"#000080",olivedrab:"#6b8e23",palevioletred:"#d87093",violetred:"#d02090",yellow:"#ff0",yellowgreen:"#9acd32",lawngreen:"#7cfc00",pink:"#ffc0cb",paleturquoise:"#afeeee",palegoldenrod:"#eee8aa",darkolivegreen:"#556b2f",darkseagreen:"#8fbc8f",darkturquoise:"#00ced1",peachpuff:"#ffdab9",deeppink:"#ff1493",violet:"#ee82ee",palegreen:"#98fb98",mediumseagreen:"#3cb371",peru:"#cd853f",saddlebrown:"#8b4513",sandybrown:"#f4a460",rosybrown:"#bc8f8f",purple:"#800080",seagreen:"#2e8b57",seashell:"#fff5ee",papayawhip:"#ffefd5",mediumslateblue:"#7b68ee",plum:"#dda0dd",mediumspringgreen:"#00fa9a"};function F(t){return t<0?0:t>255?255:Math.round(t)||0}function P(t){return t<=0||t>0?t<0?0:t>1?1:Math.round(1e4*t)/1e4:0}var W=/^#([0-9a-f])([0-9a-f])([0-9a-f])([0-9a-f])?$/i,R=/^#([0-9a-f]{2})([0-9a-f]{2})([0-9a-f]{2})([0-9a-f]{2})?$/i,z=/^rgb\(\s*(-?\d{1,10})\s*,\s*(-?\d{1,10})\s*,\s*(-?\d{1,10})\s*\)$/,O=/^rgba\(\s*(-?\d{1,10})\s*,\s*(-?\d{1,10})\s*,\s*(-?\d{1,10})\s*,\s*(-?[\d]{0,10}(?:\.\d+)?)\s*\)$/;function V(t){var i;if((t=t.toLowerCase())in D&&(t=D[t]),i=O.exec(t)||z.exec(t))return[F(parseInt(i[1],10)),F(parseInt(i[2],10)),F(parseInt(i[3],10)),P(i.length<5?1:parseFloat(i[4]))];if(i=R.exec(t))return[F(parseInt(i[1],16)),F(parseInt(i[2],16)),F(parseInt(i[3],16)),1];if(i=W.exec(t))return[F(17*parseInt(i[1],16)),F(17*parseInt(i[2],16)),F(17*parseInt(i[3],16)),1];throw new Error("Cannot parse color: ".concat(t))}function I(t,i){if("transparent"===t)return t;var n=V(t),s=n[3];return"rgba(".concat(n[0],", ").concat(n[1],", ").concat(n[2],", ").concat(i*s,")")}function H(t){var i,n=V(t);return{p:"rgb(".concat(n[0],", ").concat(n[1],", ").concat(n[2],")"),g:(i=n,.199*i[0]+.687*i[1]+.114*i[2]>160?"black":"white")}}var j=function(t,i){return j=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,i){t.__proto__=i}||function(t,i){for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(t[n]=i[n])},j(t,i)};function U(t,i){if("function"!=typeof i&&null!==i)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");function n(){this.constructor=t}j(t,i),t.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}var q=function(){return q=Object.assign||function(t){for(var i,n=1,s=arguments.length;n<s;n++)for(var h in i=arguments[n])Object.prototype.hasOwnProperty.call(i,h)&&(t[h]=i[h]);return t},q.apply(this,arguments)};function Y(t,i,n){if(n||2===arguments.length)for(var s,h=0,r=i.length;h<r;h++)!s&&h in i||(s||(s=Array.prototype.slice.call(i,0,h)),s[h]=i[h]);return t.concat(s||Array.prototype.slice.call(i))}var $=function(){function t(){this.k=[]}return t.prototype.subscribe=function(t,i,n){var s={C:t,N:i,S:!0===n};this.k.push(s)},t.prototype.unsubscribe=function(t){var i=this.k.findIndex((function(i){return t===i.C}));i>-1&&this.k.splice(i,1)},t.prototype.unsubscribeAll=function(t){this.k=this.k.filter((function(i){return i.N!==t}))},t.prototype.fire=function(t,i){var n=Y([],this.k,!0);this.k=this.k.filter((function(t){return!t.S})),n.forEach((function(n){return n.C(t,i)}))},t.prototype.hasListeners=function(){return this.k.length>0},t.prototype.destroy=function(){this.k=[]},t}();function K(t){for(var i=[],n=1;n<arguments.length;n++)i[n-1]=arguments[n];for(var s=0,h=i;s<h.length;s++){var r=h[s];for(var e in r)void 0!==r[e]&&("object"!=typeof r[e]||void 0===t[e]?t[e]=r[e]:K(t[e],r[e]))}return t}function Z(t){return"number"==typeof t&&isFinite(t)}function X(t){return"number"==typeof t&&t%1==0}function J(t){return"string"==typeof t}function G(t){return"boolean"==typeof t}function Q(t){var i,n,s,h=t;if(!h||"object"!=typeof h)return h;for(n in i=Array.isArray(h)?[]:{},h)h.hasOwnProperty(n)&&(s=h[n],i[n]=s&&"object"==typeof s?Q(s):s);return i}function tt(t){return null!==t}function it(t){return null===t?void 0:t}var nt="'Trebuchet MS', Roboto, Ubuntu, sans-serif";function st(t,i,n){return n=void 0!==n?"".concat(n," "):"",void 0===i&&(i=nt),"".concat(n).concat(t,"px ").concat(i)}var ht=/[2-9]/g,rt=function(){function t(t){void 0===t&&(t=50),this.T=new Map,this.A=0,this.L=Array.from(new Array(t))}return t.prototype.reset=function(){this.T.clear(),this.L.fill(void 0)},t.prototype.measureText=function(t,i,n){var s=n||ht,h=String(i).replace(s,"0"),r=this.T.get(h);if(void 0===r){if(0===(r=t.measureText(h).width)&&0!==i.length)return 0;var e=this.L[this.A];void 0!==e&&this.T.delete(e),this.L[this.A]=h,this.A=(this.A+1)%this.L.length,this.T.set(h,r)}return r},t}(),et=function(){function t(t){this.B={borderSize:1,tickLength:4,widthCache:new rt,fontSize:NaN,font:"",fontFamily:"",color:"",paddingBottom:0,paddingInner:0,paddingOuter:0,paddingTop:0,baselineOffset:0,align:"left"},this.D=t}return t.prototype.options=function(){var t=this.B,i=this.F(),n=this.P();return t.fontSize===i&&t.fontFamily===n||(t.fontSize=i,t.fontFamily=n,t.font=st(i,n),t.paddingTop=Math.floor(i/3.5),t.paddingBottom=t.paddingTop,t.paddingInner=Math.max(Math.ceil(i/2-t.tickLength/2),0),t.paddingOuter=Math.ceil(i/2+t.tickLength/2),t.baselineOffset=Math.round(i/10),t.widthCache.reset()),t.color=this.W(),this.B},t.prototype.W=function(){return this.D.options().layout.textColor},t.prototype.F=function(){return this.D.options().layout.fontSize},t.prototype.P=function(){return this.D.options().layout.fontFamily},t}(),ut=function(){function t(){this.R=[],this.O=1}return t.prototype.V=function(t){this.R=t},t.prototype.I=function(t){this.O=t},t.prototype.H=function(t){var i;null===(i=this.R)||void 0===i||i.push(t)},t.prototype.j=function(t,i){this.R.splice(i,0,t)},t.prototype.U=function(){this.R.length=0},t.prototype.q=function(){return 0===this.R.length},t.prototype.draw=function(t,i){for(var n=0;n<this.R.length;n++)t.save(),t.globalAlpha=this.O,this.R[n].draw(t,i),t.restore()},t.prototype.drawBackground=function(t,i){t.save(),t.globalAlpha=this.O;for(var n=0;n<this.R.length;n++){var s=this.R[n];s.drawBackground&&s.drawBackground(t,i)}t.restore()},t.prototype.hitTest=function(t,i){for(var n=null,s=this.R.length-1;s>=0;s--){var h=this.R[s];if(h.hitTest&&(n=h.hitTest(t,i)||null),n)break}return n},t}(),ot=function(){function t(){}return t.prototype.draw=function(t,i){var n=i.pixelRatio;t.save(),t.scale(n,n),this.Y(t,i),t.restore()},t.prototype.drawBackground=function(t,i){var n=i.pixelRatio;t.save(),t.scale(n,n),this.$(t,i),t.restore()},t.prototype.$=function(t,i){},t}(),lt=function(t){function i(){var i=null!==t&&t.apply(this,arguments)||this;return i.K=null,i}return U(i,t),i.prototype.Z=function(t){this.K=t},i.prototype.Y=function(t){if(null!==this.K&&null!==this.K.X){var i=this.K.X,n=this.K,s=function(s){t.beginPath();for(var h=i.to-1;h>=i.from;--h){var r=n.J[h];t.moveTo(r.x,r.y),t.arc(r.x,r.y,s,0,2*Math.PI)}t.fill()};t.fillStyle=n.G,s(n.tt+2),t.fillStyle=n.it,s(n.tt)}},i}(ot);function at(){return{J:[{x:0,y:0,time:0,price:0}],it:"",G:"",tt:0,X:null}}var ft={from:0,to:1},ct=function(){function t(t,i){this.nt=new ut,this.st=[],this.ht=[],this.rt=new Map,this.D=t,this.et=i,this.nt.V(this.st)}return t.prototype.update=function(t){var i=this.D.serieses();i.length!==this.st.length&&(this.ht=i.map(at),this.st=this.ht.map((function(t){var i=new lt;return i.Z(t),i})),this.nt.V(this.st)),this.rt.clear()},t.prototype.renderer=function(t,i,n){var s=this.rt.get(n);if(!s){s=this.ut(n,t),this.rt.set(n,s);var h=new ut;return h.V(s),h}var r=new ut;return r.V(s),r},t.prototype.ut=function(t,i){var n=this,s=this.D.serieses().map((function(t,i){return[t,i]})).filter((function(i){return t.dataSources().includes(i[0])})),h=this.et.appliedIndex(),r=this.D.timeScale();return s.map((function(t){var s,e=t[0],u=t[1],o=n.ht[u],l=e.markerDataAtIndex(h);if(null!==l&&e.visible()){var a=E(e.firstValue());o.it=l.backgroundColor,o.tt=l.radius,o.J[0].price=l.price,o.J[0].y=e.priceScale().priceToCoordinate(l.price,a.value),o.G=null!==(s=l.borderColor)&&void 0!==s?s:n.D.backgroundColorAtYPercentFromTop(o.J[0].y/i),o.J[0].time=h,o.J[0].x=r.indexToCoordinate(h),o.X=ft}else o.X=null;return n.st[u]}))},t}(),vt=function(){function t(t){this.ot=t}return t.prototype.draw=function(t,i){if(null!==this.ot){var n=i.pixelRatio,s=this.ot.ft.lt,h=this.ot.ct.lt;if(s||h){t.save();var r=Math.round(this.ot.vt*n),e=Math.round(this.ot.dt*n),u=Math.ceil(this.ot._t*n),o=Math.ceil(this.ot.wt*n);t.lineCap="butt",s&&r>=0&&(t.lineWidth=Math.floor(this.ot.ft.Mt*n),t.strokeStyle=this.ot.ft.bt,t.fillStyle=this.ot.ft.bt,g(t,this.ot.ft.gt),x(t,r,0,o)),h&&e>=0&&(t.lineWidth=Math.floor(this.ot.ct.Mt*n),t.strokeStyle=this.ot.ct.bt,t.fillStyle=this.ot.ct.bt,g(t,this.ot.ct.gt),k(t,e,0,u)),t.restore()}}},t}(),dt=function(){function t(t){this.rt=new Map,this.yt={ft:{Mt:1,gt:0,bt:"",lt:!1},ct:{Mt:1,gt:0,bt:"",lt:!1},_t:0,wt:0,vt:0,dt:0},this.kt=new vt(this.yt),this.xt=t}return t.prototype.Ct=function(){this.rt.clear()},t.prototype.renderer=function(t,i,n){return this.ut(n),this.kt},t.prototype.ut=function(t){var i=this.xt.visible(),n=E(this.xt.pane()).model().options().crosshair,s=this.yt;s.ct.lt=i&&this.xt.horzLineVisible(t),s.ft.lt=i&&this.xt.vertLineVisible(),s.ct.Mt=n.horzLine.width,s.ct.gt=n.horzLine.style,s.ct.bt=n.horzLine.color,s.ft.Mt=n.vertLine.width,s.ft.gt=n.vertLine.style,s.ft.bt=n.vertLine.color,s._t=t.width(),s.wt=t.height(),s.vt=this.xt.appliedX(),s.dt=this.xt.appliedY()},t}();function _t(t,i,n,s,h,r){t.fillRect(i+r,n,s-2*r,r),t.fillRect(i+r,n+h-r,s-2*r,r),t.fillRect(i,n,r,h),t.fillRect(i+s-r,n,r,h)}function wt(t,i,n){t.save(),t.scale(i,i),n(),t.restore()}function Mt(t,i,n,s,h,r){t.save(),t.globalCompositeOperation="copy",t.fillStyle=r,t.fillRect(i,n,s,h),t.restore()}function bt(t,i,n,s,h,r,e){t.save(),t.globalCompositeOperation="copy";var u=t.createLinearGradient(0,0,0,h);u.addColorStop(0,r),u.addColorStop(1,e),t.fillStyle=u,t.fillRect(i,n,s,h),t.restore()}var mt=function(){function t(t,i){this.Z(t,i)}return t.prototype.Z=function(t,i){this.ot=t,this.Nt=i},t.prototype.draw=function(t,i,n){if(this.ot.lt){t.font=i.font;var s=this.ot.St||!this.ot.Tt?i.tickLength:0,h=i.borderSize,r=i.paddingTop,e=i.paddingBottom,u=i.paddingInner,o=i.paddingOuter,l=this.ot.At,a=Math.ceil(i.widthCache.measureText(t,l)),f=i.baselineOffset,c=i.fontSize+r+e,v=Math.ceil(.5*c),d=h+a+u+o+s,_=this.Nt.Lt;this.Nt.Et&&(_=this.Nt.Et);var w,M,b=(_=Math.round(_))-v,m=b+c,p="right"===i.align,g=n.pixelRatio,y=n.cssWidth,k=p?y:0,x=Math.ceil(y*g),C=k;if(t.fillStyle=this.Nt.p,t.lineWidth=1,t.lineCap="butt",l){p?(w=k-s,M=(C=k-d)+o):(C=k+d,w=k+s,M=k+h+s+u);var N=Math.max(1,Math.floor(g)),S=Math.max(1,Math.floor(h*g)),T=p?x:0,A=Math.round(b*g),L=Math.round(C*g),E=Math.round(_*g)-Math.floor(.5*g),B=E+N+(E-A),D=Math.round(w*g);t.save(),t.beginPath(),t.moveTo(T,A),t.lineTo(L,A),t.lineTo(L,B),t.lineTo(T,B),t.fill(),t.fillStyle=this.ot.Bt,t.fillRect(p?x-S:0,A,S,B-A),this.ot.St&&(t.fillStyle=this.Nt.bt,t.fillRect(T,E,D-T,N)),t.textAlign="left",t.fillStyle=this.Nt.bt,wt(t,g,(function(){t.fillText(l,M,m-e-f)})),t.restore()}}},t.prototype.Dt=function(t,i){return this.ot.lt?t.fontSize+t.paddingTop+t.paddingBottom:0},t}(),pt=function(){function t(t){this.Ft={Lt:0,bt:"#FFF",p:"#000"},this.Pt={At:"",lt:!1,St:!1,Tt:!1,Bt:""},this.Wt={At:"",lt:!1,St:!1,Tt:!0,Bt:""},this.Rt=!0,this.zt=new(t||mt)(this.Pt,this.Ft),this.Ot=new(t||mt)(this.Wt,this.Ft)}return t.prototype.At=function(){return this.Vt(),this.Pt.At},t.prototype.Lt=function(){return this.Vt(),this.Ft.Lt},t.prototype.update=function(){this.Rt=!0},t.prototype.Dt=function(t,i){return void 0===i&&(i=!1),Math.max(this.zt.Dt(t,i),this.Ot.Dt(t,i))},t.prototype.It=function(){return this.Ft.Et||0},t.prototype.Ht=function(t){this.Ft.Et=t},t.prototype.jt=function(){return this.Vt(),this.Pt.lt||this.Wt.lt},t.prototype.renderer=function(){return this.Vt(),this.zt.Z(this.Pt,this.Ft),this.Ot.Z(this.Wt,this.Ft),this.zt},t.prototype.Ut=function(){return this.Vt(),this.zt.Z(this.Pt,this.Ft),this.Ot.Z(this.Wt,this.Ft),this.Ot},t.prototype.Vt=function(){this.Rt&&(this.Pt.St=!1,this.Wt.St=!1,this.qt(this.Pt,this.Wt,this.Ft))},t}(),gt=function(t){function i(i,n,s){var h=t.call(this)||this;return h.xt=i,h.Yt=n,h.$t=s,h}return U(i,t),i.prototype.qt=function(t,i,n){t.lt=!1;var s=this.xt.options().horzLine;if(s.labelVisible){var h=this.Yt.firstValue();if(this.xt.visible()&&!this.Yt.isEmpty()&&null!==h){var r=H(s.labelBackgroundColor);n.p=r.p,n.bt=r.g;var e=this.$t(this.Yt);n.Lt=e.Lt,t.At=this.Yt.formatPrice(e.Kt,h),t.lt=!0}}},i}(pt),yt=/[1-9]/g,kt=function(){function t(){this.ot=null}return t.prototype.Z=function(t){this.ot=t},t.prototype.draw=function(t,i,n){var s=this;if(null!==this.ot&&!1!==this.ot.lt&&0!==this.ot.At.length){t.font=i.font;var h=n.pixelRatio,r=Math.round(i.widthCache.measureText(t,this.ot.At,yt));if(!(r<=0)){t.save();var e=i.paddingHorizontal,u=r+2*e,o=u/2,l=this.ot.Zt,a=this.ot.Lt,f=Math.floor(a-o)+.5;f<0?(a+=Math.abs(0-f),f=Math.floor(a-o)+.5):f+u>l&&(a-=Math.abs(l-(f+u)),f=Math.floor(a-o)+.5);var c=f+u,v=0+i.borderSize+i.paddingTop+i.fontSize+i.paddingBottom;t.fillStyle=this.ot.p;var d=Math.round(f*h),_=Math.round(0*h),w=Math.round(c*h),M=Math.round(v*h);if(t.fillRect(d,_,w-d,M-_),this.ot.St){var b=Math.round(this.ot.Lt*h),m=_,p=Math.round((m+i.borderSize+i.tickLength)*h);t.fillStyle=this.ot.bt;var g=Math.max(1,Math.floor(h)),y=Math.floor(.5*h);t.fillRect(b-y,m,g,p-m)}var k=v-i.baselineOffset-i.paddingBottom;t.textAlign="left",t.fillStyle=this.ot.bt,wt(t,n.pixelRatio,(function(){t.fillText(E(s.ot).At,f+e,k)})),t.restore()}}},t}(),xt=function(){function t(t){this.Xt=new kt,this.Jt=!0,this.Gt={p:"",Lt:0,bt:"",At:"",Zt:0,lt:!1,St:!1},this.Qt=t,this.Xt.Z(this.Gt)}return t.prototype.update=function(){this.Jt=!0},t.prototype.renderer=function(){return this.Jt&&this.ti(),this.Jt=!1,this.Xt},t.prototype.ti=function(){if(this.Gt.lt=!1,!this.Qt.timeScale().isEmpty()){var t=this.ii();if(null!==t){var i=this.ni();if(null!==i){var n=H(t);this.Gt.p=n.p,this.Gt.bt=n.g,this.Gt.Lt=this.Qt.timeScale().timeToCoordinate({timestamp:i}),this.Gt.At=this.Qt.timeScale().formatDateTime({timestamp:i}),this.Gt.Zt=this.Qt.timeScale().width(),this.Gt.lt=!0,this.Jt=!1}}}},t}(),Ct=function(t){function i(i,n,s){var h=t.call(this,n)||this;return h.si=i,h.hi=s,h}return U(i,t),i.prototype.ni=function(){return this.Qt.timeScale().floatIndexToTime(this.si.appliedIndex())},i.prototype.ii=function(){return"#4c525e"},i.prototype.ti=function(){this.Gt.lt=!1,this.si.options().vertLine.labelVisible&&t.prototype.ti.call(this)},i}(xt),Nt="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ";var St,Tt=function(){function t(){this._priceScale=null,this.ri=function(t){for(var i="",n=0;n<t;++n){var s=Math.floor(Math.random()*Nt.length);i+=Nt[s]}return i}(6),this.ei=0}return t.prototype.id=function(){return this.ri},t.prototype.setId=function(t){this.ri=t},t.prototype.zorder=function(){return this.ei},t.prototype.setZorder=function(t){this.ei=t},t.prototype.priceScale=function(){return this._priceScale},t.prototype.setPriceScale=function(t){this._priceScale=t},t.prototype.timeAxisViews=function(){return[]},t.prototype.visible=function(){return!0},t}();!function(t){t[t.Normal=0]="Normal",t[t.Magnet=1]="Magnet"}(St||(St={}));var At=function(t){function i(i,n){var s=t.call(this)||this;s.ui=null,s.oi=NaN,s.li=0,s.ai=!0,s.fi=new Map,s.ci=!1,s.vi=NaN,s.di=NaN,s._i=NaN,s.wi=NaN,s.Mi=i,s.bi=n,s.mi=new ct(i,s);var h,r;s.pi=(h=function(){return s.oi},r=function(){return s.di},function(t){var i=r(),n=h();if(t===E(s.ui).defaultPriceScale())return{Kt:n,Lt:i};var e=E(t.firstValue());return{Kt:t.coordinateToPrice(i,e),Lt:i}});var e=function(t,i){return function(){return{gi:s.Mi.timeScale().indexToTime(t()),Lt:i()}}}((function(){return s.li}),(function(){return s.appliedX()}));return s.yi=new Ct(s,i,e),s.ki=new dt(s),s}return U(i,t),i.prototype.options=function(){return this.bi},i.prototype.saveOriginCoord=function(t,i){this._i=t,this.wi=i},i.prototype.clearOriginCoord=function(){this._i=NaN,this.wi=NaN},i.prototype.originCoordX=function(){return this._i},i.prototype.originCoordY=function(){return this.wi},i.prototype.setPosition=function(t,i,n){this.ci||(this.ci=!0),this.ai=!0,this.xi(t,i,n)},i.prototype.appliedIndex=function(){return this.li},i.prototype.appliedX=function(){return this.vi},i.prototype.appliedY=function(){return this.di},i.prototype.visible=function(){return this.ai},i.prototype.clearPosition=function(){this.ai=!1,this.Ci(),this.oi=NaN,this.vi=NaN,this.di=NaN,this.ui=null,this.clearOriginCoord()},i.prototype.paneViews=function(){return null!==this.ui?[this.ki,this.mi]:[]},i.prototype.horzLineVisible=function(t){return t===this.ui&&this.bi.horzLine.visible},i.prototype.vertLineVisible=function(){return this.bi.vertLine.visible},i.prototype.priceAxisViews=function(t,i){this.ai&&this.ui===t||this.fi.clear();var n=[];return this.ui===t&&n.push(this.Ni(this.fi,i,this.pi)),n},i.prototype.timeAxisViews=function(){return this.ai?[this.yi]:[]},i.prototype.pane=function(){return this.ui},i.prototype.updateAllViews=function(){this.ki.Ct(),this.fi.forEach((function(t){return t.update()})),this.yi.update(),this.mi.update()},i.prototype.Si=function(t){return t&&!t.defaultPriceScale().isEmpty()?t.defaultPriceScale():null},i.prototype.xi=function(t,i,n){this.Ti(t,i,n)&&this.updateAllViews()},i.prototype.Ti=function(t,i,n){var s=this.vi,h=this.di,r=this.oi,e=this.li,u=this.ui,o=this.Si(n);this.li=t,this.vi=isNaN(t)?NaN:this.Mi.timeScale().indexToCoordinate(t),this.ui=n;var l=null!==o?o.firstValue():null;return null!==o&&null!==l?(this.oi=i,this.di=o.priceToCoordinate(i,l)):(this.oi=NaN,this.di=NaN),s!==this.vi||h!==this.di||e!==this.li||r!==this.oi||u!==this.ui},i.prototype.Ci=function(){var t=this.Mi.serieses().map((function(t){return t.bars().lastIndex()})).filter(tt),i=0===t.length?null:Math.max.apply(Math,t);this.li=null!==i?i:NaN},i.prototype.Ni=function(t,i,n){var s=t.get(i);return void 0===s&&(s=new gt(this,i,n),t.set(i,s)),s},i}(Tt);function Lt(t){return"left"===t||"right"===t}var Et=function(){function t(t){this.Ai=new Map,this.Li=[],this.Ei=t}return t.prototype.invalidatePane=function(t,i){var n=function(t,i){return void 0===t?i:{level:Math.max(t.level,i.level),autoScale:t.autoScale||i.autoScale}}(this.Ai.get(t),i);this.Ai.set(t,n)},t.prototype.fullInvalidation=function(){return this.Ei},t.prototype.invalidateForPane=function(t){var i=this.Ai.get(t);return void 0===i?{level:this.Ei}:{level:Math.max(this.Ei,i.level),autoScale:i.autoScale}},t.prototype.setFitContent=function(){this.Li=[{type:0}]},t.prototype.applyRange=function(t){this.Li=[{type:1,value:t}]},t.prototype.resetTimeScale=function(){this.Li=[{type:4}]},t.prototype.setBarSpacing=function(t){this.Li.push({type:2,value:t})},t.prototype.setRightOffset=function(t){this.Li.push({type:3,value:t})},t.prototype.timeScaleInvalidations=function(){return this.Li},t.prototype.merge=function(t){for(var i=this,n=0,s=t.Li;n<s.length;n++){var h=s[n];this.Bi(h)}this.Ei=Math.max(this.Ei,t.Ei),t.Ai.forEach((function(t,n){i.invalidatePane(n,t)}))},t.prototype.Bi=function(t){switch(t.type){case 0:this.setFitContent();break;case 1:this.applyRange(t.value);break;case 2:this.setBarSpacing(t.value);break;case 3:this.setRightOffset(t.value);break;case 4:this.resetTimeScale()}},t}(),Bt={value:"",padding:0,wordWrapWidth:0,forceTextAlign:!1,forceCalculateMaxLineWidth:!1,alignment:"left",font:{family:nt,color:"#2962ff",size:12,bold:!1,italic:!1},box:{scale:1,angle:0,alignment:{vertical:"bottom",horizontal:"left"}}},Dt={visible:!0,line:{width:1,color:"#2962ff",style:0,extend:{left:!1,right:!1},end:{left:0,right:0}},text:Bt},Ft={visible:!0,line:{width:1,color:"#2962ff",style:0,extend:{left:!0,right:!0},end:{left:0,right:0}},text:Bt},Pt={visible:!0,showMiddleLine:!0,extend:{left:!1,right:!1},background:{color:I("#2962ff",.2)},middleLine:{width:1,color:"#2962ff",style:2},channelLine:{width:1,color:"#2962ff",style:0}},Wt={visible:!0,rectangle:{extend:{left:!1,right:!1},background:{color:I("#9c27b0",.2)},border:{width:1,style:0,color:"#9c27b0"}},text:Bt},Rt={visible:!0,triangle:{background:{color:I("#f57c00",.2)},border:{width:1,style:0,color:"#f57c00"}}},zt={visible:!0,text:Bt,line:{width:1,color:"#2962ff",style:0}},Ot={visible:!0,line:{color:I("#f23645",.15)}},Vt={visible:!0,text:K(Q(Bt),{value:"Text"})},It={Ray:K(Q(Dt),{line:{extend:{right:!0}}}),Arrow:K(Q(Dt),{line:{end:{right:1}}}),ExtendedLine:K(Q(Dt),{line:{extend:{right:!0,left:!0}}}),HorizontalRay:K(Q(Ft),{line:{extend:{left:!1}}}),FibRetracement:{visible:!0,extend:{left:!1,right:!1},line:{width:1,style:0},levels:[{color:"#787b86",coeff:0},{color:"#f23645",coeff:.236},{color:"#81c784",coeff:.382},{color:"#4caf50",coeff:.5},{color:"#089981",coeff:.618},{color:"#64b5f6",coeff:.786},{color:"#787b86",coeff:1},{color:"#2962ff",coeff:1.618},{color:"#f23645",coeff:2.618},{color:"#9c27b0",coeff:3.618},{color:"#e91e63",coeff:4.236}]},ParallelChannel:Pt,HorizontalLine:Ft,VerticalLine:zt,Highlighter:Ot,CrossLine:{visible:!0,line:{width:1,color:"#2962ff",style:0}},TrendLine:Dt,Rectangle:Wt,Triangle:Rt,Brush:{visible:!0,line:{width:1,color:"#00bcd4",join:"round",style:0,end:{left:0,right:0}}},Path:{visible:!0,line:{width:1,color:"#2962ff",style:0,end:{left:0,right:1}}},Text:Vt},Ht=function(){function t(){this.ot=null}return t.prototype.Z=function(t){this.ot=t},t.prototype.drawBackground=function(t,i,n){if(null!==this.ot&&!1!==this.ot.lt){var s=this.ot,h=s.Lt,r=s.Dt,e=s.bt,u=t.canvas.clientWidth;wt(t,n.pixelRatio,(function(){t.fillStyle=e,t.fillRect(0,h,u,r)}))}},t}(),jt=function(){function t(t){this.Xt=new Ht,this.Jt=!0,this.Gt={bt:"rgba(41, 98, 255, 0.25)",lt:!1,Lt:0,Dt:0},this.Di=t,this.Qt=t.model(),this.Xt.Z(this.Gt)}return t.prototype.update=function(){this.Jt=!0},t.prototype.renderer=function(){return this.Jt&&this.ti(),this.Jt=!1,this.Xt},t.prototype.ti=function(){this.Gt.lt=!1;var t=this.Di.priceScale();if(t&&!t.isEmpty()&&this.Di.selected()){var i=this.Di.priceAxisPoints().map((function(i){return t.priceToCoordinate(i.price,i.price)})),n=Math.max.apply(Math,i),s=Math.min.apply(Math,i);this.Gt.Lt=s,this.Gt.Dt=n-s,this.Gt.lt=!0,this.Jt=!1}},t}(),Ut=function(t){function i(i,n){var s=t.call(this)||this;return s.Fi=!1,s.Fi=!1,s.Di=i,s.Pi=n,s}return U(i,t),i.prototype.Wi=function(t){this.Fi=t},i.prototype.qt=function(t,i,n){var s;t.lt=!1;var h=this.Di.model();if(h.timeScale()&&!h.timeScale().isEmpty()){var r=this.ii();if(null!==r){var e=this.Di.priceScale();if(null!==e&&!e.isEmpty()&&null!==h.timeScale().visibleStrictRange()){var u=this.Di.priceAxisPoints();if(!(u.length<=this.Pi)){var o=u[this.Pi];if(isFinite(o.price)){var l=this.Di.ownerSource(),a=null!==l?l.firstValue():null;null!==a&&(n.p=r,n.bt=H(n.p).g,n.Lt=e.priceToCoordinate(o.price,a.value),t.At=(null===(s=this.Di.priceScale())||void 0===s?void 0:s.formatPrice(o.price,a.value))||"",t.lt=!0)}}}}}},i.prototype.ii=function(){return this.Di.priceAxisLabelColor()},i}(pt),qt=function(){function t(){this.ot=null}return t.prototype.Z=function(t){this.ot=t},t.prototype.drawBackground=function(t,i,n){if(null!==this.ot&&!1!==this.ot.lt){var s=this.ot,h=s.Lt,r=s.Zt,e=s.bt,u=t.canvas.clientHeight;wt(t,n.pixelRatio,(function(){t.fillStyle=e,t.fillRect(h,0,r,u)}))}},t}(),Yt=function(){function t(t){this.Xt=new qt,this.Jt=!0,this.Gt={bt:"rgba(41, 98, 255, 0.25)",lt:!1,Lt:0,Zt:0},this.Di=t,this.Qt=t.model(),this.Xt.Z(this.Gt)}return t.prototype.update=function(){this.Jt=!0},t.prototype.renderer=function(){return this.Jt&&this.ti(),this.Jt=!1,this.Xt},t.prototype.ti=function(){var t=this;if(this.Gt.lt=!1,!this.Qt.timeScale().isEmpty()&&this.Di.selected()){var i=this.Di.timeAxisPoints().map((function(i){return t.Qt.timeScale().timeToCoordinate({timestamp:i.timestamp})})),n=Math.max.apply(Math,i),s=Math.min.apply(Math,i);this.Gt.Lt=s,this.Gt.Zt=n-s,this.Gt.lt=!0,this.Jt=!1}},t}(),$t=function(t){function i(i,n){var s=t.call(this,i.model())||this;return s.Di=i,s.Pi=n,s}return U(i,t),i.prototype.ii=function(){return this.Di.timeAxisLabelColor()},i.prototype.ni=function(){var t=this.Di.timeAxisPoints();return t.length<=this.Pi?null:t[this.Pi].timestamp},i}(xt),Kt=function(t){function i(i,n,s){void 0===s&&(s=[]);var h=t.call(this)||this;h._pointChanged=new $,h._pointAdded=new $,h._priceAxisViews=[],h._timeAxisViews=[],h._paneViews=[],h._hovered=!1,h._selected=!1,h._finished=!1,h._editing=!1,h._ownerSource=null,h._lastPoint=null,h._points=[],h._model=i,h._points=s,h._options=n;for(var r=0;r<h.pointsCount();r++)h._priceAxisViews.push(new Ut(h,r)),h._timeAxisViews.push(new $t(h,r));return h.pointsCount()>1&&(h._priceAxisViews.push(new jt(h)),h._timeAxisViews.push(new Yt(h))),h._ownerSource=i.serieses()[0],h._finished=h._points.length>=(-1===h.pointsCount()?2:h.pointsCount()),h}return U(i,t),i.prototype.finished=function(){return this._finished},i.prototype.tryFinish=function(){this._points.length>=Math.max(1,this.pointsCount())&&(this._finished=!0,this._selected=!0,this._lastPoint=null,this.model().updateSource(this))},i.prototype.points=function(){var t=Y(Y([],this._points,!0),this._lastPoint?[this._lastPoint]:[],!0);return-1===this.pointsCount()?t:t.slice(0,this.pointsCount())},i.prototype.addPoint=function(t){this._points.push(t)},i.prototype.getPoint=function(t){return this.points()[t]||null},i.prototype.setPoint=function(t,i){this._points[t].price=i.price,this._points[t].timestamp=i.timestamp},i.prototype.setPoints=function(t){this._points=t},i.prototype.setLastPoint=function(t){this._lastPoint=t},i.prototype.pointToScreenPoint=function(t){var i,n,s=(null===(n=null===(i=this.ownerSource())||void 0===i?void 0:i.firstValue())||void 0===n?void 0:n.value)||0,r=this.priceScale(),e=this.timeScale();if(!r||r.isEmpty()||e.isEmpty())return null;var u=e.timeToCoordinate({timestamp:t.timestamp}),o=r.priceToCoordinate(t.price,s);return new h(u,o)},i.prototype.screenPointToPoint=function(t){var i,n,s=(null===(n=null===(i=this.ownerSource())||void 0===i?void 0:i.firstValue())||void 0===n?void 0:n.value)||0,h=this.priceScale(),r=this.timeScale();return h?{price:h.coordinateToPrice(t.y,s),timestamp:r.coordinateToTime(t.x).timestamp}:null},i.prototype.state=function(){return{id:this.id(),type:this._toolType,options:this._options}},i.prototype.priceScale=function(){return this._model.panes()[0].rightPriceScale()},i.prototype.timeScale=function(){return this._model.timeScale()},i.prototype.ownerSource=function(){return this._ownerSource},i.prototype.options=function(){return this._options},i.prototype.visible=function(){return this._options.visible},i.prototype.applyOptions=function(t){K(this._options,t),this.model().updateSource(this),this._paneViews.forEach((function(t){t.update("options")}))},i.prototype.paneViews=function(t){return this._paneViews},i.prototype.updateAllViews=function(){if(this.options().visible){this._updateAllPaneViews();for(var t=0;t<this._priceAxisViews.length;t++)this._priceAxisViews[t].update();for(t=0;t<this._timeAxisViews.length;t++)this._timeAxisViews[t].update()}},i.prototype.hovered=function(){return this._hovered},i.prototype.setHovered=function(t){var i=t!==this._hovered;return this._hovered=t,i},i.prototype.selected=function(){return this._selected},i.prototype.setSelected=function(t){var i=t!==this._selected;return this._selected=t,i&&this.updateAllViews(),i},i.prototype.editing=function(){return this._editing},i.prototype.setEditing=function(t){var i=t!==this._editing;return this._editing=t,i},i.prototype.model=function(){return this._model},i.prototype.toolType=function(){return this._toolType},i.prototype.destroy=function(){},i.prototype.timeAxisPoints=function(){return this.points()},i.prototype.priceAxisPoints=function(){return this.points()},i.prototype.timeAxisLabelColor=function(){return this.selected()?"#2962FF":null},i.prototype.priceAxisLabelColor=function(){return this.selected()?"#2962FF":null},i.prototype.timeAxisViews=function(){return this._timeAxisViews},i.prototype.priceAxisViews=function(){return this._priceAxisViews},i.prototype.lineDrawnWithPressedButton=function(){return!1},i.prototype.hasMagnet=function(){return!0},i.prototype._setPaneViews=function(t){this._paneViews=t},i.prototype._updateAllPaneViews=function(){this._paneViews.forEach((function(t){return t.update()}))},i}(Tt);function Zt(t){var i;if("object"!=typeof t||null===t||"number"==typeof t.nodeType)i=t;else if(t instanceof Date)i=new Date(t.valueOf());else if(Array.isArray(t)){i=[];for(var n=0;n<t.length;n++)Object.prototype.hasOwnProperty.call(t,n)&&(i[n]=Zt(t[n]))}else i={},Object.keys(t).forEach((function(n){i[n]=Zt(t[n])}));return i}var Xt,Jt=function(){function t(t,i){this.Ri=t,this.ot=i||null}return t.prototype.type=function(){return this.Ri},t.prototype.data=function(){return this.ot},t}();!function(t){t[t.Regular=1]="Regular",t[t.MovePoint=2]="MovePoint",t[t.MovePointBackground=3]="MovePointBackground",t[t.ChangePoint=4]="ChangePoint",t[t.Custom=5]="Custom"}(Xt||(Xt={}));var Gt=3,Qt=2,ti=function(){function t(){this.K=null,this.zi=new Jt(Xt.MovePoint)}return t.prototype.Z=function(t){this.K=t},t.prototype.Oi=function(t){this.zi=t},t.prototype.draw=function(t,i){if(this.K&&!(this.K.Vi.length<2)){var n=i.pixelRatio,s=this.K.Ii.width||1,h=this.K.Ii.color||"white",r=this.K.Ii.style||0;t.lineCap="butt",t.strokeStyle=h,t.lineWidth=Math.max(1,Math.floor(s*n)),g(t,r);var e=this.K.Vi[0],u=this.K.Vi[1];this.Hi(t,[e,u],s,n);var o=this.ji(e,u,i);null!==o&&s>0&&(o[0].x===o[1].x?x(t,Math.round(o[0].x*n),o[0].y*n,o[1].y*n):o[0].y===o[1].y?k(t,Math.round(o[0].y*n),o[0].x*n,o[1].x*n):C(t,o[0].x*n,o[0].y*n,o[1].x*n,o[1].y*n))}},t.prototype.hitTest=function(t,i){if(null===this.K||this.K.Vi.length<2)return null;var n=Gt,s=this.ji(this.K.Vi[0],this.K.Vi[1],i);return null!==s&&_(s[0],s[1],t).M<=n?this.zi:null},t.prototype.ji=function(t,i,n){var s,h,r=E(this.K);return N(t,i,n.cssWidth,n.cssHeight,!!(null===(s=r.Ii.extend)||void 0===s?void 0:s.left),!!(null===(h=r.Ii.extend)||void 0===h?void 0:h.right))},t.prototype.Hi=function(t,i,n,s){var h,r,e=E(this.K);switch(null===(h=e.Ii.end)||void 0===h?void 0:h.left){case 1:T(i[1],i[0],t,n,s);break;case 2:S(i[0],t,n,s)}switch(null===(r=e.Ii.end)||void 0===r?void 0:r.right){case 1:T(i[0],i[1],t,n,s);break;case 2:S(i[1],t,n,s)}},t}();function ii(t,i,n,s,h,r){var e,u,o,l;if(Array.isArray(r))if(2===r.length){var a=Math.max(0,r[0]),f=Math.max(0,r[1]);e=a,u=a,o=f,l=f}else{if(4!==r.length)throw new Error("Wrong border radius - it should be like css border radius");e=Math.max(0,r[0]),u=Math.max(0,r[1]),o=Math.max(0,r[2]),l=Math.max(0,r[3])}else e=a=Math.max(0,r),u=a,o=a,l=a;t.beginPath(),t.moveTo(i+e,n),t.lineTo(i+s-u,n),0!==u&&t.arcTo(i+s,n,i+s,n+u,u),t.lineTo(i+s,n+h-o),0!==o&&t.arcTo(i+s,n+h,i+s-o,n+h,o),t.lineTo(i+l,n+h),0!==l&&t.arcTo(i,n+h,i,n+h-l,l),t.lineTo(i,n+e),0!==e&&t.arcTo(i,n,i+e,n,e)}var ni,si=function(){function t(t,i){this.Ui=null,this.qi=null,this.Yi=null,this.$i=null,this.Ki=null,this.K=null,this.zi=i||new Jt(Xt.MovePoint),void 0!==t&&this.Z(t)}return t.prototype.Z=function(t){!function(t,i){var n,s,h,r,e,u,o,l,a,f,c,v,d,_,w,M,b,m,p,g,y,k,x,C,N,S,T,A,L,E,B,D,F,P,W,R,z,O,V,I,H,j,U,q,Y,$,K,Z,X,J,G,Q,tt,it,nt,st,ht,rt,et,ut,ot,lt,at,ft,ct,vt,dt,_t,wt,Mt,bt,mt,pt,gt,yt,kt,xt,Ct,Nt,St,Tt,At,Lt,Et,Bt,Dt,Ft,Pt,Wt,Rt,zt,Ot,Vt,It,Ht,jt,Ut,qt,Yt,$t,Kt,Zt,Xt,Jt,Gt,Qt,ti,ii,ni,si,hi,ri,ei,ui,oi,li,ai,fi,ci,vi,di,_i;if(null===t||null===i)return null===t==(null===i);if(void 0===t.Vi!=(void 0===i.Vi))return!1;if(void 0!==t.Vi&&void 0!==i.Vi){if(t.Vi.length!==i.Vi.length)return!1;for(var wi=0;wi<t.Vi.length;++wi)if(t.Vi[wi].x!==i.Vi[wi].x||t.Vi[wi].y!==i.Vi[wi].y)return!1}return(null===(n=t.At)||void 0===n?void 0:n.forceCalculateMaxLineWidth)===(null===(s=i.At)||void 0===s?void 0:s.forceCalculateMaxLineWidth)&&(null===(h=t.At)||void 0===h?void 0:h.forceTextAlign)===(null===(r=i.At)||void 0===r?void 0:r.forceTextAlign)&&(null===(e=t.At)||void 0===e?void 0:e.wordWrapWidth)===(null===(u=i.At)||void 0===u?void 0:u.wordWrapWidth)&&(null===(o=t.At)||void 0===o?void 0:o.padding)===(null===(l=i.At)||void 0===l?void 0:l.padding)&&(null===(a=t.At)||void 0===a?void 0:a.value)===(null===(f=i.At)||void 0===f?void 0:f.value)&&(null===(c=t.At)||void 0===c?void 0:c.alignment)===(null===(v=i.At)||void 0===v?void 0:v.alignment)&&(null===(_=null===(d=t.At)||void 0===d?void 0:d.font)||void 0===_?void 0:_.bold)===(null===(M=null===(w=i.At)||void 0===w?void 0:w.font)||void 0===M?void 0:M.bold)&&(null===(m=null===(b=t.At)||void 0===b?void 0:b.font)||void 0===m?void 0:m.size)===(null===(g=null===(p=i.At)||void 0===p?void 0:p.font)||void 0===g?void 0:g.size)&&(null===(k=null===(y=t.At)||void 0===y?void 0:y.font)||void 0===k?void 0:k.family)===(null===(C=null===(x=i.At)||void 0===x?void 0:x.font)||void 0===C?void 0:C.family)&&(null===(S=null===(N=t.At)||void 0===N?void 0:N.font)||void 0===S?void 0:S.italic)===(null===(A=null===(T=i.At)||void 0===T?void 0:T.font)||void 0===A?void 0:A.italic)&&(null===(E=null===(L=t.At)||void 0===L?void 0:L.box)||void 0===E?void 0:E.angle)===(null===(D=null===(B=i.At)||void 0===B?void 0:B.box)||void 0===D?void 0:D.angle)&&(null===(P=null===(F=t.At)||void 0===F?void 0:F.box)||void 0===P?void 0:P.scale)===(null===(R=null===(W=i.At)||void 0===W?void 0:W.box)||void 0===R?void 0:R.scale)&&(null===(V=null===(O=null===(z=t.At)||void 0===z?void 0:z.box)||void 0===O?void 0:O.offset)||void 0===V?void 0:V.x)===(null===(j=null===(H=null===(I=i.At)||void 0===I?void 0:I.box)||void 0===H?void 0:H.offset)||void 0===j?void 0:j.x)&&(null===(Y=null===(q=null===(U=t.At)||void 0===U?void 0:U.box)||void 0===q?void 0:q.offset)||void 0===Y?void 0:Y.y)===(null===(Z=null===(K=null===($=i.At)||void 0===$?void 0:$.box)||void 0===K?void 0:K.offset)||void 0===Z?void 0:Z.y)&&(null===(J=null===(X=t.At)||void 0===X?void 0:X.box)||void 0===J?void 0:J.maxHeight)===(null===(Q=null===(G=i.At)||void 0===G?void 0:G.box)||void 0===Q?void 0:Q.maxHeight)&&(null===(nt=null===(it=null===(tt=t.At)||void 0===tt?void 0:tt.box)||void 0===it?void 0:it.padding)||void 0===nt?void 0:nt.x)===(null===(rt=null===(ht=null===(st=i.At)||void 0===st?void 0:st.box)||void 0===ht?void 0:ht.padding)||void 0===rt?void 0:rt.x)&&(null===(ot=null===(ut=null===(et=t.At)||void 0===et?void 0:et.box)||void 0===ut?void 0:ut.padding)||void 0===ot?void 0:ot.y)===(null===(ft=null===(at=null===(lt=i.At)||void 0===lt?void 0:lt.box)||void 0===at?void 0:at.padding)||void 0===ft?void 0:ft.y)&&(null===(dt=null===(vt=null===(ct=t.At)||void 0===ct?void 0:ct.box)||void 0===vt?void 0:vt.alignment)||void 0===dt?void 0:dt.vertical)===(null===(Mt=null===(wt=null===(_t=i.At)||void 0===_t?void 0:_t.box)||void 0===wt?void 0:wt.alignment)||void 0===Mt?void 0:Mt.vertical)&&(null===(pt=null===(mt=null===(bt=t.At)||void 0===bt?void 0:bt.box)||void 0===mt?void 0:mt.alignment)||void 0===pt?void 0:pt.horizontal)===(null===(kt=null===(yt=null===(gt=i.At)||void 0===gt?void 0:gt.box)||void 0===yt?void 0:yt.alignment)||void 0===kt?void 0:kt.horizontal)&&(null===(St=null===(Nt=null===(Ct=null===(xt=t.At)||void 0===xt?void 0:xt.box)||void 0===Ct?void 0:Ct.background)||void 0===Nt?void 0:Nt.inflation)||void 0===St?void 0:St.x)===(null===(Et=null===(Lt=null===(At=null===(Tt=i.At)||void 0===Tt?void 0:Tt.box)||void 0===At?void 0:At.background)||void 0===Lt?void 0:Lt.inflation)||void 0===Et?void 0:Et.x)&&(null===(Pt=null===(Ft=null===(Dt=null===(Bt=t.At)||void 0===Bt?void 0:Bt.box)||void 0===Dt?void 0:Dt.background)||void 0===Ft?void 0:Ft.inflation)||void 0===Pt?void 0:Pt.y)===(null===(Ot=null===(zt=null===(Rt=null===(Wt=i.At)||void 0===Wt?void 0:Wt.box)||void 0===Rt?void 0:Rt.background)||void 0===zt?void 0:zt.inflation)||void 0===Ot?void 0:Ot.y)&&(null===(Ht=null===(It=null===(Vt=t.At)||void 0===Vt?void 0:Vt.box)||void 0===It?void 0:It.border)||void 0===Ht?void 0:Ht.highlight)===(null===(qt=null===(Ut=null===(jt=i.At)||void 0===jt?void 0:jt.box)||void 0===Ut?void 0:Ut.border)||void 0===qt?void 0:qt.highlight)&&(null===(Kt=null===($t=null===(Yt=t.At)||void 0===Yt?void 0:Yt.box)||void 0===$t?void 0:$t.border)||void 0===Kt?void 0:Kt.radius)===(null===(Jt=null===(Xt=null===(Zt=i.At)||void 0===Zt?void 0:Zt.box)||void 0===Xt?void 0:Xt.border)||void 0===Jt?void 0:Jt.radius)&&(null===(ti=null===(Qt=null===(Gt=t.At)||void 0===Gt?void 0:Gt.box)||void 0===Qt?void 0:Qt.shadow)||void 0===ti?void 0:ti.offset)===(null===(si=null===(ni=null===(ii=i.At)||void 0===ii?void 0:ii.box)||void 0===ni?void 0:ni.shadow)||void 0===si?void 0:si.offset)&&(null===(ei=null===(ri=null===(hi=t.At)||void 0===hi?void 0:hi.box)||void 0===ri?void 0:ri.shadow)||void 0===ei?void 0:ei.color)===(null===(li=null===(oi=null===(ui=i.At)||void 0===ui?void 0:ui.box)||void 0===oi?void 0:oi.shadow)||void 0===li?void 0:li.color)&&(null===(ci=null===(fi=null===(ai=t.At)||void 0===ai?void 0:ai.box)||void 0===fi?void 0:fi.shadow)||void 0===ci?void 0:ci.blur)===(null===(_i=null===(di=null===(vi=i.At)||void 0===vi?void 0:vi.box)||void 0===di?void 0:di.shadow)||void 0===_i?void 0:_i.blur)}(this.K,t)?(this.K=t,this.qi=null,this.Ui=null,this.Yi=null,this.$i=null,this.Ki=null):this.K=t},t.prototype.hitTest=function(t){return null===this.K||void 0===this.K.Vi||0===this.K.Vi.length?null:M(t,this.Zi())?this.zi:null},t.prototype.Xi=function(t){return null!==this.K&&void 0!==this.K.Vi&&0!==this.K.Vi.length&&w(this.K.Vi[0],t)},t.prototype.Ji=function(){return null===this.K?{Zt:0,Dt:0}:this.Gi()},t.prototype.Qi=function(){if(null===this.K)return{vt:0,dt:0,Zt:0,Dt:0};var t=this.tn();return{vt:t.nn,dt:t.sn,Zt:t.hn,Dt:t.rn}},t.prototype.en=function(t,i){if(null===this.K||void 0===this.K.Vi||0===this.K.Vi.length)return!0;var n=this.tn();if(n.nn+n.hn<0||n.nn>t){var s=new r(new h(0,0),new h(t,i));return this.Zi().every((function(t){return!w(t,s)}))}return!1},t.prototype.un=function(t,i){E(this.K).Vi=t,this.zi=i||new Jt(Xt.MovePoint)},t.prototype.on=function(){return null===this.K?"":this.ln().on},t.prototype.an=function(t,i,n){return function(t,i,n){ni||hi();n="[object String]"===Object.prototype.toString.call(n)?parseInt(n):n,t+="";var s=!Number.isInteger(n)||!isFinite(n)||n<=0?t.split(/\r\n|\r|\n|$/):t.split(/[^\S\r\n]*(?:\r\n|\r|\n|$)/);s[s.length-1]||s.pop();if(!Number.isInteger(n)||!isFinite(n)||n<=0)return s;ni.font=i;for(var h=[],r=0;r<s.length;r++){var e=s[r],u=ni.measureText(e).width;if(u<=n)h.push(e);else for(var o=e.split(/([-)\]},.!?:;])|(\s+)/);o.length;){var l=Math.floor(n/u*(o.length+2)/3);if(l<=0||ni.measureText(o.slice(0,3*l-1).join("")).width<=n)for(;ni.measureText(o.slice(0,3*(l+1)-1).join("")).width<=n;)l++;else for(;l>0&&ni.measureText(o.slice(0,3*--l-1).join("")).width>n;);if(l>0)h.push(o.slice(0,3*l-1).join("")),o.splice(0,3*l);else{var a=o[0]+(o[1]||""),f=Math.floor(n/ni.measureText(a).width*a.length);if(ni.measureText(a.substring(0,f)).width<=n)for(;ni.measureText(a.substring(0,f+1)).width<=n;)f++;else for(;f>1&&ni.measureText(a.substring(0,--f)).width>n;);f=Math.max(1,f),h.push(a.substring(0,f)),o[0]=a.substring(f),o[1]=""}if(ni.measureText(o.join("")).width<=n){h.push(o.join(""));break}}}return h}(t,n||this.on(),i)},t.prototype.draw=function(t,i){var n,s,h,r,e,u,o,l,a,f,c,v,d,_,w,M,b,m,p,y,k,x,C,N,S,T,A,L,E,B,D;if(null!==this.K&&void 0!==this.K.Vi&&0!==this.K.Vi.length&&!this.en(i.cssWidth,i.cssHeight)){var F=this.K.At,P=i.pixelRatio,W=this.tn(),R=this.fn().scaled(P);t.save(),t.translate(R.x,R.y),t.rotate((null===(n=F.box)||void 0===n?void 0:n.angle)||0),t.translate(-R.x,-R.y);var z=this.ln().cn;t.textAlign=W.vn,t.textBaseline="middle",t.font=this.on();var O=Math.round(W.sn*P),V=Math.round(W.nn*P),I=V+Math.round(W.hn*P),H=O+Math.round(W.rn*P);if((null===(h=null===(s=F.box)||void 0===s?void 0:s.background)||void 0===h?void 0:h.color)||(null===(e=null===(r=F.box)||void 0===r?void 0:r.border)||void 0===e?void 0:e.color)||(null===(o=null===(u=F.box)||void 0===u?void 0:u.border)||void 0===o?void 0:o.highlight)&&F.wordWrapWidth){var j=Math.round(((null===(a=null===(l=F.box)||void 0===l?void 0:l.border)||void 0===a?void 0:a.width)||Math.max(z/12,1))*P),U=j/2,q=!1;if(null===(f=F.box)||void 0===f?void 0:f.shadow){var Y=null===(c=F.box)||void 0===c?void 0:c.shadow,$=Y.color,K=Y.blur,Z=Y.offset;t.save(),t.shadowColor=$,t.shadowBlur=K,t.shadowOffsetX=(null==Z?void 0:Z.x)||0,t.shadowOffsetY=(null==Z?void 0:Z.y)||0,q=!0}if(null===(v=F.box.border)||void 0===v?void 0:v.radius){if(null===(d=F.box.background)||void 0===d?void 0:d.color){var X=(null===(w=null===(_=F.box)||void 0===_?void 0:_.border)||void 0===w?void 0:w.radius)*P;ii(t,V,O,I-V,H-O,X),t.fillStyle=null===(b=null===(M=F.box)||void 0===M?void 0:M.background)||void 0===b?void 0:b.color,t.fill(),q&&(t.restore(),q=!1)}if(null===(m=F.box.border)||void 0===m?void 0:m.color){X=(null===(y=null===(p=F.box)||void 0===p?void 0:p.border)||void 0===y?void 0:y.radius)*P+j;ii(t,V-U,O-U,I-V+j,H-O+j,X),t.strokeStyle=F.box.border.color,t.lineWidth=j,q&&(t.restore(),q=!1)}}else if(null===(k=F.box.background)||void 0===k?void 0:k.color)t.fillStyle=F.box.background.color,t.fillRect(V,O,I-V,H-O),q&&(t.restore(),q=!1);else if((null===(C=null===(x=F.box)||void 0===x?void 0:x.border)||void 0===C?void 0:C.color)||(null===(S=null===(N=F.box)||void 0===N?void 0:N.border)||void 0===S?void 0:S.highlight)){var J=void 0;(null===(A=null===(T=F.box)||void 0===T?void 0:T.border)||void 0===A?void 0:A.color)?(t.strokeStyle=null===(E=null===(L=F.box)||void 0===L?void 0:L.border)||void 0===E?void 0:E.color,J=j):(t.strokeStyle=null===(B=F.font)||void 0===B?void 0:B.color,g(t,2),J=Math.max(1,Math.floor(P))),t.lineWidth=J,t.beginPath(),t.moveTo(V-J/2,O-J/2),t.lineTo(V-J/2,H+J/2),t.lineTo(I+J/2,H+J/2),t.lineTo(I+J/2,O-J/2),t.lineTo(V-J/2,O-J/2),t.stroke(),q&&t.restore()}}t.fillStyle=null===(D=F.font)||void 0===D?void 0:D.color;for(var G=this._n().dn,Q=.05*z,tt=ci(this.K),it=(V+Math.round(W.wn*P))/P,nt=(O+Math.round((W.Mn+Q)*P))/P,st=function(i){wt(t,P,(function(){return t.fillText(i,it,nt)})),nt+=z+tt},ht=0,rt=G;ht<rt.length;ht++){st(rt[ht])}t.restore()}},t.prototype.tn=function(){var t,i,n,s,h,r,e,u,o,l,a,f,c,v,d,_,w,M,b,m,p;if(null!==this.Ui)return this.Ui;var g=E(this.K),y=li(g),k=oi(g),x=fi(g)+y,C=ai(g)+k,N=L(g.Vi)[0],S=this.Gi(),T=S.Zt,A=S.Dt,B=N.y,D=N.x;switch(null===(n=null===(i=null===(t=g.At)||void 0===t?void 0:t.box)||void 0===i?void 0:i.alignment)||void 0===n?void 0:n.vertical){case"bottom":B-=A+((null===(r=null===(h=null===(s=g.At)||void 0===s?void 0:s.box)||void 0===h?void 0:h.offset)||void 0===r?void 0:r.y)||0);break;case"middle":B-=A/2;break;case"top":B+=(null===(o=null===(u=null===(e=g.At)||void 0===e?void 0:e.box)||void 0===u?void 0:u.offset)||void 0===o?void 0:o.y)||0}var F=B+C+vi(g)/2,P="start",W=0;switch(null===(f=null===(a=null===(l=g.At)||void 0===l?void 0:l.box)||void 0===a?void 0:a.alignment)||void 0===f?void 0:f.horizontal){case"left":D+=(null===(d=null===(v=null===(c=g.At)||void 0===c?void 0:c.box)||void 0===v?void 0:v.offset)||void 0===d?void 0:d.x)||0;break;case"center":D-=T/2;break;case"right":D-=T+((null===(M=null===(w=null===(_=g.At)||void 0===_?void 0:_.box)||void 0===w?void 0:w.offset)||void 0===M?void 0:M.x)||0)}switch(L(null===(b=g.At)||void 0===b?void 0:b.alignment)){case"left":P="start",W=D+x,wi()&&((null===(m=g.At)||void 0===m?void 0:m.forceTextAlign)?P="left":(W=D+T-x,P="right"));break;case"center":P="center",W=D+T/2;break;case"right":P="end",W=D+T-x,wi()&&(null===(p=g.At)||void 0===p?void 0:p.forceTextAlign)&&(P="right")}return this.Ui={nn:D,sn:B,hn:T,rn:A,vn:P,Mn:F-B,wn:W-D},this.Ui},t.prototype.bn=function(t){var i,n,s;if(ni||hi(),ni.textBaseline="alphabetic",ni.font=this.on(),null!==this.K&&(null===(i=this.K.At)||void 0===i?void 0:i.wordWrapWidth)&&!(null===(n=this.K.At)||void 0===n?void 0:n.forceCalculateMaxLineWidth))return(null===(s=this.K.At)||void 0===s?void 0:s.wordWrapWidth)*_i(this.K);for(var h=0,r=0,e=t;r<e.length;r++){var u=e[r];h=Math.max(h,ni.measureText(u).width)}return h},t.prototype._n=function(){var t,i,n,s,h,r;if(null===this.Yi){var e=E(this.K),u=this.an((null===(t=e.At)||void 0===t?void 0:t.value)||"",null===(i=e.At)||void 0===i?void 0:i.wordWrapWidth);if(void 0!==(null===(s=null===(n=e.At)||void 0===n?void 0:n.box)||void 0===s?void 0:s.maxHeight)){var o=L(null===(r=null===(h=e.At)||void 0===h?void 0:h.box)||void 0===r?void 0:r.maxHeight),l=vi(e),a=ci(e),f=Math.floor((o+a)/(l+a));u.length>f&&(u=u.slice(0,f))}this.Yi={mn:this.bn(u),dn:u}}return this.Yi},t.prototype.ln=function(){var t,i,n,s,h,r;if(null===this.$i){var e=E(this.K),u=vi(e),o=((null===(i=null===(t=e.At)||void 0===t?void 0:t.font)||void 0===i?void 0:i.bold)?"bold ":"")+((null===(s=null===(n=e.At)||void 0===n?void 0:n.font)||void 0===s?void 0:s.italic)?"italic ":"")+u+"px "+(null===(r=null===(h=e.At)||void 0===h?void 0:h.font)||void 0===r?void 0:r.family);this.$i={on:o,cn:u}}return this.$i},t.prototype.Gi=function(){if(null===this.Ki){var t=this._n(),i=E(this.K);this.Ki={Zt:ei(i,t.mn),Dt:ui(i,t.dn.length)}}return this.Ki},t.prototype.Zi=function(){var t,i;if(null!==this.qi)return this.qi;if(null===this.K)return[];var n=this.tn(),s=n.nn,r=n.sn,e=n.hn,u=n.rn,o=this.fn(),l=(null===(i=null===(t=this.K.At)||void 0===t?void 0:t.box)||void 0===i?void 0:i.angle)||0;return this.qi=[ri(new h(s,r),o,l),ri(new h(s+e,r),o,l),ri(new h(s+e,r+u),o,l),ri(new h(s,r+u),o,l)],this.qi},t.prototype.fn=function(){var t,i,n,s=this.tn(),r=s.nn,e=s.sn,u=s.hn,o=s.rn,l=L(null===(n=null===(i=null===(t=this.K)||void 0===t?void 0:t.At)||void 0===i?void 0:i.box)||void 0===n?void 0:n.alignment),a=l.horizontal,f=l.vertical,c=0,v=0;switch(a){case"center":c=r+u/2;break;case"left":c=r;break;case"right":c=r+u}switch(f){case"middle":v=e+o/2;break;case"top":v=e;break;case"bottom":v=e+o}return new h(c,v)},t}();function hi(){var t=document.createElement("canvas");t.width=0,t.height=0,ni=E(t.getContext("2d"))}function ri(t,i,n){if(0===n)return t.clone();var s=(t.x-i.x)*Math.cos(n)-(t.y-i.y)*Math.sin(n)+i.x,r=(t.x-i.x)*Math.sin(n)+(t.y-i.y)*Math.cos(n)+i.y;return new h(s,r)}function ei(t,i){return i+2*fi(t)+2*li(t)}function ui(t,i){return vi(t)*i+ci(t)*(i-1)+2*ai(t)+2*oi(t)}function oi(t){var i,n,s,h,r,e;return void 0!==(null===(s=null===(n=null===(i=t.At)||void 0===i?void 0:i.box)||void 0===n?void 0:n.padding)||void 0===s?void 0:s.y)?(null===(e=null===(r=null===(h=t.At)||void 0===h?void 0:h.box)||void 0===r?void 0:r.padding)||void 0===e?void 0:e.y)*_i(t):vi(t)/3}function li(t){var i,n,s,h,r,e;return(null===(s=null===(n=null===(i=t.At)||void 0===i?void 0:i.box)||void 0===n?void 0:n.padding)||void 0===s?void 0:s.x)?(null===(e=null===(r=null===(h=t.At)||void 0===h?void 0:h.box)||void 0===r?void 0:r.padding)||void 0===e?void 0:e.x)*_i(t):vi(t)/3}function ai(t){var i,n,s,h;return((null===(h=null===(s=null===(n=null===(i=t.At)||void 0===i?void 0:i.box)||void 0===n?void 0:n.background)||void 0===s?void 0:s.inflation)||void 0===h?void 0:h.y)||0)*_i(t)}function fi(t){var i,n,s,h;return((null===(h=null===(s=null===(n=null===(i=t.At)||void 0===i?void 0:i.box)||void 0===n?void 0:n.background)||void 0===s?void 0:s.inflation)||void 0===h?void 0:h.x)||0)*_i(t)}function ci(t){var i;return((null===(i=t.At)||void 0===i?void 0:i.padding)||0)*_i(t)}function vi(t){return Math.ceil(di(t)*_i(t))}function di(t){var i,n;return(null===(n=null===(i=t.At)||void 0===i?void 0:i.font)||void 0===n?void 0:n.size)||30}function _i(t){var i,n,s=Math.min(1,Math.max(.2,(null===(n=null===(i=t.At)||void 0===i?void 0:i.box)||void 0===n?void 0:n.scale)||1));if(1===s)return s;var h=di(t);return Math.ceil(s*h)/h}function wi(){return"rtl"===window.document.dir}var Mi=function(){function t(){this.ot=null}return t.prototype.Z=function(t){this.ot=t},t.prototype.draw=function(t,i){var n=this;if(null!==this.ot){var s=i.pixelRatio,h=Math.max(1,Math.floor(s));t.lineWidth=h;var r=Math.ceil(this.ot.wt*s),e=Math.ceil(this.ot._t*s);!function(t,i){t.save(),t.lineWidth%2&&t.translate(.5,.5),i(),t.restore()}(t,(function(){var i=E(n.ot);if(i.pn){t.strokeStyle=i.gn,g(t,i.yn),t.beginPath();for(var u=0,o=i.kn;u<o.length;u++){var l=o[u],a=Math.round(l.xn*s);t.moveTo(a,-h),t.lineTo(a,r+h)}t.stroke()}if(i.Cn){t.strokeStyle=i.Nn,g(t,i.Sn),t.beginPath();for(var f=0,c=i.Tn;f<c.length;f++){var v=c[f],d=Math.round(v.coord*s);t.moveTo(-h,d),t.lineTo(e+h,d)}t.stroke()}}))}},t}(),bi=function(){function t(t){this.kt=new Mi,this.Rt=!0,this.ui=t}return t.prototype.update=function(){this.Rt=!0},t.prototype.renderer=function(t,i){if(this.Rt){var n=this.ui.model().options().grid,s={wt:t,_t:i,Cn:n.horzLines.visible,pn:n.vertLines.visible,Nn:n.horzLines.color,gn:n.vertLines.color,Sn:n.horzLines.style,yn:n.vertLines.style,Tn:this.ui.defaultPriceScale().marks(),kn:this.ui.model().timeScale().marks()||[]};this.kt.Z(s),this.Rt=!1}return this.kt},t}(),mi=function(){function t(t){this.ki=new bi(t)}return t.prototype.paneView=function(){return this.ki},t}(),pi=".";function gi(t,i){if(!Z(t))return"n/a";if(!X(i))throw new TypeError("invalid length");if(i<0||i>16)throw new TypeError("invalid length");if(0===i)return t.toString();return("0000000000000000"+t.toString()).slice(-i)}var yi=function(){function t(t,i){if(i||(i=1),Z(t)&&X(t)||(t=100),t<0)throw new TypeError("invalid base");this.Yt=t,this.An=i,this.Ln()}return t.prototype.format=function(t){var i=t<0?"−":"";return t=Math.abs(t),i+this.En(t)},t.prototype.Ln=function(){if(this.Bn=0,this.Yt>0&&this.An>0)for(var t=this.Yt;t>1;)t/=10,this.Bn++},t.prototype.En=function(t){var i=this.Yt/this.An,n=Math.floor(t),s="",h=void 0!==this.Bn?this.Bn:NaN;if(i>1){var r=+(Math.round(t*i)-n*i).toFixed(this.Bn);r>=i&&(r-=i,n+=1),s=pi+gi(+r.toFixed(this.Bn)*this.An,h)}else n=Math.round(n*i)/i,h>0&&(s=pi+gi(0,h));return n.toFixed(0)+s},t}(),ki=function(t){function i(i){return void 0===i&&(i=100),t.call(this,i)||this}return U(i,t),i.prototype.format=function(i){return"".concat(t.prototype.format.call(this,i),"%")},i}(yi),xi=function(){function t(t,i){this.Dn=t,this.Fn=i}return t.prototype.equals=function(t){return null!==t&&(this.Dn===t.Dn&&this.Fn===t.Fn)},t.prototype.clone=function(){return new t(this.Dn,this.Fn)},t.prototype.minValue=function(){return this.Dn},t.prototype.maxValue=function(){return this.Fn},t.prototype.length=function(){return this.Fn-this.Dn},t.prototype.isEmpty=function(){return this.Fn===this.Dn||Number.isNaN(this.Fn)||Number.isNaN(this.Dn)},t.prototype.merge=function(i){return null===i?this:new t(Math.min(this.minValue(),i.minValue()),Math.max(this.maxValue(),i.maxValue()))},t.prototype.scaleAroundCenter=function(t){if(Z(t)&&0!==this.Fn-this.Dn){var i=.5*(this.Fn+this.Dn),n=this.Fn-i,s=this.Dn-i;n*=t,s*=t,this.Fn=i+n,this.Dn=i+s}},t.prototype.shift=function(t){Z(t)&&(this.Fn+=t,this.Dn+=t)},t.prototype.toRaw=function(){return{minValue:this.Dn,maxValue:this.Fn}},t.fromRaw=function(i){return null===i?null:new t(i.minValue,i.maxValue)},t}();function Ci(t,i,n){return Math.min(Math.max(t,i),n)}function Ni(t,i,n){return i-t<=n}function Si(t){return t<=0?NaN:Math.log(t)/Math.log(10)}function Ti(t){var i=Math.ceil(t);return i%2!=0?i-1:i}function Ai(t){var i=Math.ceil(t);return i%2==0?i-1:i}var Li={logicalOffset:4,coordOffset:1e-4};function Ei(t,i){var n=100*(t-i)/i;return i<0?-n:n}function Bi(t,i){var n=Ei(t.minValue(),i),s=Ei(t.maxValue(),i);return new xi(n,s)}function Di(t,i){var n=100*(t-i)/i+100;return i<0?-n:n}function Fi(t,i){var n=Di(t.minValue(),i),s=Di(t.maxValue(),i);return new xi(n,s)}function Pi(t,i){var n=Math.abs(t);if(n<1e-15)return 0;var s=Si(n+i.coordOffset)+i.logicalOffset;return t<0?-s:s}function Wi(t,i){var n=Math.abs(t);if(n<1e-15)return 0;var s=Math.pow(10,n-i.logicalOffset)-i.coordOffset;return t<0?-s:s}function Ri(t,i){if(null===t)return null;var n=Pi(t.minValue(),i),s=Pi(t.maxValue(),i);return new xi(n,s)}function zi(t,i){if(null===t)return null;var n=Wi(t.minValue(),i),s=Wi(t.maxValue(),i);return new xi(n,s)}function Oi(t){if(null===t)return Li;var i=Math.abs(t.maxValue()-t.minValue());if(i>=1||i<1e-15)return Li;var n=Math.ceil(Math.abs(Math.log10(i))),s=Li.logicalOffset+n;return{logicalOffset:s,coordOffset:1/Math.pow(10,s)}}var Vi,Ii=function(){function t(t,i){if(this.Pn=t,this.Wn=i,function(t){if(t<0)return!1;for(var i=t;i>1;i/=10)if(i%10!=0)return!1;return!0}(this.Pn))this.Rn=[2,2.5,2];else{this.Rn=[];for(var n=this.Pn;1!==n;){if(n%2==0)this.Rn.push(2),n/=2;else{if(n%5!=0)throw new Error("unexpected base");this.Rn.push(2,2.5),n/=5}if(this.Rn.length>100)throw new Error("something wrong with base")}}}return t.prototype.zn=function(t,i,n){for(var s,h,r,e=0===this.Pn?0:1/this.Pn,u=Math.pow(10,Math.max(0,Math.ceil(Si(t-i)))),o=0,l=this.Wn[0];;){var a=Ni(u,e,1e-14)&&u>e+1e-14,f=Ni(u,n*l,1e-14),c=Ni(u,1,1e-14);if(!(a&&f&&c))break;u/=l,l=this.Wn[++o%this.Wn.length]}if(u<=e+1e-14&&(u=e),u=Math.max(1,u),this.Rn.length>0&&(s=u,h=1,r=1e-14,Math.abs(s-h)<r))for(o=0,l=this.Rn[0];Ni(u,n*l,1e-14)&&u>e+1e-14;)u/=l,l=this.Rn[++o%this.Rn.length];return u},t}(),Hi=function(){function t(t,i,n,s){this.On=[],this.Yt=t,this.Pn=i,this.Vn=n,this.In=s}return t.prototype.zn=function(t,i){if(t<i)throw new Error("high < low");var n=this.Yt.height(),s=(t-i)*this.Hn()/n,h=new Ii(this.Pn,[2,2.5,2]),r=new Ii(this.Pn,[2,2,2.5]),e=new Ii(this.Pn,[2.5,2,2]),u=[];return u.push(h.zn(t,i,s),r.zn(t,i,s),e.zn(t,i,s)),function(t){if(t.length<1)throw Error("array is empty");for(var i=t[0],n=1;n<t.length;++n)t[n]<i&&(i=t[n]);return i}(u)},t.prototype.jn=function(){var t=this.Yt,i=t.firstValue();if(null!==i){var n=t.height(),s=this.Vn(n-1,i),h=this.Vn(0,i),r=this.Yt.options().entireTextOnly?this.Un()/2:0,e=r,u=n-1-r,o=Math.max(s,h),l=Math.min(s,h);if(o!==l){for(var a=this.zn(o,l),f=o%a,c=o>=l?1:-1,v=null,d=0,_=o-(f+=f<0?a:0);_>l;_-=a){var w=this.In(_,i,!0);null!==v&&Math.abs(w-v)<this.Hn()||(w<e||w>u||(d<this.On.length?(this.On[d].coord=w,this.On[d].label=t.formatLogical(_)):this.On.push({coord:w,label:t.formatLogical(_)}),d++,v=w,t.isLog()&&(a=this.zn(_*c,l))))}this.On.length=d}else this.On=[]}else this.On=[]},t.prototype.qn=function(){return this.On},t.prototype.Un=function(){return this.Yt.fontSize()},t.prototype.Hn=function(){return Math.ceil(2.5*this.Un())},t}();function ji(t){return t.slice().sort((function(t,i){return E(t.zorder())-E(i.zorder())}))}!function(t){t[t.Normal=0]="Normal",t[t.Logarithmic=1]="Logarithmic",t[t.Percentage=2]="Percentage",t[t.IndexedTo100=3]="IndexedTo100"}(Vi||(Vi={}));var Ui,qi=new ki,Yi=new yi(100,1),$i=function(){function t(t,i,n,s){this.Yn=0,this.$n=null,this.Kn=null,this.Zn=null,this.Xn={Jn:!1,Gn:null},this.Qn=0,this.ts=0,this.ns=new $,this.ss=new $,this.hs=[],this.rs=null,this.es=null,this.us=null,this.os=null,this.ls=Yi,this.fs=Oi(null),this.ri=t,this.bi=i,this.cs=n,this.vs=s,this.ds=new Hi(this,100,this._s.bind(this),this.ws.bind(this))}return t.prototype.id=function(){return this.ri},t.prototype.options=function(){return this.bi},t.prototype.applyOptions=function(t){if(K(this.bi,t),this.updateFormatter(),void 0!==t.mode&&this.setMode({mode:t.mode}),void 0!==t.scaleMargins){var i=L(t.scaleMargins.top),n=L(t.scaleMargins.bottom);if(i<0||i>1)throw new Error("Invalid top margin - expect value between 0 and 1, given=".concat(i));if(n<0||n>1||i+n>1)throw new Error("Invalid bottom margin - expect value between 0 and 1, given=".concat(n));if(i+n>1)throw new Error("Invalid margins - sum of margins must be less than 1, given=".concat(i+n));this.Ms(),this.es=null}},t.prototype.isAutoScale=function(){return this.bi.autoScale},t.prototype.isLog=function(){return 1===this.bi.mode},t.prototype.isPercentage=function(){return 2===this.bi.mode},t.prototype.isIndexedTo100=function(){return 3===this.bi.mode},t.prototype.mode=function(){return{autoScale:this.bi.autoScale,isInverted:this.bi.invertScale,mode:this.bi.mode}},t.prototype.setMode=function(t){var i=this.mode(),n=null;void 0!==t.autoScale&&(this.bi.autoScale=t.autoScale),void 0!==t.mode&&(this.bi.mode=t.mode,2!==t.mode&&3!==t.mode||(this.bi.autoScale=!0),this.Xn.Jn=!1),1===i.mode&&t.mode!==i.mode&&(!function(t,i){if(null===t)return!1;var n=Wi(t.minValue(),i),s=Wi(t.maxValue(),i);return isFinite(n)&&isFinite(s)}(this.Kn,this.fs)?this.bi.autoScale=!0:null!==(n=zi(this.Kn,this.fs))&&this.setPriceRange(n)),1===t.mode&&t.mode!==i.mode&&null!==(n=Ri(this.Kn,this.fs))&&this.setPriceRange(n);var s=i.mode!==this.bi.mode;s&&(2===i.mode||this.isPercentage())&&this.updateFormatter(),s&&(3===i.mode||this.isIndexedTo100())&&this.updateFormatter(),void 0!==t.isInverted&&i.isInverted!==t.isInverted&&(this.bi.invertScale=t.isInverted,this.bs()),this.ss.fire(i,this.mode())},t.prototype.modeChanged=function(){return this.ss},t.prototype.fontSize=function(){return this.cs.fontSize},t.prototype.height=function(){return this.Yn},t.prototype.setHeight=function(t){this.Yn!==t&&(this.Yn=t,this.Ms(),this.es=null)},t.prototype.internalHeight=function(){if(this.$n)return this.$n;var t=this.height()-this.ps()-this.gs();return this.$n=t,t},t.prototype.priceRange=function(){return this.ys(),this.Kn},t.prototype.logFormula=function(){return this.fs},t.prototype.setPriceRange=function(t,i){var n=this.Kn;(i||null===n&&null!==t||null!==n&&!n.equals(t))&&(this.es=null,this.Kn=t)},t.prototype.isEmpty=function(){return this.ys(),0===this.Yn||!this.Kn||this.Kn.isEmpty()},t.prototype.invertedCoordinate=function(t){return this.isInverted()?t:this.height()-1-t},t.prototype.priceToCoordinate=function(t,i){return this.isPercentage()?t=Ei(t,i):this.isIndexedTo100()&&(t=Di(t,i)),this.ws(t,i)},t.prototype.pointsArrayToCoordinates=function(t,i,n){this.ys();for(var s=this.gs(),h=E(this.priceRange()),r=h.minValue(),e=h.maxValue(),u=this.internalHeight()-1,o=this.isInverted(),l=u/(e-r),a=void 0===n?0:n.from,f=void 0===n?t.length:n.to,c=this.ks(),v=a;v<f;v++){var d=t[v],_=d.price;if(!isNaN(_)){var w=_;null!==c&&(w=c(d.price,i));var M=s+l*(w-r),b=o?M:this.Yn-1-M;d.y=b}}},t.prototype.cloudPointsArrayToCoordinates=function(t,i,n){this.ys();for(var s=this.gs(),h=E(this.priceRange()),r=h.minValue(),e=h.maxValue(),u=this.internalHeight()-1,o=this.isInverted(),l=u/(e-r),a=void 0===n?0:n.from,f=void 0===n?t.length:n.to,c=this.ks(),v=a;v<f;v++){var d=t[v],_=d.higherPrice,w=d.lowerPrice;if(!isNaN(_)&&!isNaN(w)){var M=_,b=w;null!==c&&(M=c(d.higherPrice,i),b=c(d.lowerPrice,i));var m=s+l*(M-r),p=o?m:this.Yn-1-m;d.higherY=p,m=s+l*(b-r),p=o?m:this.Yn-1-m,d.lowerY=p}}},t.prototype.barPricesToCoordinates=function(t,i,n){this.ys();for(var s=this.gs(),h=E(this.priceRange()),r=h.minValue(),e=h.maxValue(),u=this.internalHeight()-1,o=this.isInverted(),l=u/(e-r),a=void 0===n?0:n.from,f=void 0===n?t.length:n.to,c=this.ks(),v=a;v<f;v++){var d=t[v],_=d.open,w=d.high,M=d.low,b=d.close;null!==c&&(_=c(d.open,i),w=c(d.high,i),M=c(d.low,i),b=c(d.close,i));var m=s+l*(_-r),p=o?m:this.Yn-1-m;d.openY=p,m=s+l*(w-r),p=o?m:this.Yn-1-m,d.highY=p,m=s+l*(M-r),p=o?m:this.Yn-1-m,d.lowY=p,m=s+l*(b-r),p=o?m:this.Yn-1-m,d.closeY=p}},t.prototype.coordinateToPrice=function(t,i){var n=this._s(t,i);return this.logicalToPrice(n,i)},t.prototype.logicalToPrice=function(t,i){var n=t;return this.isPercentage()?n=function(t,i){return i<0&&(t=-t),t/100*i+i}(n,i):this.isIndexedTo100()&&(n=function(t,i){return t-=100,i<0&&(t=-t),t/100*i+i}(n,i)),n},t.prototype.dataSources=function(){return this.hs},t.prototype.orderedSources=function(){if(this.rs)return this.rs;for(var t=[],i=0;i<this.hs.length;i++){var n=this.hs[i];null===n.zorder()&&n.setZorder(i+1),t.push(n)}return t=ji(t),this.rs=t,this.rs},t.prototype.addDataSource=function(t){-1===this.hs.indexOf(t)&&(this.hs.push(t),this.updateFormatter(),this.invalidateSourcesCache())},t.prototype.removeDataSource=function(t){var i=this.hs.indexOf(t);if(-1===i)throw new Error("source is not attached to scale");this.hs.splice(i,1),0===this.hs.length&&(this.setMode({autoScale:!0}),this.setPriceRange(null)),this.updateFormatter(),this.invalidateSourcesCache()},t.prototype.firstValue=function(){for(var t,i=null,n=0,s=this.hs;n<s.length;n++){var h=s[n],r=null===(t=h.firstValue)||void 0===t?void 0:t.bind(h).call(this);r&&((null===i||r.timePoint<i.timePoint)&&(i=r))}return null===i?null:i.value},t.prototype.isInverted=function(){return this.bi.invertScale},t.prototype.marks=function(){var t=null===this.firstValue();if(null!==this.es&&(t||this.es.xs===t))return this.es.qn;this.ds.jn();var i=this.ds.qn();return this.es={qn:i,xs:t},this.ns.fire(),i},t.prototype.onMarksChanged=function(){return this.ns},t.prototype.startScale=function(t){this.isPercentage()||this.isIndexedTo100()||null===this.us&&null===this.Zn&&(this.isEmpty()||(this.us=this.Yn-t,this.Zn=E(this.priceRange()).clone()))},t.prototype.scaleTo=function(t){if(!this.isPercentage()&&!this.isIndexedTo100()&&null!==this.us){this.setMode({autoScale:!1}),(t=this.Yn-t)<0&&(t=0);var i=(this.us+.2*(this.Yn-1))/(t+.2*(this.Yn-1)),n=E(this.Zn).clone();i=Math.max(i,.1),n.scaleAroundCenter(i),this.setPriceRange(n)}},t.prototype.endScale=function(){this.isPercentage()||this.isIndexedTo100()||(this.us=null,this.Zn=null)},t.prototype.startScroll=function(t){this.isAutoScale()||null===this.os&&null===this.Zn&&(this.isEmpty()||(this.os=t,this.Zn=E(this.priceRange()).clone()))},t.prototype.scrollTo=function(t){if(!this.isAutoScale()&&null!==this.os){var i=E(this.priceRange()).length()/(this.internalHeight()-1),n=t-this.os;this.isInverted()&&(n*=-1);var s=n*i,h=E(this.Zn).clone();h.shift(s),this.setPriceRange(h,!0),this.es=null}},t.prototype.endScroll=function(){this.isAutoScale()||null!==this.os&&(this.os=null,this.Zn=null)},t.prototype.formatter=function(){return this.ls||this.updateFormatter(),this.ls},t.prototype.formatPrice=function(t,i){switch(this.bi.mode){case 2:return this.formatter().format(Ei(t,i));case 3:return this.formatter().format(Di(t,i));default:return this.Cs(t)}},t.prototype.formatLogical=function(t){switch(this.bi.mode){case 2:case 3:return this.formatter().format(t);default:return this.Cs(t)}},t.prototype.formatPriceAbsolute=function(t){return this.Cs(t,E(this.Ns()).formatter())},t.prototype.formatPricePercentage=function(t,i){return t=Ei(t,i),qi.format(t)},t.prototype.sourcesForAutoScale=function(){return this.hs},t.prototype.recalculatePriceRange=function(t){this.Xn={Gn:t,Jn:!1}},t.prototype.updateAllViews=function(){this.hs.forEach((function(t){return t.updateAllViews()}))},t.prototype.updateFormatter=function(){this.es=null;var t=this.Ns(),i=100;null!==t&&(i=Math.round(1/t.minMove())),this.ls=Yi,this.isPercentage()?(this.ls=qi,i=100):this.isIndexedTo100()?(this.ls=new yi(100,1),i=100):null!==t&&(this.ls=t.formatter()),this.ds=new Hi(this,i,this._s.bind(this),this.ws.bind(this)),this.ds.jn()},t.prototype.invalidateSourcesCache=function(){this.rs=null},t.prototype.Ns=function(){return this.hs[0]||null},t.prototype.ps=function(){return this.isInverted()?this.bi.scaleMargins.bottom*this.height()+this.ts:this.bi.scaleMargins.top*this.height()+this.Qn},t.prototype.gs=function(){return this.isInverted()?this.bi.scaleMargins.top*this.height()+this.Qn:this.bi.scaleMargins.bottom*this.height()+this.ts},t.prototype.ys=function(){this.Xn.Jn||(this.Xn.Jn=!0,this.Ss())},t.prototype.Ms=function(){this.$n=null},t.prototype.ws=function(t,i){if(this.ys(),this.isEmpty())return 0;t=this.isLog()&&t?Pi(t,this.fs):t;var n=E(this.priceRange()),s=this.gs()+(this.internalHeight()-1)*(t-n.minValue())/n.length();return this.invertedCoordinate(s)},t.prototype._s=function(t,i){if(this.ys(),this.isEmpty())return 0;var n=this.invertedCoordinate(t),s=E(this.priceRange()),h=s.minValue()+s.length()*((n-this.gs())/(this.internalHeight()-1));return this.isLog()?Wi(h,this.fs):h},t.prototype.bs=function(){this.es=null,this.ds.jn()},t.prototype.Ss=function(){var t=this.Xn.Gn;if(null!==t){for(var i,n,s=null,h=0,r=0,e=0,u=this.sourcesForAutoScale();e<u.length;e++){var o=u[e];if(o.visible()&&o.firstValue){var l=o.firstValue();if(null!==l){var a=o.autoscaleInfo(t.left(),t.right()),f=a&&a.priceRange();if(null!==f){switch(this.bi.mode){case 1:f=Ri(f,this.fs);break;case 2:f=Bi(f,l.value);break;case 3:f=Fi(f,l.value)}if(s=null===s?f:s.merge(E(f)),null!==a){var c=a.margins();null!==c&&(h=Math.max(h,c.above),r=Math.max(h,c.below))}}}}}if(h===this.Qn&&r===this.ts||(this.Qn=h,this.ts=r,this.es=null,this.Ms()),null!==s){if(s.minValue()===s.maxValue()){var v=this.Ns(),d=5*(null===v||this.isPercentage()||this.isIndexedTo100()?1:v.minMove());this.isLog()&&(s=zi(s,this.fs)),s=new xi(s.minValue()-d,s.maxValue()+d),this.isLog()&&(s=Ri(s,this.fs))}if(this.isLog()){var _=zi(s,this.fs),w=Oi(_);if(i=w,n=this.fs,i.logicalOffset!==n.logicalOffset||i.coordOffset!==n.coordOffset){var M=null!==this.Zn?zi(this.Zn,this.fs):null;this.fs=w,s=Ri(_,w),null!==M&&(this.Zn=Ri(M,w))}}this.setPriceRange(s)}else null===this.Kn&&(this.setPriceRange(new xi(-.5,.5)),this.fs=Oi(null));this.Xn.Jn=!0}},t.prototype.ks=function(){var t=this;return this.isPercentage()?Ei:this.isIndexedTo100()?Di:this.isLog()?function(i){return Pi(i,t.fs)}:null},t.prototype.Cs=function(t,i){return void 0===this.vs.priceFormatter?(void 0===i&&(i=this.formatter()),i.format(t)):this.vs.priceFormatter(t)},t}();!function(t){t.Default="default",t.Crosshair="crosshair",t.Pointer="pointer",t.Grabbing="grabbing",t.ZoomIn="zoom-in",t.VerticalResize="n-resize",t.HorizontalResize="e-resize",t.DiagonalNeSwResize="nesw-resize",t.DiagonalNwSeResize="nwse-resize"}(Ui||(Ui={}));var Ki=function(){function t(t,i,n){void 0===n&&(n=0),this.hs=[],this.Ts=new Map,this.Yn=0,this.As=0,this.Ls=1e3,this.rs=null,this.Es=new $,this.Bs=t,this.Mi=i,this.Ds=new mi(this);var s=i.options();this.Fs=this.Ps("left",s.leftPriceScale),this.Ws=0===n?this.Ps("right",s.rightPriceScale):this.Ps("non-primary",s.nonPrimaryPriceScale),this.Fs.modeChanged().subscribe(this.Rs.bind(this,this.Fs),this),this.Ws.modeChanged().subscribe(this.Rs.bind(this,this.Ws),this),this.applyScaleOptions(s)}return t.prototype.applyScaleOptions=function(t){if(t.leftPriceScale&&this.Fs.applyOptions(t.leftPriceScale),"right"===this.Ws.id()&&t.rightPriceScale&&this.Ws.applyOptions(t.rightPriceScale),"non-primary"===this.Ws.id()&&t.nonPrimaryPriceScale&&this.Ws.applyOptions(t.nonPrimaryPriceScale),t.localization&&(this.Fs.updateFormatter(),this.Ws.updateFormatter()),t.overlayPriceScales)for(var i=0,n=Array.from(this.Ts.values());i<n.length;i++){var s=E(n[i][0].priceScale());s.applyOptions(t.overlayPriceScales),t.localization&&s.updateFormatter()}},t.prototype.priceScaleById=function(t){switch(t){case"left":return this.Fs;case"right":return this.Ws}return this.Ts.has(t)?L(this.Ts.get(t))[0].priceScale():null},t.prototype.destroy=function(){this.model().priceScalesOptionsChanged().unsubscribeAll(this),this.Fs.modeChanged().unsubscribeAll(this),this.Ws.modeChanged().unsubscribeAll(this),this.hs.forEach((function(t){t.destroy&&t.destroy()})),this.Es.fire()},t.prototype.stretchFactor=function(){return this.Ls},t.prototype.setStretchFactor=function(t){this.Ls=t},t.prototype.model=function(){return this.Mi},t.prototype.width=function(){return this.As},t.prototype.height=function(){return this.Yn},t.prototype.setWidth=function(t){this.As=t,this.updateAllSources()},t.prototype.setHeight=function(t){var i=this;this.Yn=t,this.Fs.setHeight(t),this.Ws.setHeight(t),this.hs.forEach((function(n){if(i.isOverlay(n)){var s=n.priceScale();null!==s&&s.setHeight(t)}})),this.updateAllSources()},t.prototype.dataSources=function(){return this.hs},t.prototype.isOverlay=function(t){var i=t.priceScale();return null===i||this.Fs!==i&&this.Ws!==i},t.prototype.addDataSource=function(t,i,n){var s=void 0!==n?n:this.Os().zs+1;this.Vs(t,i,s)},t.prototype.removeDataSource=function(t){var i=this.hs.indexOf(t);A(-1!==i,"removeDataSource: invalid data source"),this.hs.splice(i,1);var n=E(t.priceScale()).id();if(this.Ts.has(n)){var s=L(this.Ts.get(n)),h=s.indexOf(t);-1!==h&&(s.splice(h,1),0===s.length&&this.Ts.delete(n))}var r=t.priceScale();r&&r.dataSources().indexOf(t)>=0&&r.removeDataSource(t),null!==r&&(r.invalidateSourcesCache(),this.recalculatePriceScale(r)),this.rs=null},t.prototype.priceScalePosition=function(t){return t===this.Fs?"left":t===this.Ws?"right":"overlay"},t.prototype.leftPriceScale=function(){return this.Fs},t.prototype.rightPriceScale=function(){return this.Ws},t.prototype.startScalePrice=function(t,i){t.startScale(i)},t.prototype.scalePriceTo=function(t,i){t.scaleTo(i),this.updateAllSources()},t.prototype.endScalePrice=function(t){t.endScale()},t.prototype.startScrollPrice=function(t,i){t.startScroll(i)},t.prototype.scrollPriceTo=function(t,i){t.scrollTo(i),this.updateAllSources()},t.prototype.endScrollPrice=function(t){t.endScroll()},t.prototype.updateAllSources=function(){this.hs.forEach((function(t){t.updateAllViews()}))},t.prototype.defaultPriceScale=function(){var t=null;return this.Mi.options().rightPriceScale.visible&&0!==this.Ws.dataSources().length?t=this.Ws:this.Mi.options().leftPriceScale.visible&&0!==this.Fs.dataSources().length?t=this.Fs:0!==this.hs.length&&(t=this.hs[0].priceScale()),null===t&&(t=this.Ws),t},t.prototype.defaultVisiblePriceScale=function(){var t=null;return this.Mi.options().rightPriceScale.visible?t=this.Ws:this.Mi.options().leftPriceScale.visible&&(t=this.Fs),t},t.prototype.recalculatePriceScale=function(t){null!==t&&t.isAutoScale()&&this.Is(t)},t.prototype.resetPriceScale=function(t){var i=this.Bs.visibleStrictRange();t.setMode({autoScale:!0}),null!==i&&t.recalculatePriceRange(i),this.updateAllSources()},t.prototype.momentaryAutoScale=function(){this.Is(this.Fs),this.Is(this.Ws)},t.prototype.recalculate=function(){var t=this;this.recalculatePriceScale(this.Fs),this.recalculatePriceScale(this.Ws),this.hs.forEach((function(i){t.isOverlay(i)&&t.recalculatePriceScale(i.priceScale())})),this.updateAllSources(),this.Mi.lightUpdate()},t.prototype.orderedSources=function(){return null===this.rs&&(this.rs=ji(this.hs)),this.rs},t.prototype.onDestroyed=function(){return this.Es},t.prototype.grid=function(){return this.Ds},t.prototype.Is=function(t){var i=t.sourcesForAutoScale();if(i&&i.length>0&&!this.Bs.isEmpty()){var n=this.Bs.visibleStrictRange();null!==n&&t.recalculatePriceRange(n)}t.updateAllViews()},t.prototype.Os=function(){var t=this.orderedSources();if(0===t.length)return{Hs:0,zs:0};for(var i=0,n=0,s=0;s<t.length;s++){var h=t[s].zorder();null!==h&&(h<i&&(i=h),h>n&&(n=h))}return{Hs:i,zs:n}},t.prototype.Vs=function(t,i,n){var s=this.priceScaleById(i);if(null===s&&(s=this.Ps(i,this.Mi.options().overlayPriceScales)),this.hs.push(t),!Lt(i)){var h=this.Ts.get(i)||[];h.push(t),this.Ts.set(i,h)}void 0!==t.seriesType&&"BrokenArea"===t.seriesType()||s.addDataSource(t),t.setPriceScale(s),t.setZorder(n),this.recalculatePriceScale(s),this.rs=null},t.prototype.Rs=function(t,i,n){i.mode!==n.mode&&this.Is(t)},t.prototype.Ps=function(t,i){var n=q({visible:!0,autoScale:!0},Q(i)),s=new $i(t,n,this.Mi.options().layout,this.Mi.options().localization);return s.setHeight(this.height()),s},t}(),Zi=function(t){function i(i,n,s,h){var r=t.call(this,i,n)||this;return r.js=s,r.Us=h,r}return U(i,t),i.prototype.clone=function(){return new i(this.x,this.y,this.js,this.Us)},i}(h),Xi=function(){function t(t){this.K=void 0!==t?t:null}return t.prototype.Z=function(t){this.K=t},t.prototype.qs=function(t){this.K=K(this.K,t)},t.prototype.draw=function(t,i){if(null!==this.K&&this.K.lt){for(var n=[],s=[],h=[],r=[],e=i.pixelRatio,u=0;u<this.K.Vi.length;++u){var o=this.K.Vi[u],l=this.K.Ys[u];o.Us?(n.push(o),s.push(l)):(h.push(o),r.push(l))}t.strokeStyle=this.K.bt,n.length&&this.$s(t,e,n,s,Qi,Gi),h.length&&this.$s(t,e,h,r,nn,tn)}},t.prototype.hitTest=function(t){if(null===this.K)return null;for(var i=0;i<this.K.Vi.length;++i){var n=this.K.Vi[i];if(n.subtract(t).length()<=this.K.tt+Qt){var s=void 0!==this.K.Ks?this.K.Ks[i]:Ui.Default,h=n.js;return new Jt(this.K.Zs,{Xs:h,Js:s})}}return null},t.prototype.$s=function(t,i,n,s,h,r){var e=E(this.K),u=e.Gs,o=Math.max(1,Math.floor((e.Qs||2)*i));e.th&&(o+=Math.max(1,Math.floor(i/2)));var l=Math.max(1,Math.floor(i)),a=Math.round(e.tt*i*2);i%2!=l%2&&(a+=1);for(var f=l%2/2,c=0;c<n.length;++c){var v=n[c];if(t.fillStyle=s[c],!Number.isInteger(v.js)||e.ih!==v.js){var d=Math.round(v.x*i)+f,_=Math.round(v.y*i)+f;if(h(t,new Zi(d,_,v.js,v.Us),a/2,o),v.subtract(u).length()<=e.tt+Qt){var w=Math.max(1,Math.floor(e.nh*i));r(t,new Zi(d,_,v.js,v.Us),a/2,w)}}}},t}();function Ji(t,i,n,s){t.lineWidth=s;var h=n+s/2;ii(t,i.x-h,i.y-h,2*h,2*h,(n+s)/2),t.closePath()}function Gi(t,i,n,s){t.globalAlpha=.2,Ji(t,i,n,s),t.stroke(),t.globalAlpha=1}function Qi(t,i,n,s){Ji(t,i,n-s,s),t.fill(),t.stroke()}function tn(t,i,n,s){t.lineWidth=s,t.globalAlpha=.2,t.beginPath(),t.arc(i.x,i.y,n+s/2,0,2*Math.PI,!0),t.closePath(),t.stroke(),t.globalAlpha=1}function nn(t,i,n,s){t.lineWidth=s,t.beginPath(),t.arc(i.x,i.y,n-s/2,0,2*Math.PI,!0),t.closePath(),t.fill(),t.stroke()}var sn=function(){function t(t,i){this.sh=[],this.Jt=!0,this.hh=null,this.rh=null,this.eh=[],this.Xt=null,this.Di=t,this.Qt=i}return t.prototype.onInputEvent=function(t,i,n){if(n&&(this.Xt&&this.Xt.hitTest||!this.Di.finished())){var s=this.Qt.crosshairSource(),r=new h(s.appliedX(),s.appliedY()),e=new h(s.originCoordX(),s.originCoordY()),u=11!==i||n.consumed?9===i?this.uh(t,e,r,n):6===i?this.oh(t,e,r,n):10===i&&this.lh():this.ah(t,e,r);n.consumed||(n.consumed=this.Di.editing()||!this.Di.finished()),(u||this.Di.hovered()||this.Di.editing()||!this.Di.finished())&&this.fh()}},t.prototype.renderer=function(t,i,n){return this.Jt&&this.ti(t,i),this.Di.visible()?this.Xt:null},t.prototype.dh=function(t){var i=this.Di.priceScale(),n=this.Di.ownerSource();if(null===i)return null;var s=null!==n?n.firstValue():null;return null===s?null:i.priceToCoordinate(t,s.value)},t.prototype.Gs=function(){var t=this.Qt.crosshairSource();return new h(t.originCoordX(),t.originCoordY())},t.prototype.ih=function(){return this.Di.editing()?this.rh:null},t.prototype._h=function(){return this.Di.hovered()||this.Di.selected()||this.Di.editing()||!this.Di.finished()},t.prototype.update=function(){this.Jt=!0},t.prototype.wh=function(t){t.H(this.Mh({Vi:this.sh},0))},t.prototype.fh=function(){var t=this;this.eh.forEach((function(i){i.qs({Vi:t.sh,th:t.Di.selected(),lt:t._h(),Gs:t.Gs(),ih:t.ih()})})),this.Qt.updateSource(this.Di),this.Di.updateAllViews()},t.prototype.Mh=function(t,i){var n=this.bh(i);return n.Z(q(q({},t),{tt:6,Qs:1,bt:"#1E53E5",nh:4,th:this.Di.selected(),lt:this._h(),Gs:this.Gs(),Ys:this.mh(t.Vi),ih:this.Di.editing()?this.ih():null,Zs:Xt.ChangePoint})),n},t.prototype.lh=function(){if(this.Di.finished()){if(this.Di.editing())return this.Qt.magnet().disable(),this.ph(),this.hh=null,this.rh=null,this.Di.setEditing(!1),!0}else this.Di.tryFinish();return!1},t.prototype.ah=function(t,i,n){var s;if(!this.Di.finished())return this.Di.lineDrawnWithPressedButton()&&this.Di.addPoint(this.Di.screenPointToPoint(n)),!1;if(!this.Di.selected())return!1;if(this.Di.editing()){if(t.setCursor(null!==this.rh?Ui.Default:Ui.Grabbing),null!==this.rh)this.Di.setPoint(this.rh,this.Di.screenPointToPoint(n));else if(this.hh){var h=n.subtract(this.hh);this.sh.forEach((function(t){t.x=t.x+h.x,t.y=t.y+h.y})),this.hh=n,this.ph()}}else{var r=this.zi(t,i),e=null==r?void 0:r.data();this.Di.setEditing(this.Di.hovered()||!!r),this.hh=n,this.rh=null!==(s=null==e?void 0:e.Xs)&&void 0!==s?s:this.rh,e&&this.Qt.magnet().enable()}return!1},t.prototype.uh=function(t,i,n,s){var h,r,e;if(this.Di.finished()){var u=this.zi(t,i),o=this.Di.setHovered(null!==u&&!s.consumed);return this.Di.hovered()&&!s.consumed&&(t.setCursor((null===(h=null==u?void 0:u.data())||void 0===h?void 0:h.Js)||Ui.Pointer),this.rh=null!==(e=null===(r=null==u?void 0:u.data())||void 0===r?void 0:r.Xs)&&void 0!==e?e:null),o}return this.Di.hasMagnet()&&this.Qt.magnet().enable(),this.Di.setLastPoint(this.Di.screenPointToPoint(n)),!1},t.prototype.oh=function(t,i,n,s){if(this.Di.finished()){var h=this.zi(t,i);return this.Di.setSelected(null!==h&&!s.consumed)}return this.Di.addPoint(this.Di.screenPointToPoint(n)),!1},t.prototype.ph=function(){var t=this;this.Di.setPoints(this.sh.map((function(i){return t.Di.screenPointToPoint(i)})))},t.prototype.zi=function(t,i){var n;if(!(null===(n=this.Xt)||void 0===n?void 0:n.hitTest))return null;var s=t.canvasRenderParams();return this.Xt.hitTest(i,s)},t.prototype.mh=function(t){var i=this,n=E(this.Qt.paneForSource(this.Di)).height();return t.map((function(t){return i.Qt.backgroundColorAtYPercentFromTop(t.y/n)}))},t.prototype.ti=function(t,i){if(this.Jt=!1,!this.Qt.timeScale().isEmpty()&&this.gh()){this.sh=[];for(var n=this.Di.points(),s=0;s<n.length;s++){var h=this.Di.pointToScreenPoint(n[s]);if(!h)return;h.js=s,this.sh.push(h)}}},t.prototype.gh=function(){var t=this.Di.priceScale();return null!==t&&!t.isEmpty()},t.prototype.bh=function(t){for(;this.eh.length<=t;)this.eh.push(new Xi);return this.eh[t]},t}(),hn=function(t){function i(i,n){var s=t.call(this,i,n)||this;return s.yh=new ti,s.kh=new si,s.Xt=null,s}return U(i,t),i.prototype.ti=function(){this.Xt=null,this.Jt=!1;var i=this.Di.priceScale(),n=this.Qt.timeScale();if(i&&!i.isEmpty()&&!n.isEmpty()){var s=n.visibleTimeRange();if(null!==s){var r=this.Di.points();if(!(r.length<2)){var e=this.Di.options();if(!(Math.max(r[0].timestamp,r[1].timestamp)<s.from.timestamp)||e.line.extend.left||e.line.extend.right){if(t.prototype.ti.call(this),this.sh.length<2)return;var u=new ut;if(this.yh.Z({Ii:e.line,Vi:this.sh}),u.H(this.yh),e.text.value){var o=this.sh[0],l=this.sh[1],a=o.x<l.x?o:l,f=a===o?l:o,c=Math.atan((f.y-a.y)/(f.x-a.x)),v=e.text.box.alignment.horizontal,d="left"===v?a.clone():"right"===v?f.clone():new h((o.x+l.x)/2,(o.y+l.y)/2),_=Zt(e.text);_.box=q(q({},_.box),{angle:c}),this.kh.Z({At:_,Vi:[d]}),u.H(this.kh)}this.wh(u),this.Xt=u}}}}},i}(sn),rn=function(t){function i(i,n,s){void 0===s&&(s=[]);var h=t.call(this,i,n,s)||this;return h._toolType="TrendLine",h._setPaneViews([new hn(h,i)]),h}return U(i,t),i.prototype.pointsCount=function(){return 2},i}(Kt),en=function(t){function i(){var i=null!==t&&t.apply(this,arguments)||this;return i._toolType="Arrow",i}return U(i,t),i}(rn),un=function(t){function i(i){var n=t.call(this)||this;return n.xh=new Jt(Xt.MovePointBackground),n.zi=i||new Jt(Xt.MovePoint),n.K=null,n}return U(i,t),i.prototype.Z=function(t){this.K=t},i.prototype.hitTest=function(t){if(null===this.K)return null;var i=this.K.Ii.width||1,n=Math.max(Gt,Math.ceil(i/2)),s=this.K.Vi.length;if(1===s)return function(t,i,n){return(t.x-i.x)*(t.x-i.x)+(t.y-i.y)*(t.y-i.y)<=n*n}(t,this.K.Vi[0],n)?this.zi:null;for(var h=1;h<s;h++)if(_(this.K.Vi[h-1],this.K.Vi[h],t).M<=n)return this.zi;return this.K.p&&s>0&&_(this.K.Vi[0],this.K.Vi[s-1],t).M<=n?this.zi:this.K.p&&M(t,this.K.Vi)?this.xh:null},i.prototype.Y=function(t,i){var n,s;if(null!==this.K&&this.K.Vi){var h=this.K.Vi.length,r=this.K.Ii.style||0,e=this.K.Ii.join||"round",u=this.K.Ii.cap||"butt",o=this.K.Ii.color||"white",l=this.K.Ii.width||1;if(1===h)return this.Ch(t,this.K.Vi[0],h/2,o);t.beginPath(),t.lineCap=u,t.lineJoin=e,t.lineWidth=l,t.strokeStyle=o,g(t,r),t.moveTo(this.K.Vi[0].x,this.K.Vi[0].y);for(var a=0,f=this.K.Vi;a<f.length;a++){var c=f[a];t.lineTo(c.x,c.y)}if(this.K.p&&(t.fillStyle=this.K.p.color,t.fill()),l>0&&t.stroke(),h>1){var v;if("butt"!==u&&(t.lineCap="butt"),1===(null===(n=this.K.Ii.end)||void 0===n?void 0:n.left))T((v=this.Nh(this.K.Vi[1],this.K.Vi[0],l,u))[0],v[1],t,l,1);if(1===(null===(s=this.K.Ii.end)||void 0===s?void 0:s.right))T((v=this.Nh(this.K.Vi[h-2],this.K.Vi[h-1],l,u))[0],v[1],t,l,1)}}},i.prototype.Ch=function(t,i,n,s){0===n&&(t.beginPath(),t.fillStyle=s,t.arc(i.x,i.y,n,0,2*Math.PI,!0),t.fill(),t.closePath())},i.prototype.Nh=function(t,i,n,s){var h=i.subtract(t),r=h.length();if("butt"===s||r<1)return[t,i];var e=r+n/2;return[t,h.scaled(e/r).add(t)]},i}(ot),on=function(t){function i(i,n){var s=t.call(this,i,n)||this;return s.Sh=new un,s.Xt=null,s}return U(i,t),i.prototype.ti=function(){if(t.prototype.ti.call(this),this.Xt=null,0!==this.sh.length){for(var i=this.Di.Th(),n=Math.max(1,this.Di.Ah()),s=[this.sh[0]],h=1;h<this.sh.length;h++){for(var r=this.sh[h].subtract(this.sh[h-1]),e=r.length(),u=Math.min(5,Math.floor(e/n)),o=r.normalized().scaled(e/u),l=0;l<u-1;l++)s.push(this.sh[h-1].add(o.scaled(l)));s.push(this.sh[h])}var a=this.Lh(s,n);this.Sh.Z({Ii:i.line,p:i.background,Vi:a});var f=new ut;f.H(this.Sh),this.Xt=f}},i.prototype.Lh=function(t,i){var n=new Array(t.length);if(1===t.length)return t;for(var s=0;s<t.length;s++){for(var r=new h(0,0),e=0;e<i;e++){var u=Math.max(s-e,0),o=Math.min(s+e,t.length-1);r=(r=r.add(t[u])).add(t[o])}n[s]=r.scaled(.5/i)}return n.push(t[t.length-1]),n},i}(sn),ln=function(t){function i(i,n,s){void 0===s&&(s=[]);var h=t.call(this,i,n,s)||this;return h._toolType="Brush",h._setPaneViews([new on(h,i)]),h}return U(i,t),i.prototype.pointsCount=function(){return-1},i.prototype.Ah=function(){return 5},i.prototype.Th=function(){return this.options()},i.prototype.addPoint=function(i){if(!this._finished){if(this._lastPoint=null,this._points.length>0){var n=this._points[this._points.length-1],s=E(this.pointToScreenPoint(n));if(E(this.pointToScreenPoint(i)).subtract(s).length()<2)return}return t.prototype.addPoint.call(this,i)}},i.prototype.hasMagnet=function(){return!1},i.prototype.lineDrawnWithPressedButton=function(){return!0},i}(Kt),an=function(t){function i(i,n){var s=t.call(this,i,n)||this;return s.Eh=new ti,s.Bh=new ti,s.Xt=null,s.Eh.Oi(new Jt(Xt.MovePoint)),s.Bh.Oi(new Jt(Xt.MovePoint)),s}return U(i,t),i.prototype.ti=function(i,n){this.Xt=null;var s=this.Di.priceScale(),h=this.Qt.timeScale();if(s&&!s.isEmpty()&&!h.isEmpty()&&!(this.Di.points().length<1)){t.prototype.ti.call(this);var r=this.Di.options();if(!(this.sh.length<1)){var e=this.sh[0],u=new Zi(e.x,i,0),o=new Zi(e.x,0,1),l=new Zi(0,e.y,0),a=new Zi(n,e.y,1),f={Dh:!1,Fh:!1},c={Dh:0,Fh:0},v=new ut;this.Eh.Z({Ii:q(q({},Zt(r.line)),{end:c,extend:f}),Vi:[u,o]}),this.Bh.Z({Ii:q(q({},Zt(r.line)),{end:c,extend:f}),Vi:[l,a]}),v.H(this.Eh),v.H(this.Bh),this.wh(v),this.Xt=v}}},i}(sn),fn=function(t){function i(i,n,s){void 0===s&&(s=[]);var h=t.call(this,i,n,s)||this;return h._toolType="CrossLine",h._setPaneViews([new an(h,i)]),h}return U(i,t),i.prototype.pointsCount=function(){return 1},i.prototype.timeAxisLabelColor=function(){return this.options().line.color},i.prototype.priceAxisLabelColor=function(){return this.options().line.color},i}(Kt),cn=function(t){function i(){var i=null!==t&&t.apply(this,arguments)||this;return i._toolType="ExtendedLine",i}return U(i,t),i}(rn),vn=function(){function t(t,i){this.xh=i||new Jt(Xt.MovePointBackground),this.zi=t||new Jt(Xt.MovePoint),this.K=null}return t.prototype.Z=function(t){this.K=t},t.prototype.Ph=function(t,i){if(null===this.K||this.K.points.length<2)return null;var n=new h(t.x*i.pixelRatio,t.y*i.pixelRatio),s=this.Wh(i),r=s[0],e=s[1],u=new h(e.x,r.y),o=new h(r.x,e.y),l=this.Rh(n,r,u,i);if(null!==l)return l;var a=this.Rh(n,o,e,i);if(null!==a)return a;if(_(u,e,n).M<=3)return this.zi;if(_(r,o,n).M<=3)return this.zi;var f=this.zh(n,r,e,i);return this.K.hitTestBackground&&null!==f?f:null},t.prototype.Oh=function(t,i){var n,s,r,e,u,o,l,a=(null===(s=null===(n=this.K)||void 0===n?void 0:n.border)||void 0===s?void 0:s.width)||0,f=null===(e=null===(r=this.K)||void 0===r?void 0:r.border)||void 0===e?void 0:e.color,c=null===(o=null===(u=this.K)||void 0===u?void 0:u.background)||void 0===o?void 0:o.color;if(!(null===this.K||this.K.points.length<2||a<=0&&!c)){t.save();var v=a?Math.max(1,Math.floor(a*i.pixelRatio)):0,d=(null===(l=this.K.border)||void 0===l?void 0:l.style)||0,_=this.Wh(i),w=_[0],M=_[1],b=this.K.extend||{};!function(t,i,n,s,r,e,u,o,l,a,f){void 0===e&&(e=0);var c=l?0:i.x,v=a?f:n.x;if(void 0!==s&&(t.fillStyle=s,t.fillRect(c,i.y,v-c,n.y-i.y)),void 0!==r&&e>0){t.beginPath(),g(t,u||0);var d=new h(0,0),_=new h(0,0),w=new h(0,0),M=new h(0,0);switch(o){case"outer":w=new h(0,p=.5*e),M=new h(0,p),d=new h(p,-e),_=new h(p,-e);break;case"center":var b=e%2?.5:0,m=e%2?.5:1;w=new h((p=.5*e)-b,-b),M=new h(m+p,-b),d=new h(-b,b+p),_=new h(m,b+p);break;case"inner":var p;w=new h(0,-(p=.5*e)),M=new h(1,-p),d=new h(-p,e),_=new h(1-p,e)}t.lineWidth=e,t.strokeStyle=r,t.moveTo(c-w.x,i.y-w.y),t.lineTo(v+M.x,i.y-M.y),t.moveTo(n.x+_.x,i.y+_.y),t.lineTo(n.x+_.x,n.y-_.y),t.moveTo(c-w.x,n.y+w.y),t.lineTo(v+M.x,n.y+M.y),t.moveTo(i.x-d.x,i.y+d.y),t.lineTo(i.x-d.x,n.y-d.y),t.stroke()}}(t,w,M,c,f,v,d,"center",!!b.left,!!b.right,i.physicalWidth),t.restore()}},t.prototype.Wh=function(t){var i=E(this.K).points,n=i[0],s=i[1],r=t.pixelRatio,e=Math.min(n.x,s.x),u=Math.max(n.x,s.x),o=Math.min(n.y,s.y),l=Math.max(n.y,s.y),a=Math.round(e*r),f=Math.round(u*r),c=Math.round(o*r),v=Math.round(l*r);return[new h(a,c),new h(f,v)]},t.prototype.Vh=function(t,i,n){var s,r,e=E(this.K);if(u(t,i))return null;var o=n.physicalWidth,l=Math.min(t.x,i.x),a=Math.max(t.x,i.x),f=(null===(s=e.extend)||void 0===s?void 0:s.left)?0:Math.max(l,0),c=(null===(r=e.extend)||void 0===r?void 0:r.right)?o:Math.min(a,o);return f>c||c<=0||f>=o?null:[new h(f,t.y),new h(c,i.y)]},t.prototype.Rh=function(t,i,n,s){var h=this.Vh(i,n,s);return null!==h&&_(h[0],h[1],t).M<=3?this.zi:null},t.prototype.zh=function(t,i,n,s){var h=this.Vh(i,n,s);return null!==h&&w(t,new r(h[0],h[1]))?this.xh:null},t}(),dn=function(t){function i(i,n){var s=t.call(this,i,n)||this;return s.Ih=[],s.Hh=[],s.jh=[],s.Xt=null,s}return U(i,t),i.prototype.ti=function(){this.Xt=null,this.Jt=!1;var i=this.Di.priceScale(),n=this.Qt.timeScale();if(i&&!i.isEmpty()&&!n.isEmpty()){var s=n.visibleTimeRange();if(null!==s){var h=this.Di.points();if(!(h.length<2)){var r=this.Di.options();if(!(Math.max(h[0].timestamp,h[1].timestamp)<s.from.timestamp)||r.extend.left||r.extend.right){if(t.prototype.ti.call(this),this.sh.length<2)return;for(var e=new ut,u=Math.min(this.sh[0].x,this.sh[1].x),o=Math.max(this.sh[0].x,this.sh[1].x),l=this.Uh(this.Di.points()[0].price,this.Di.points()[1].price,r.levels),a=0,f=-1;a<l.length;a++,f++){this.jh[a]||(this.jh.push(new ti),this.Hh.push(new si));var c=[new Zi(u,l[a].Lt,0),new Zi(o,l[a].Lt,0)];this.jh[a].Z({Ii:q(q({},r.line),{extend:r.extend,color:r.levels[a].color}),Vi:c}),this.Hh[a].Z({At:{alignment:"right",value:"".concat(r.levels[a].coeff,"(").concat(l[a].Kt,")"),font:{color:r.levels[a].color,size:11,family:nt},box:{alignment:{horizontal:"right",vertical:"middle"}}},Vi:c}),e.H(this.Hh[a]),e.H(this.jh[a]),f<0||(this.Ih[f]||this.Ih.push(new vn),this.Ih[f].Z(q(q({},r.line),{extend:r.extend,background:{color:I(r.levels[a].color,.2)},points:[new Zi(u,l[a-1].Lt,0),new Zi(o,l[a].Lt,0)]})),e.H(this.Ih[f]))}this.wh(e),this.Xt=e}}}}},i.prototype.Uh=function(t,i,n){var s,h,r=(null===(h=null===(s=this.Di.ownerSource())||void 0===s?void 0:s.firstValue())||void 0===h?void 0:h.value)||0,e=this.Di.priceScale(),u=i-t;return e&&r?n.map((function(t){var n=i-t.coeff*u;return{Lt:e.priceToCoordinate(n,r),Kt:e.formatPrice(n,r)}})):[]},i}(sn),_n=function(t){function i(i,n,s){void 0===s&&(s=[]);var h=t.call(this,i,n,s)||this;return h._toolType="FibRetracement",h._setPaneViews([new dn(h,i)]),h}return U(i,t),i.prototype.pointsCount=function(){return 2},i}(Kt),wn=function(t){function i(){var i=null!==t&&t.apply(this,arguments)||this;return i._toolType="Highlighter",i}return U(i,t),i.prototype.Th=function(){var t=this.options();return{visible:t.visible,line:{width:20,cap:"round",join:"round",style:0,color:t.line.color,end:{left:0,right:0}}}},i}(ln),Mn=function(t){function i(i,n){var s=t.call(this,i,n)||this;return s.yh=new ti,s.kh=new si,s.Xt=null,s.yh.Oi(new Jt(Xt.MovePoint)),s}return U(i,t),i.prototype.ti=function(i,n){this.Xt=null;var s=this.Di.priceScale(),r=this.Qt.timeScale();if(s&&!s.isEmpty()&&!r.isEmpty()){var e=this.Di.points();if(!(e.length<1)){var u=r.coordinateToTime(0),o=r.coordinateToTime(n),l=this.Di.options(),a=l.line.extend||{},f=a.left,c=a.right;if(!(!f&&e[0].timestamp>o.timestamp||!c&&e[0].timestamp<u.timestamp)){if(t.prototype.ti.call(this),this.sh.length<1)return;var v=this.sh[0],d=new Zi(f?0:v.x,v.y,0),_=new Zi(c?n:v.x,v.y,1);if(Math.floor(d.x)===Math.floor(_.x)||Math.max(d.x,_.x)<=0||_.x<d.x)return;f&&c&&(v.x=n/2,v.Us=!0);var w=new ut;if(this.yh.Z({Ii:q(q({},Zt(l.line)),{end:{Dh:0,Fh:0}}),Vi:[d,_]}),w.H(this.yh),l.text.value){var M=Math.atan((_.y-d.y)/(_.x-d.x)),b=l.text.box.alignment.horizontal,m="left"===b?d.clone():"right"===b?_.clone():new h((d.x+_.x)/2,(d.y+_.y)/2),p=Zt(l.text);p.box=q(q({},p.box),{angle:M}),this.kh.Z({At:p,Vi:[m]}),w.H(this.kh)}this.wh(w),this.Xt=w}}}},i}(sn),bn=function(t){function i(i,n,s){void 0===s&&(s=[]);var h=t.call(this,i,n,s)||this;return h._toolType="HorizontalLine",h._setPaneViews([new Mn(h,i)]),h}return U(i,t),i.prototype.pointsCount=function(){return 1},i.prototype.timeAxisViews=function(){return[]},i.prototype.timeAxisPoints=function(){return[]},i.prototype.priceAxisLabelColor=function(){return this.options().line.color},i}(Kt),mn=function(t){function i(){var i=null!==t&&t.apply(this,arguments)||this;return i._toolType="HorizontalRay",i}return U(i,t),i}(bn),pn=function(t){function i(i,n){var s=t.call(this)||this;return s.xh=n||new Jt(Xt.MovePointBackground),s.zi=i||new Jt(Xt.MovePoint),s.K=null,s}return U(i,t),i.prototype.Z=function(t){this.K=t},i.prototype.hitTest=function(t,i){if(null===this.K||this.K.points.length<2)return null;var n=this.K.points,s=n[0],h=n[1],r=this.Rh(t,s,h,i);if(null!==r)return r;if(4===this.K.points.length){var e=this.K.points,u=e[2],o=e[3],l=this.Rh(t,u,o,i);if(null!==l)return l;if(this.K.showMiddleLine){var a=s.add(u).scaled(.5),f=h.add(o).scaled(.5),c=this.Rh(t,a,f,i);if(null!==c)return c}}return this.K.hitTestBackground?this.zh(t):null},i.prototype.Y=function(t,i){var n,s,h,r,e,u;if(!(null===this.K||this.K.points.length<2)){g(t,(null===(n=this.K.channelLine)||void 0===n?void 0:n.style)||0),t.strokeStyle=(null===(s=this.K.channelLine)||void 0===s?void 0:s.color)||"transparent",t.lineWidth=(null===(h=this.K.channelLine)||void 0===h?void 0:h.width)||0,t.lineCap="butt";var o=this.K.points,l=o[0],a=o[1];if(this.qh(t,l,a,i),4===this.K.points.length){var f=this.K.points,c=f[2],v=f[3];if(this.qh(t,c,v,i),this.Yh(t,this.K.points,i),this.K.showMiddleLine){g(t,(null===(r=this.K.middleLine)||void 0===r?void 0:r.style)||0),t.strokeStyle=(null===(e=this.K.middleLine)||void 0===e?void 0:e.color)||"transparent",t.lineWidth=(null===(u=this.K.middleLine)||void 0===u?void 0:u.width)||0;var d=l.add(c).scaled(.5),_=a.add(v).scaled(.5);this.qh(t,d,_,i)}}}},i.prototype.qh=function(t,i,n,s){var h=this.Vh(i,n,s);null!==h&&C(t,h[0].x,h[0].y,h[1].x,h[1].y)},i.prototype.Rh=function(t,i,n,s){var h=this.Vh(i,n,s);return null!==h&&_(h[0],h[1],t).M<=3?this.zi:null},i.prototype.Vh=function(t,i,n){var s,h,r=E(this.K);return N(t,i,n.cssWidth,n.cssHeight,!!(null===(s=r.extend)||void 0===s?void 0:s.left),!!(null===(h=r.extend)||void 0===h?void 0:h.right))},i.prototype.Yh=function(t,i,n){var s,r,e,o,l,a,f=E(this.K),c=i[0],v=i[1],_=i[2],w=i[3];if(!u(c,v)&&!u(_,w)&&!(n.cssWidth<=0||n.cssHeight<=0||d(c,v,_).M<1e-6||d(c,v,w).M<1e-6)){var M=n.cssWidth,b=n.cssHeight,m=[new h(0,0),new h(M,0),new h(M,b),new h(0,b)];if(m=this.$h(m,c,v,w),(null===(s=f.extend)||void 0===s?void 0:s.right)||(m=this.$h(m,v,w,_)),m=this.$h(m,w,_,c),(null===(r=f.extend)||void 0===r?void 0:r.left)||(m=this.$h(m,_,c,v)),null!==m){t.beginPath(),t.moveTo(m[0].x,m[0].y);for(var p=1;p<m.length;p++)t.lineTo(m[p].x,m[p].y);t.fillStyle=(null===(o=null===(e=this.K)||void 0===e?void 0:e.background)||void 0===o?void 0:o.color)||"transparent",(null===(a=null===(l=this.K)||void 0===l?void 0:l.background)||void 0===a?void 0:a.color)&&t.fill()}}},i.prototype.zh=function(t){var i,n,s=E(this.K);if(4!==s.points.length)return null;var h=s.points,r=h[0],e=h[1],u=h[2],o=(e.y-r.y)/(e.x-r.x),l=u.y+o*(t.x-u.x),a=r.y+o*(t.x-r.x),f=Math.max(a,l),c=Math.min(a,l),v=Math.max(r.x,e.x),d=Math.min(r.x,e.x);return!(null===(i=s.extend)||void 0===i?void 0:i.left)&&t.x<d||!(null===(n=s.extend)||void 0===n?void 0:n.right)&&t.x>v?null:t.y>=c&&t.y<=f?this.xh:null},i.prototype.$h=function(t,i,n,s){return null!==t?function(t,i){for(var n=[],s=0;s<t.length;++s){var h=t[s],r=t[(s+1)%t.length],e=o(h,r);if(a(h,i))m(n,h),a(r,i)||null!==(u=b(e,i.u))&&m(n,u);else if(a(r,i)){var u;null!==(u=b(e,i.u))&&m(n,u)}}return n.length>=3?n:null}(t,(h=o(i,n),r=s,new e(h,h.l*r.x+h.v*r.y+h._>0))):null;var h,r},i}(ot),gn=[Ui.Default,Ui.Default,Ui.Default,Ui.Default,Ui.VerticalResize,Ui.VerticalResize],yn=function(t){function i(i,n){var s=t.call(this,i,n)||this;return s.Kh=new pn,s.Xt=null,s}return U(i,t),i.prototype.ti=function(){t.prototype.ti.call(this),this.Xt=null;var i=this.Di.priceScale();if(i&&!i.isEmpty()&&0!==this.Di.points().length&&!(this.sh.length<=1)){var n=this.sh[0],s=this.sh[1],h=null,r=null;if(3===this.sh.length){var e=this.sh[2].y-this.sh[0].y;h=new Zi(n.x,n.y+e,2),r=new Zi(s.x,s.y+e,3)}var u=h&&r?[n,s,h,r]:[n,s],o=this.Di.options();this.Kh.Z(q(q({},Zt(o)),{points:u,hitTestBackground:!1}));var l=new ut;l.H(this.Kh);var a=[];if(this.sh[0]&&a.push(new Zi(n.x,n.y,0)),this.sh[1]&&a.push(new Zi(s.x,s.y,1)),h&&r){a.push(new Zi(h.x,h.y,2),new Zi(r.x,r.y,3));var f=h.add(r).scaled(.5);f.js=4,f.Us=!0,a.push(f);var c=a[0].add(a[1]).scaled(.5);c.Us=!0,c.js=5,a.push(c)}var v={Vi:a,Ks:gn};l.H(this.Mh(v,0)),this.Xt=l}},i}(sn),kn=function(t){function i(i,n,s){void 0===s&&(s=[]);var h=t.call(this,i,n,s)||this;return h._toolType="ParallelChannel",h._priceAxisViews.push(new Ut(h,3)),h._setPaneViews([new yn(h,i)]),h}return U(i,t),i.prototype.pointsCount=function(){return 3},i.prototype.addPoint=function(i){2===this._points.length?t.prototype.addPoint.call(this,this.Zh(i)):t.prototype.addPoint.call(this,i)},i.prototype.points=function(){var i=t.prototype.points.call(this);return 3!==i.length||this.finished()?i:[i[0],i[1],this.Zh(i[2])]},i.prototype.setPoint=function(i,n){if(!(this._points[0].timestamp===this._points[1].timestamp&&i>=4)){var s=E(this.pointToScreenPoint(this._points[0])),h=E(this.pointToScreenPoint(this._points[1])),r=E(this.pointToScreenPoint(n)),e=this.Xh()||0,u=E(this.priceScale()),o=this.ownerSource(),l=B(null===o?void 0:o.firstValue());if(0===i)t.prototype.setPoint.call(this,i,n),this._points[2].price=u.coordinateToPrice(r.y+e,l.value);else if(1===i)t.prototype.setPoint.call(this,i,n);else if(2===i)t.prototype.setPoint.call(this,i,n),this._points[0].timestamp=n.timestamp,this._points[0].price=u.coordinateToPrice(r.y-e,l.value);else if(3===i)this._points[1].timestamp=n.timestamp,this._points[1].price=u.coordinateToPrice(r.y-e,l.value);else if(4===i){var a=h.subtract(s),f=(r.x-s.x)/a.x,c=r.y-s.addScaled(a,f).y;this._points[2].price=u.coordinateToPrice(s.y+c,l.value)}else if(5===i){a=h.subtract(s),f=(r.x-s.x)/a.x,c=r.y-s.addScaled(a,f).y;this._points[0].price=u.coordinateToPrice(s.y+c,l.value),this._points[1].price=u.coordinateToPrice(h.y+c,l.value)}}},i.prototype.getPoint=function(i){if(i<3)return t.prototype.getPoint.call(this,i);var n=this.pointToScreenPoint(this._points[0]),s=this.pointToScreenPoint(this._points[1]),r=this.pointToScreenPoint(this._points[2]);if(!n||!s||!r)return null;switch(i){case 3:var e=r.y-n.y,u=s.add(new h(0,e));return this.screenPointToPoint(u);case 4:e=r.y-n.y,u=s.add(new h(0,e));var o=r.add(u).scaled(.5);return this.screenPointToPoint(o);case 5:var l=n.add(s).scaled(.5);return this.screenPointToPoint(l)}return null},i.prototype.priceAxisPoints=function(){return this.Jh()},i.prototype.timeAxisPoints=function(){return this.Jh().slice(0,2)},i.prototype.Xh=function(){var t=this.pointToScreenPoint(this._points[2]),i=this.pointToScreenPoint(this._points[0]);return t&&i?t.y-i.y:null},i.prototype.Jh=function(){var t=this.points(),i=this._points[0]?this.pointToScreenPoint(this._points[0]):null,n=this._points[1]?this.pointToScreenPoint(this._points[1]):null,s=this._points[2]?this.pointToScreenPoint(this._points[2]):null;if(i&&n&&s){var r=n.y-i.y,e=s.add(new h(0,r));t.push(E(this.screenPointToPoint(e)))}return t},i.prototype.Zh=function(t){if(this._points.length<2||this._points[1].timestamp===this._points[0].timestamp)return t;var i=E(this.pointToScreenPoint(t)),n=E(this.pointToScreenPoint(this._points[1])),s=E(this.pointToScreenPoint(this._points[0])),r=n.subtract(s),e=(i.x-s.x)/r.x,u=s.addScaled(r,e),o=i.y-u.y,l=s.add(new h(0,o));return E(this.screenPointToPoint(l))},i}(Kt),xn=function(t){function i(i,n){var s=t.call(this,i,n)||this;return s.Sh=new un,s.Xt=null,s}return U(i,t),i.prototype.ti=function(){t.prototype.ti.call(this),this.Xt=null;var i=this.Di.options();this.Sh.Z({Ii:Zt(i.line),Vi:this.sh});var n=new ut;n.H(this.Sh),this.Xt=n,this.wh(n)},i}(sn),Cn=function(t){function i(i,n,s){void 0===s&&(s=[]);var h=t.call(this,i,n,s)||this;return h._toolType="Path",h._setPaneViews([new xn(h,i)]),h}return U(i,t),i.prototype.pointsCount=function(){return-1},i.prototype.tryFinish=function(){if(this._points.length>0){var t=this._points[this._points.length-1],i=this._points[this._points.length-2],n=E(this.pointToScreenPoint(t)),s=E(this.pointToScreenPoint(i));n.subtract(s).length()<10&&(this._points.pop(),this._finished=!0,this._selected=!0,this._lastPoint=null)}},i}(Kt),Nn=function(t){function i(){var i=null!==t&&t.apply(this,arguments)||this;return i._toolType="Ray",i}return U(i,t),i}(rn),Sn=function(t){function i(i,n){var s=t.call(this,i,n)||this;return s.Gh=new vn,s.kh=new si,s.Xt=null,s}return U(i,t),i.prototype.ti=function(){this.Xt=null,this.Jt=!1;var i=this.Di.priceScale(),n=this.Qt.timeScale();if(i&&!i.isEmpty()&&!n.isEmpty()){var s=n.visibleTimeRange();if(null!==s){var h=this.Di.points();if(!(h.length<2)){var r=this.Di.options();if(!(Math.max(h[0].timestamp,h[1].timestamp)<s.from.timestamp)||r.rectangle.extend.left||r.rectangle.extend.right){if(t.prototype.ti.call(this),this.sh.length<2)return;var e=new ut;this.Gh.Z(q(q({},Zt(r.rectangle)),{points:this.sh,hitTestBackground:!1})),e.H(this.Gh);var u=this.sh[0],o=this.sh[1];if(r.text.value){var l=Math.min(u.x,o.x),a=Math.max(u.x,o.x),f=Math.min(u.y,o.y),c=Math.max(u.y,o.y),v=u.clone(),d=r.text.font.size/3,_=0;switch(r.text.box.alignment.vertical){case"middle":v.y=(f+c)/2,_=d;break;case"top":v.y=c;break;case"bottom":v.y=f}switch(r.text.box.alignment.horizontal){case"center":v.x=(l+a)/2;break;case"left":v.x=l;break;case"right":v.x=a}var w=Zt(r.text);w.box=q(q({},w.box),{padding:{y:d,x:_}}),"middle"===r.text.box.alignment.vertical&&(w.wordWrapWidth=a-l-2*_,w.box.maxHeight=c-f),this.kh.Z({At:w,Vi:[v]}),e.H(this.kh)}this.Qh(u,o,e),this.Xt=e}}}}},i.prototype.Qh=function(t,i,n){var s=new Zi(t.x,i.y,2),h=new Zi(i.x,t.y,3),r=new Zi(t.x,.5*(t.y+i.y),4,!0),e=new Zi(i.x,.5*(t.y+i.y),5,!0),u=new Zi(.5*(t.x+i.x),t.y,6,!0),o=new Zi(.5*(t.x+i.x),i.y,7,!0),l=t.x-i.x,a=t.y-i.y,f=Math.sign(l*a),c={Vi:[t,i,s,h,r,e,u,o],Ks:[f<0?Ui.DiagonalNeSwResize:Ui.DiagonalNwSeResize,f<0?Ui.DiagonalNeSwResize:Ui.DiagonalNwSeResize,f>0?Ui.DiagonalNeSwResize:Ui.DiagonalNwSeResize,f>0?Ui.DiagonalNeSwResize:Ui.DiagonalNwSeResize,Ui.HorizontalResize,Ui.HorizontalResize,Ui.VerticalResize,Ui.VerticalResize]};n.H(this.Mh(c,0))},i}(sn),Tn=function(t){function i(i,n,s){void 0===s&&(s=[]);var h=t.call(this,i,n,s)||this;return h._toolType="Rectangle",h._setPaneViews([new Sn(h,i)]),h}return U(i,t),i.prototype.pointsCount=function(){return 2},i.prototype.setPoint=function(i,n){switch(i<2&&t.prototype.setPoint.call(this,i,n),i){case 2:this._points[1].price=n.price,this._points[0].timestamp=n.timestamp;break;case 3:this._points[0].price=n.price,this._points[1].timestamp=n.timestamp;break;case 4:this._points[0].timestamp=n.timestamp;break;case 5:this._points[1].timestamp=n.timestamp;break;case 6:this._points[0].price=n.price;break;case 7:this._points[1].price=n.price}},i.prototype.getPoint=function(i){return i<2?t.prototype.getPoint.call(this,i):this.tr(i)},i.prototype.tr=function(t){var i=this.points()[0],n=this.points()[1];return[{Kt:i.price,ir:i.timestamp},{Kt:n.price,ir:n.timestamp},{Kt:n.price,ir:i.timestamp},{Kt:i.price,ir:n.timestamp},{Kt:(n.price+i.price)/2,ir:i.timestamp},{Kt:(n.price+i.price)/2,ir:n.timestamp},{Kt:i.price,ir:(n.timestamp+i.timestamp)/2},{Kt:n.price,ir:(n.timestamp+i.timestamp)/2}][t]},i}(Kt),An=function(t){function i(i,n){var s=t.call(this,i,n)||this;return s.kh=new si,s.Xt=null,s}return U(i,t),i.prototype.ti=function(i,n){this.Xt=null;var s=this.Di.priceScale(),h=this.Qt.timeScale();if(s&&!s.isEmpty()&&!h.isEmpty()&&(t.prototype.ti.call(this),!(this.sh.length<1))){var r=Zt(this.Di.options().text);r.box.alignment={vertical:"bottom",horizontal:"center"},r.alignment="center";var e=this.sh[0].clone(),u=new ut;this.kh.Z({At:r,Vi:[e]}),u.H(this.kh),this.wh(u),this.Xt=u}},i}(sn),Ln=function(t){function i(i,n,s){void 0===s&&(s=[]);var h=t.call(this,i,n,s)||this;return h._toolType="Text",h._setPaneViews([new An(h,i)]),h}return U(i,t),i.prototype.pointsCount=function(){return 1},i}(Kt),En=function(t){function i(){var i=null!==t&&t.apply(this,arguments)||this;return i.K=null,i}return U(i,t),i.prototype.Z=function(t){this.K=t},i.prototype.hitTest=function(t){if(null===this.K||this.K.points.length<2)return null;var i=this.K.points,n=i[0],s=i[1];if(_(n,s,t).M<=Gt)return new Jt(Xt.MovePoint);if(3!==this.K.points.length)return null;var h=this.K.points[2];return _(s,h,t).M<=Gt||_(h,n,t).M<=Gt?new Jt(Xt.MovePoint):this.K.hitTestBackground&&function(t,i,n,s){var h=i.add(n).scaled(.5).add(s).scaled(.5);return null===v(i,n,h,t)&&null===v(n,s,h,t)&&null===v(s,i,h,t)}(t,n,s,h)?new Jt(Xt.MovePointBackground):null},i.prototype.Y=function(t){var i,n,s,h;if(!(null===this.K||this.K.points.length<2)){var r=this.K.points,e=r[0],u=r[1],o=2===this.K.points.length?u:this.K.points[2];t.lineCap="butt",t.lineWidth=(null===(i=this.K.border)||void 0===i?void 0:i.width)||0,t.strokeStyle=(null===(n=this.K.border)||void 0===n?void 0:n.color)||"transparent",void 0!==(null===(s=this.K.border)||void 0===s?void 0:s.style)&&g(t,this.K.border.style),t.beginPath(),t.fillStyle=(null===(h=this.K.background)||void 0===h?void 0:h.color)||"transparent",t.moveTo(e.x,e.y),t.lineTo(u.x,u.y),t.lineTo(o.x,o.y),t.lineTo(e.x,e.y),t.fill(),t.stroke()}},i}(ot),Bn=function(t){function i(i,n){var s=t.call(this,i,n)||this;return s.nr=new En,s.Xt=null,s}return U(i,t),i.prototype.ti=function(){var i=this.Di.options();t.prototype.ti.call(this),this.Xt=null,this.nr.Z(q(q({},i.triangle),{points:this.sh,hitTestBackground:!1}));var n=new ut;n.H(this.nr),this.wh(n),this.Xt=n},i}(sn),Dn=function(t){function i(i,n,s){void 0===s&&(s=[]);var h=t.call(this,i,n,s)||this;return h._toolType="Triangle",h._setPaneViews([new Bn(h,i)]),h}return U(i,t),i.prototype.pointsCount=function(){return 3},i}(Kt),Fn=function(t){function i(i,n){var s=t.call(this,i,n)||this;return s.yh=new ti,s.kh=new si,s.Xt=null,s.yh.Oi(new Jt(Xt.MovePoint)),s}return U(i,t),i.prototype.ti=function(i,n){this.Xt=null;var s=this.Di.priceScale(),r=this.Qt.timeScale();if(s&&!s.isEmpty()&&!r.isEmpty()){var e=this.Di.points();if(!(e.length<1)){var u=r.coordinateToTime(0),o=r.coordinateToTime(n),l=this.Di.options();if(!(e[0].timestamp>o.timestamp||e[0].timestamp<u.timestamp)){if(t.prototype.ti.call(this),this.sh.length<1)return;var a=this.sh[0],f=new Zi(a.x,i,0),c=new Zi(a.x,0,1);a.y=i/2,a.Us=!0;var v=new ut;if(this.yh.Z({Ii:q(q({},Zt(l.line)),{end:{Dh:0,Fh:0},extend:{Dh:!1,Fh:!1}}),Vi:[f,c]}),v.H(this.yh),l.text.value){var d=Math.atan((c.y-f.y)/(c.x-f.x)),_=l.text.box.alignment.horizontal,w="left"===_?f.clone():"right"===_?c.clone():new h((f.x+c.x)/2,(f.y+c.y)/2),M=Zt(l.text);M.box=q(q({},M.box),{angle:d}),this.kh.Z({At:M,Vi:[w]}),v.H(this.kh)}this.wh(v),this.Xt=v}}}},i}(sn),Pn={FibRetracement:_n,ParallelChannel:kn,HorizontalLine:bn,VerticalLine:function(t){function i(i,n,s){void 0===s&&(s=[]);var h=t.call(this,i,n,s)||this;return h._toolType="VerticalLine",h._setPaneViews([new Fn(h,i)]),h}return U(i,t),i.prototype.pointsCount=function(){return 1},i.prototype.priceAxisViews=function(){return[]},i.prototype.priceAxisPoints=function(){return[]},i.prototype.timeAxisLabelColor=function(){return this.options().line.color},i}(Kt),Highlighter:wn,CrossLine:fn,TrendLine:rn,Rectangle:Tn,Triangle:Dn,Brush:ln,Path:Cn,Text:Ln,Ray:Nn,Arrow:en,ExtendedLine:cn,HorizontalRay:mn},Wn=function(){function t(t){this._lastLineTool=null,this._activeOptions=null,this._activeType=null,this._model=t}return t.prototype.setActiveLineTool=function(t,i){this._activeOptions=i||{},this._activeType=t,this._model.dataSources().forEach((function(t){t instanceof Kt&&(t.setSelected(!1),t.setHovered(!1),t.setEditing(!1))})),this._model.lightUpdate()},t.prototype.hasActiveToolLine=function(){return null!==this._activeType},t.prototype.onInputEvent=function(t,i,n){var s;if(this._activeType&&this._activeOptions&&(n.consumed=!0,6===i)){var h=(null===(s=t.state().dataSources()[0].priceScale())||void 0===s?void 0:s.id())||t.state().model().defaultVisiblePriceScaleId(),r=K(Q(It[this._activeType]),this._activeOptions||{});this._lastLineTool=new Pn[this._activeType](this._model,r,[]),t.state().addDataSource(this._lastLineTool,h),this._activeType=null,this._activeOptions=null}},t}(),Rn=function(){function t(t){this.sr=t}return t.prototype.format=function(t){var i="";return t<0&&(i="-",t=-t),t<995?i+this.hr(t):t<999995?i+this.hr(t/1e3)+"K":t<999999995?(t=1e3*Math.round(t/1e3),i+this.hr(t/1e6)+"M"):(t=1e6*Math.round(t/1e6),i+this.hr(t/1e9)+"B")},t.prototype.hr=function(t){var i=Math.pow(10,this.sr);return((t=Math.round(t*i)/i)>=1e-15&&t<1?t.toFixed(this.sr).replace(/\.?0+$/,""):String(t)).replace(/(\.[1-9]*)0+$/,(function(t,i){return i}))},t}();function zn(t,i,n,s){if(0!==i.length)for(var h={},r=s.from;r<s.to;++r){var e=i[r].bt;if(!h[e||"undefiend"]){Object.keys(h).length&&(t.stroke(),t.closePath(),t.beginPath());var u=i[r].x,o=i[r].y;t.moveTo(u,o),t.strokeStyle=null!=e?e:t.strokeStyle,h[e||"undefiend"]=!0;for(var l=r+1;l<s.to;++l){var a=i[l];if(i[l-1].bt===e){if(1===n){var f=i[l-1].y,c=a.x;t.lineTo(c,f)}else if(2===n){var v=i[l-1].x,d=a.y;t.lineTo(v,d)}t.lineTo(a.x,a.y)}else t.moveTo(a.x,a.y)}}}}var On=function(t){function i(){var i=null!==t&&t.apply(this,arguments)||this;return i.K=null,i}return U(i,t),i.prototype.Z=function(t){this.K=t},i.prototype.Y=function(t){if(null!==this.K&&0!==this.K.J.length&&null!==this.K.X){if(t.lineCap="butt",t.lineJoin="round",t.lineWidth=this.K.Mt,g(t,this.K.gt),t.lineWidth=1,t.beginPath(),1===this.K.J.length){var i=this.K.J[0],n=this.K.rr/2;t.moveTo(i.x-n,this.K.er),t.lineTo(i.x-n,i.y),t.lineTo(i.x+n,i.y),t.lineTo(i.x+n,this.K.er)}else t.moveTo(this.K.J[this.K.X.from].x,this.K.er),t.lineTo(this.K.J[this.K.X.from].x,this.K.J[this.K.X.from].y),zn(t,this.K.J,this.K.ur,this.K.X),this.K.X.to>this.K.X.from&&(t.lineTo(this.K.J[this.K.X.to-1].x,this.K.er),t.lineTo(this.K.J[this.K.X.from].x,this.K.er));t.closePath(),t.fillStyle=this.lr(t),t.fill()}},i}(ot),Vn=function(t){function i(){return null!==t&&t.apply(this,arguments)||this}return U(i,t),i.prototype.lr=function(t){var i=this.K,n=t.createLinearGradient(0,0,0,i.ar);return n.addColorStop(0,i.cr),n.addColorStop(1,i.vr),n},i}(On),In=function(t){function i(){var i=null!==t&&t.apply(this,arguments)||this;return i.K=null,i}return U(i,t),i.prototype.Z=function(t){this.K=t},i.prototype.Y=function(t){if(null!==this.K&&0!==this.K.J.length&&null!==this.K.X)if(t.lineCap="butt",t.lineWidth=this.K.Mt,g(t,this.K.gt),t.strokeStyle=this.dr(t),t.lineJoin="round",t.beginPath(),1===this.K.J.length){var i=this.K.J[0];t.moveTo(i.x-this.K.rr/2,i.y),t.lineTo(i.x+this.K.rr/2,i.y),void 0!==i.bt&&(t.strokeStyle=i.bt)}else zn(t,this.K.J,this.K.ur,this.K.X)},i.prototype._r=function(t,i){t.beginPath(),zn(t,i.J,i.ur,i.X),t.stroke()},i}(ot),Hn=function(t){function i(){return null!==t&&t.apply(this,arguments)||this}return U(i,t),i.prototype._r=function(t,i){var n,s,h=i.J,r=i.X,e=i.ur,u=i.it;if(0!==h.length&&null!==r){t.beginPath();var o=h[r.from];t.moveTo(o.x,o.y);var l=null!==(n=o.bt)&&void 0!==n?n:u;t.strokeStyle=l;for(var a=function(i){t.stroke(),t.beginPath(),t.strokeStyle=i,l=i},f=r.from+1;f<r.to;++f){var c=h[f],v=h[f-1],d=null!==(s=c.bt)&&void 0!==s?s:u;1===e&&(t.lineTo(c.x,v.y),d!==l&&(a(d),t.moveTo(c.x,v.y))),t.lineTo(c.x,c.y),1!==e&&d!==l&&(a(d),t.moveTo(c.x,c.y))}t.stroke()}},i.prototype.dr=function(){return this.K.it},i}(In);function jn(t,i,n,s,h){void 0===s&&(s=0),void 0===h&&(h=t.length);for(var r=h-s;0<r;){var e=r>>1,u=s+e;n(t[u],i)?(s=u+1,r-=e+1):r=e}return s}function Un(t,i,n,s,h){void 0===s&&(s=0),void 0===h&&(h=t.length);for(var r=h-s;0<r;){var e=r>>1,u=s+e;n(i,t[u])?r=e:(s=u+1,r-=e+1)}return s}function qn(t,i){return t.time<i}function Yn(t,i){return t<i.time}function $n(t,i,n){var s=i.left(),h=i.right(),r=jn(t,s,qn),e=Un(t,h,Yn);if(!n)return{from:r,to:e};var u=r,o=e;return r>0&&r<t.length&&t[r].time>=s&&(u=r-1),e>0&&e<t.length&&t[e-1].time<=h&&(o=e+1),{from:u,to:o}}var Kn=function(){function t(t,i,n){this.Jt=!0,this.wr=!0,this.Mr=!0,this.br=[],this.mr=null,this.pr=t,this.Qt=i,this.gr=n}return t.prototype.update=function(t){this.Jt=!0,"data"===t&&(this.wr=!0),"options"===t&&(this.Mr=!0)},t.prototype.yr=function(){this.wr&&(this.kr(),this.wr=!1),this.Jt&&(this.Cr(),this.Jt=!1),this.Mr&&(this.Nr(),this.Mr=!1)},t.prototype.Sr=function(){this.mr=null},t.prototype.Cr=function(){var t=this.pr.priceScale(),i=this.Qt.timeScale();if(this.Sr(),!i.isEmpty()&&!t.isEmpty()){var n=i.visibleStrictRange();if(null!==n&&0!==this.pr.bars().size()){var s=this.pr.firstValue();null!==s&&(this.mr=$n(this.br,n,this.gr),this.Tr(t,i,s.value))}}},t}(),Zn=function(t){function i(i,n){return t.call(this,i,n,!0)||this}return U(i,t),i.prototype.Tr=function(t,i,n){i.indexesToCoordinates(this.br,it(this.mr)),t.pointsArrayToCoordinates(this.br,n,it(this.mr))},i.prototype.Ar=function(t,i){return{time:t,price:i,x:NaN,y:NaN}},i.prototype.Nr=function(){},i.prototype.kr=function(){var t=this,i=this.pr.barColorer();this.br=this.pr.bars().rows().map((function(n){var s=n.value[3];return t.Lr(n.index,s,i)}))},i}(Kn),Xn=function(t){function i(i,n){var s=t.call(this,i,n)||this;return s.kt=new ut,s.Er=new Vn,s.Br=new Hn,s.kt.V([s.Er,s.Br]),s}return U(i,t),i.prototype.renderer=function(t,i){if(!this.pr.visible())return null;var n=this.pr.options();return this.yr(),this.Er.Z({ur:n.lineType,J:this.br,gt:n.lineStyle,Mt:n.lineWidth,cr:n.topColor,vr:n.bottomColor,er:t,ar:t,X:this.mr,rr:this.Qt.timeScale().barSpacing()}),this.Br.Z({ur:n.lineType,J:this.br,it:n.lineColor,gt:n.lineStyle,Mt:n.lineWidth,X:this.mr,rr:this.Qt.timeScale().barSpacing()}),this.kt},i.prototype.Lr=function(t,i){return this.Ar(t,i)},i}(Zn),Jn=function(){function t(){this.ot=null,this.Dr=0,this.Fr=0}return t.prototype.Z=function(t){this.ot=t},t.prototype.draw=function(t,i){if(null!==this.ot&&0!==this.ot.Pr.length&&null!==this.ot.X){var n=i.pixelRatio;if(this.Dr=this.Wr(n),this.Dr>=2)Math.max(1,Math.floor(n))%2!=this.Dr%2&&this.Dr--;this.Fr=this.ot.Rr?Math.min(this.Dr,Math.floor(n)):this.Dr;for(var s=null,h=this.Fr<=this.Dr&&this.ot.zr>=Math.floor(1.5*n),r=this.ot.X.from;r<this.ot.X.to;++r){var e=this.ot.Pr[r];s!==e.bt&&(t.fillStyle=e.bt,s=e.bt);var u=Math.floor(.5*this.Fr),o=Math.round(e.x*n),l=o-u,a=this.Fr,f=l+a-1,c=Math.min(e.highY,e.lowY),v=Math.max(e.highY,e.lowY),d=Math.round(c*n)-u,_=Math.round(v*n)+u,w=Math.max(_-d,this.Fr);t.fillRect(l,d,a,w);var M=Math.ceil(1.5*this.Dr);if(h){if(this.ot.Or){var b=o-M,m=Math.max(d,Math.round(e.openY*n)-u),p=m+a-1;p>d+w-1&&(m=(p=d+w-1)-a+1),t.fillRect(b,m,l-b,p-m+1)}var g=o+M,y=Math.max(d,Math.round(e.closeY*n)-u),k=y+a-1;k>d+w-1&&(y=(k=d+w-1)-a+1),t.fillRect(f+1,y,g-f,k-y+1)}}}},t.prototype.Wr=function(t){var i=Math.floor(t);return Math.max(i,Math.floor(function(t,i){return Math.floor(.3*t*i)}(E(this.ot).zr,t)))},t}(),Gn=function(t){function i(i,n){return t.call(this,i,n,!1)||this}return U(i,t),i.prototype.Tr=function(t,i,n){i.indexesToCoordinates(this.br,it(this.mr)),t.barPricesToCoordinates(this.br,n,it(this.mr))},i.prototype.Vr=function(t,i,n){return{time:t,open:i.value[0],high:i.value[1],low:i.value[2],close:i.value[3],x:NaN,openY:NaN,highY:NaN,lowY:NaN,closeY:NaN}},i.prototype.kr=function(){var t=this,i=this.pr.barColorer();this.br=this.pr.bars().rows().map((function(n){return t.Lr(n.index,n,i)}))},i}(Kn),Qn=function(t){function i(){var i=null!==t&&t.apply(this,arguments)||this;return i.kt=new Jn,i}return U(i,t),i.prototype.renderer=function(t,i){if(!this.pr.visible())return null;var n=this.pr.options();this.yr();var s={Pr:this.br,zr:this.Qt.timeScale().barSpacing(),Or:n.openVisible,Rr:n.thinBars,X:this.mr};return this.kt.Z(s),this.kt},i.prototype.Nr=function(){var t=this;this.br.forEach((function(i){i.bt=t.pr.barColorer().barStyle(i.time).barColor}))},i.prototype.Lr=function(t,i,n){return q(q({},this.Vr(t,i,n)),{bt:n.barStyle(t).barColor})},i}(Gn),ts=function(t){function i(){return null!==t&&t.apply(this,arguments)||this}return U(i,t),i.prototype.lr=function(t){var i=this.K,n=t.createLinearGradient(0,0,0,i.ar),s=Ci(i.er/i.ar,0,1);return n.addColorStop(0,i.Ir),n.addColorStop(s,i.Hr),n.addColorStop(s,i.jr),n.addColorStop(1,i.Ur),n},i}(On),is=function(t){function i(){return null!==t&&t.apply(this,arguments)||this}return U(i,t),i.prototype.dr=function(t){var i=this.K,n=t.createLinearGradient(0,0,0,i.ar),s=Ci(i.er/i.ar,0,1);return n.addColorStop(0,i.cr),n.addColorStop(s,i.cr),n.addColorStop(s,i.vr),n.addColorStop(1,i.vr),n},i}(In),ns=function(t){function i(i,n){var s=t.call(this,i,n)||this;return s.qr=new ts,s.Yr=new is,s.nt=new ut,s.nt.V([s.qr,s.Yr]),s}return U(i,t),i.prototype.renderer=function(t,i){if(!this.pr.visible())return null;var n=this.pr.firstValue();if(null===n)return null;var s=this.pr.options();this.yr();var h=this.pr.priceScale().priceToCoordinate(s.baseValue.price,n.value),r=this.Qt.timeScale().barSpacing();return this.qr.Z({J:this.br,Ir:s.topFillColor1,Hr:s.topFillColor2,jr:s.bottomFillColor1,Ur:s.bottomFillColor2,Mt:s.lineWidth,gt:s.lineStyle,ur:s.lineType,er:h,ar:t,X:this.mr,rr:r}),this.Yr.Z({J:this.br,cr:s.topLineColor,vr:s.bottomLineColor,Mt:s.lineWidth,gt:s.lineStyle,ur:s.lineType,er:h,ar:t,X:this.mr,rr:r}),this.nt},i.prototype.Lr=function(t,i){return this.Ar(t,i)},i}(Zn),ss=function(t){function i(){var i=null!==t&&t.apply(this,arguments)||this;return i.$r={},i.K=null,i}return U(i,t),i.prototype.Z=function(t){this.K=t},i.prototype.Y=function(t){if(null!==this.K&&0!==this.K.J.length&&null!==this.K.X){this.K.Kr&&(t.globalCompositeOperation=this.K.Kr);for(var i=[],n=this.K.X?this.K.X.from:0,s=this.K.X?this.K.X.to:0,h=null,r=null,e=n;e<s;++e){var u=this.K.J[e];null!==h&&(u.time-h>1||u.bt!==r)&&(i.push([n,u.time-h>1?e-1:e]),n=e),h=u.time,r=u.bt}i.push([n,s?s-1:0]),t.strokeStyle=this.K.Zr,t.lineWidth=this.K.Qs,t.fillStyle=this.K.bt;for(e=0;e<i.length;++e){var o=i[e][0],l=i[e][1];if(void 0!==this.K.J[o].Xr&&(t.fillStyle=this.K.Zr,t.fillText(this.K.J[o].Xr,this.K.J[o].x,this.K.J[o].higherY-4),t.fillStyle=this.K.bt),void 0!==this.K.J[o].bt&&(t.fillStyle=this.K.J[o].bt),t.beginPath(),t.moveTo(this.K.J[o].x,this.K.J[o].higherY),this.K.J[0].Jr&&this.K.J[o].higherY===this.K.J[o].lowerY&&1===this.K.J.length)t.lineTo(this.K.J[l].end,this.K.J[l].higherY),t.lineTo(this.K.J[l].end,this.K.J[l].lowerY),this.K.Qs&&t.stroke();else{for(var a=o;a<=l;a++)t.lineTo(this.K.J[a].x,this.K.J[a].higherY);this.K.J[0].Jr&&(t.lineTo(this.K.J[l].end,this.K.J[l].higherY),t.lineTo(this.K.J[l].end,this.K.J[l].lowerY));for(a=l;a>=o;--a)t.lineTo(this.K.J[a].x,this.K.J[a].lowerY);t.closePath(),this.K.bt&&t.fill(),this.K.Qs&&t.stroke()}}}},i}(ot),hs=function(t){function i(i,n){return t.call(this,i,n,!0)||this}return U(i,t),i.prototype.Tr=function(t,i,n){i.indexesToCoordinates(this.br,it(this.mr)),t.cloudPointsArrayToCoordinates(this.br,n,it(this.mr))},i.prototype.Nr=function(){},i.prototype.Cr=function(){var t=this.pr.priceScale(),i=this.Qt.timeScale();if(this.Sr(),!i.isEmpty()&&!t.isEmpty()){var n=i.visibleStrictRange();if(null!==n&&0!==this.pr.bars().size()){var s=this.pr.firstValue();null!==s&&(this.mr=$n(this.br,n,this.gr),this.Tr(t,i,s.value))}}},i.prototype.kr=function(){this.br=this.pr.bars().rows().map((function(t){var i=t.value[1],n=t.value[2];return{gi:t.index,Gr:i,Qr:n,vt:NaN,te:NaN,ie:NaN}}))},i}(Kn),rs=function(t){function i(i,n){var s=t.call(this,i,n)||this;return s.kt=new ut,s.ne=new ss,s.kt.V([s.ne]),s}return U(i,t),i.prototype.se=function(t){this.ne.$r=t},i.prototype.renderer=function(t,i){if(!this.pr.visible())return null;var n=this.pr.options();this.yr();var s={J:this.br,bt:n.color,Zr:n.strokeColor,Qs:n.strokeWidth,Kr:n.compositeOperation,Zt:i,X:this.mr,rr:this.Qt.timeScale().barSpacing()};return this.ne.Z(s),this.kt},i.prototype.Tr=function(t,i,n){i.indexesToCoordinatesExtensions(this.br,this.ne.$r,it(this.mr)),t.cloudPointsArrayToCoordinates(this.br,n,it(this.mr))},i.prototype.kr=function(){this.br=this.pr.bars().rows().map((function(t){var i=t.value[1],n=t.value[2],s={time:t.index,higherPrice:i,lowerPrice:n,x:NaN,end:NaN,higherY:NaN,lowerY:NaN};return void 0!==t.color&&(s.bt=t.color),void 0!==t.id&&(s.id=t.id),void 0!==t.label&&(s.Xr=t.label),void 0!==t.extendRight&&(s.Jr=t.extendRight),s}))},i}(hs),es=function(){function t(){this.ot=null,this.Dr=0}return t.prototype.Z=function(t){this.ot=t},t.prototype.draw=function(t,i){if(null!==this.ot&&0!==this.ot.Pr.length&&null!==this.ot.X){var n=i.pixelRatio;if(this.Dr=function(t,i){if(t>=2.5&&t<=4)return Math.floor(3*i);var n=1-.2*Math.atan(Math.max(4,t)-4)/(.5*Math.PI),s=Math.floor(t*n*i),h=Math.floor(t*i),r=Math.min(s,h);return Math.max(Math.floor(i),r)}(this.ot.zr,n),this.Dr>=2)Math.floor(n)%2!=this.Dr%2&&this.Dr--;var s=this.ot.Pr;this.ot.he&&this.re(t,s,this.ot.X,n),this.ot.ee&&this.ue(t,s,this.ot.X,this.ot.zr,n);var h=this.oe(n);(!this.ot.ee||this.Dr>2*h)&&this.le(t,s,this.ot.X,n)}},t.prototype.re=function(t,i,n,s){if(null!==this.ot){var h="",r=Math.min(Math.floor(s),Math.floor(this.ot.zr*s));r=Math.max(Math.floor(s),Math.min(r,this.Dr));for(var e=Math.floor(.5*r),u=null,o=n.from;o<n.to;o++){var l=i[o];l.ae!==h&&(t.fillStyle=l.ae,h=l.ae);var a=Math.round(Math.min(l.openY,l.closeY)*s),f=Math.round(Math.max(l.openY,l.closeY)*s),c=Math.round(l.highY*s),v=Math.round(l.lowY*s),d=Math.round(s*l.x)-e,_=d+r-1;null!==u&&(d=Math.max(u+1,d),d=Math.min(d,_));var w=_-d+1;t.fillRect(d,c,w,a-c),t.fillRect(d,f+1,w,v-f),u=_}}},t.prototype.oe=function(t){var i=Math.floor(1*t);this.Dr<=2*i&&(i=Math.floor(.5*(this.Dr-1)));var n=Math.max(Math.floor(t),i);return this.Dr<=2*n?Math.max(Math.floor(t),Math.floor(1*t)):n},t.prototype.ue=function(t,i,n,s,h){if(null!==this.ot)for(var r="",e=this.oe(h),u=null,o=n.from;o<n.to;o++){var l=i[o];l.Bt!==r&&(t.fillStyle=l.Bt,r=l.Bt);var a=Math.round(l.x*h)-Math.floor(.5*this.Dr),f=a+this.Dr-1,c=Math.round(Math.min(l.openY,l.closeY)*h),v=Math.round(Math.max(l.openY,l.closeY)*h);if(null!==u&&(a=Math.max(u+1,a),a=Math.min(a,f)),this.ot.zr*h>2*e)_t(t,a,c,f-a+1,v-c+1,e);else{var d=f-a+1;t.fillRect(a,c,d,v-c+1)}u=f}},t.prototype.le=function(t,i,n,s){if(null!==this.ot)for(var h="",r=this.oe(s),e=n.from;e<n.to;e++){var u=i[e],o=Math.round(Math.min(u.openY,u.closeY)*s),l=Math.round(Math.max(u.openY,u.closeY)*s),a=Math.round(u.x*s)-Math.floor(.5*this.Dr),f=a+this.Dr-1;if(u.bt!==h){var c=u.bt;t.fillStyle=c,h=c}this.ot.ee&&(a+=r,o+=r,f-=r,l-=r),o>l||t.fillRect(a,o,f-a+1,l-o+1)}},t}(),us=function(t){function i(){var i=null!==t&&t.apply(this,arguments)||this;return i.kt=new es,i}return U(i,t),i.prototype.renderer=function(t,i){if(!this.pr.visible())return null;var n=this.pr.options();this.yr();var s={Pr:this.br,zr:this.Qt.timeScale().barSpacing(),he:n.wickVisible,ee:n.borderVisible,X:this.mr};return this.kt.Z(s),this.kt},i.prototype.Nr=function(){var t=this;this.br.forEach((function(i){var n=t.pr.barColorer().barStyle(i.time);i.bt=n.barColor,i.ae=n.barWickColor,i.Bt=n.barBorderColor}))},i.prototype.Lr=function(t,i,n){var s=n.barStyle(t);return q(q({},this.Vr(t,i,n)),{bt:s.barColor,ae:s.barWickColor,Bt:s.barBorderColor})},i}(Gn),os=function(t){function i(){var i=null!==t&&t.apply(this,arguments)||this;return i.K=null,i}return U(i,t),i.prototype.Z=function(t){this.K=t},i.prototype.Y=function(t){if(null!==this.K&&0!==this.K.J.length&&null!==this.K.X){for(var i=1,n=[],s=-2,h=this.K.X.from+1;h<this.K.X.to;++h){var r=this.K.J[h],e=r.higherPrice-r.lowerPrice,u=e>0?1:-1;h===this.K.X.from+1&&(i=e),-2!==s&&s*u==-1&&n.push(h),s=u}n.push(this.K.X.to);var o,l=this.K.X.from,a=[0,0],f=[0,0];for(h=0;h<n.length;++h){o=n[h],t.beginPath(),0===h?t.moveTo(this.K.J[l].x,this.K.J[l].higherY):t.moveTo(a[0],a[1]);for(var c=l;c<o;c++)t.lineTo(this.K.J[c].x,this.K.J[c].higherY);h!==n.length-1&&(f=this.fe(o),t.lineTo(f[0],f[1]));for(c=o-1;c>=l;--c)t.lineTo(this.K.J[c].x,this.K.J[c].lowerY);0!==h&&t.lineTo(a[0],a[1]),t.closePath(),i*Math.pow(-1,h)>0?t.fillStyle=this.K.ce:t.fillStyle=this.K.ve,t.fill(),l=o,a=f}}},i.prototype.fe=function(t){if(null===this.K||0===this.K.J.length||null===this.K.X)throw new Error("Empty data");return i.de(this.K.J[t-1].x,this.K.J[t-1].higherY,this.K.J[t].x,this.K.J[t].higherY,this.K.J[t-1].lowerY,this.K.J[t].lowerY)},i.de=function(t,i,n,s,h,r){var e=s-i,u=t-n,o=e*t+u*i,l=r-h,a=t-n,f=l*t+a*h,c=e*a-l*u;if(0===c)throw new Error("Lines are parallel");return[(a*o-u*f)/c,(e*f-l*o)/c]},i}(ot),ls=function(t){function i(i,n){var s=t.call(this,i,n)||this;return s.kt=new ut,s._e=new os,s.we=new Hn,s.Me=new Hn,s.kt.V([s._e,s.we,s.Me]),s}return U(i,t),i.prototype.renderer=function(t,i){if(!this.pr.visible())return null;var n=this.pr.options();this.yr();for(var s={J:this.br,ce:n.positiveColor,ve:n.negativeColor,ar:t,X:this.mr,rr:this.Qt.timeScale().barSpacing()},h=[],r=0;r<this.br.length;r++){var e={time:this.br[r].time,price:this.br[r].higherPrice,x:this.br[r].x,y:this.br[r].higherY};h.push(e)}var u={J:h,it:n.higherLineColor,gt:n.higherLineStyle,ur:n.higherLineType,Mt:n.higherLineWidth,X:this.mr,rr:this.Qt.timeScale().barSpacing()},o=[];for(r=0;r<this.br.length;r++){e={time:this.br[r].time,price:this.br[r].lowerPrice,x:this.br[r].x,y:this.br[r].lowerY};o.push(e)}var l={J:o,it:n.lowerLineColor,gt:n.lowerLineStyle,ur:n.lowerLineType,Mt:n.lowerLineWidth,X:this.mr,rr:this.Qt.timeScale().barSpacing()};return this._e.Z(s),this.we.Z(u),this.Me.Z(l),this.kt},i}(hs),as=function(){function t(){this.ot=null,this.be=[]}return t.prototype.Z=function(t){this.ot=t,this.be=[]},t.prototype.draw=function(t,i){if(null!==this.ot&&0!==this.ot.J.length&&null!==this.ot.X){var n=i.pixelRatio;this.be.length||this.me(n);for(var s=Math.max(1,Math.floor(n)),h=Math.round(this.ot.pe*n)-Math.floor(s/2),r=h+s,e=this.ot.X.from;e<this.ot.X.to;e++){var u=this.ot.J[e],o=this.be[e-this.ot.X.from],l=Math.round(u.y*n);t.fillStyle=u.bt;var a=void 0,f=void 0;l<=h?(a=l,f=r):(a=h,f=l-Math.floor(s/2)+s),t.fillRect(o.Dh,a,o.Fh-o.Dh+1,f-a)}}},t.prototype.me=function(t){if(null!==this.ot&&0!==this.ot.J.length&&null!==this.ot.X){var i=Math.ceil(this.ot.zr*t)<=1?0:Math.max(1,Math.floor(t)),n=Math.round(this.ot.zr*t)-i;this.be=new Array(this.ot.X.to-this.ot.X.from);for(var s=this.ot.X.from;s<this.ot.X.to;s++){var h,r=this.ot.J[s],e=Math.round(r.x*t),u=void 0,o=void 0;if(n%2)u=e-(h=(n-1)/2),o=e+h;else u=e-(h=n/2),o=e+h-1;this.be[s-this.ot.X.from]={Dh:u,Fh:o,ge:e,ye:r.x*t,gi:r.time}}for(s=this.ot.X.from+1;s<this.ot.X.to;s++){var l=this.be[s-this.ot.X.from],a=this.be[s-this.ot.X.from-1];l.gi===a.gi+1&&(l.Dh-a.Fh!==i+1&&(a.ge>a.ye?a.Fh=l.Dh-i-1:l.Dh=a.Fh+i+1))}var f=Math.ceil(this.ot.zr*t);for(s=this.ot.X.from;s<this.ot.X.to;s++){(l=this.be[s-this.ot.X.from]).Fh<l.Dh&&(l.Fh=l.Dh);var c=l.Fh-l.Dh+1;f=Math.min(c,f)}if(i>0&&f<4)for(s=this.ot.X.from;s<this.ot.X.to;s++){(c=(l=this.be[s-this.ot.X.from]).Fh-l.Dh+1)>f&&(l.ge>l.ye?l.Fh-=1:l.Dh+=1)}}else this.be=[]},t}();function fs(t){return{J:[],zr:t,pe:NaN,X:null}}function cs(t,i,n){return{time:t,price:i,x:NaN,y:NaN,bt:n}}var vs=function(t){function i(i,n){var s=t.call(this,i,n,!1)||this;return s.nt=new ut,s.ke=fs(0),s.kt=new as,s}return U(i,t),i.prototype.renderer=function(t,i){return this.pr.visible()?(this.yr(),this.nt):null},i.prototype.kr=function(){var t=this.Qt.timeScale().barSpacing();this.ke=fs(t);for(var i=0,n=0,s=this.pr.options().color,h=0,r=this.pr.bars().rows();h<r.length;h++){var e=r[h],u=e.value[3],o=void 0!==e.color?e.color:s,l=cs(e.index,u,o);++i<this.ke.J.length?this.ke.J[i]=l:this.ke.J.push(l),this.br[n++]={time:e.index,x:0}}this.kt.Z(this.ke),this.nt.V([this.kt])},i.prototype.Nr=function(){},i.prototype.Sr=function(){t.prototype.Sr.call(this),this.ke.X=null},i.prototype.Tr=function(t,i,n){if(null!==this.mr){var s=i.barSpacing(),h=E(i.visibleStrictRange()),r=t.priceToCoordinate(this.pr.options().base,n);i.indexesToCoordinates(this.ke.J),t.pointsArrayToCoordinates(this.ke.J,n),this.ke.pe=r,this.ke.X=$n(this.ke.J,h,!1),this.ke.zr=s,this.kt.Z(this.ke)}},i}(Kn),ds=function(t){function i(i,n){var s=t.call(this,i,n)||this;return s.Br=new Hn,s}return U(i,t),i.prototype.renderer=function(t,i){if(!this.pr.visible())return null;var n=this.pr.options();this.yr();var s={J:this.br,it:n.color,gt:n.lineStyle,ur:n.lineType,Mt:n.lineWidth,X:this.mr,rr:this.Qt.timeScale().barSpacing()};return this.Br.Z(s),this.Br},i.prototype.Nr=function(){var t=this;this.br.forEach((function(i){i.bt=t.pr.barColorer().barStyle(i.time).barColor}))},i.prototype.Lr=function(t,i,n){var s=this.Ar(t,i);return s.bt=n.barStyle(t).barColor,s},i}(Zn),_s=function(){function t(){this.xe=null,this.B=null}return t.prototype.Ce=function(t,i){this.xe=t,this.B=i},t.prototype.draw=function(t,i){null!==this.B&&null!==this.xe&&this.xe.draw&&this.xe.draw(t,this.B,i)},t}(),ws=function(){function t(t,i,n){this.Ne=t,this.Se=i,this.D=n,this.kt=new _s}return t.prototype.renderer=function(t,i){var n=this.D.paneForSource(this.Se);if(null===n)return null;var s=n.isOverlay(this.Se)?n.defaultVisiblePriceScale():this.Se.priceScale();if(null===s)return null;var h=n.priceScalePosition(s);if("overlay"===h)return null;var r=this.D.priceAxisRendererOptions();return r.align=h,this.kt.Ce(this.Ne.Ut(),r),this.kt},t}(),Ms=function(){function t(){this.ot=null}return t.prototype.Z=function(t){this.ot=t},t.prototype.draw=function(t,i){if(null!==this.ot&&!1!==this.ot.lt){var n=i.pixelRatio,s=Math.round(this.ot.dt*n);if(!(s<0||s>Math.ceil(this.ot.Dt*n))){var h=0;void 0!==this.ot.vt&&(h=Math.round(this.ot.vt*n));var r=Math.ceil(this.ot.Zt*n);t.lineCap="butt",t.strokeStyle=this.ot.bt,t.lineWidth=Math.floor(this.ot.Mt*n),g(t,this.ot.gt),k(t,s,h,r)}}},t}(),bs=function(){function t(t){this.Te={Zt:0,Dt:0,dt:0,bt:"rgba(0, 0, 0, 0)",Mt:1,gt:0,lt:!1},this.yh=new Ms,this.Rt=!0,this.pr=t,this.Qt=t.model(),this.yh.Z(this.Te)}return t.prototype.Ct=function(){this.Rt=!0},t.prototype.renderer=function(t,i){return this.pr.visible()?(this.Rt&&(this.ti(t,i),this.Rt=!1),this.yh):null},t}(),ms=function(t){function i(i){return t.call(this,i)||this}return U(i,t),i.prototype.ti=function(t,i){this.Te.lt=!1;var n=this.pr.priceScale(),s=n.mode().mode;if(2===s||3===s){var h=this.pr.options();if(h.baseLineVisible&&this.pr.visible()){var r=this.pr.firstValue();null!==r&&(this.Te.lt=!0,this.Te.dt=n.priceToCoordinate(r.value,r.value),this.Te.Zt=i,this.Te.Dt=t,this.Te.bt=h.baseLineColor,this.Te.Mt=h.baseLineWidth,this.Te.gt=h.baseLineStyle)}}},i}(bs),ps=function(){function t(){this.ot=null}return t.prototype.Z=function(t){this.ot=t},t.prototype.js=function(){return this.ot},t.prototype.draw=function(t,i){var n=this.ot;if(null!==n){t.save();var s=i.pixelRatio,h=Math.max(1,Math.floor(s)),r=h%2/2,e=Math.round(n.ye.x*s)+r,u=n.ye.y*s;t.fillStyle=n.Ae,t.beginPath();var o=Math.max(2,1.5*n.Le)*s;t.arc(e,u,o,0,2*Math.PI,!1),t.fill(),t.fillStyle=n.Ee,t.beginPath(),t.arc(e,u,n.tt*s,0,2*Math.PI,!1),t.fill(),t.lineWidth=h,t.strokeStyle=n.Zr,t.beginPath(),t.arc(e,u,n.tt*s+h/2,0,2*Math.PI,!1),t.stroke(),t.restore()}},t}(),gs=[{Be:0,De:.25,Fe:4,Pe:10,We:.25,Re:0,ze:.4,Oe:.8},{Be:.25,De:.525,Fe:10,Pe:14,We:0,Re:0,ze:.8,Oe:0},{Be:.525,De:1,Fe:14,Pe:14,We:0,Re:0,ze:0,Oe:0}];function ys(t,i,n,s){return I(t,n+(s-n)*i)}function ks(t,i){for(var n,s=t%2600/2600,h=0,r=gs;h<r.length;h++){var e=r[h];if(s>=e.Be&&s<=e.De){n=e;break}}A(void 0!==n,"Last price animation internal logic error");var u,o,l,a=(s-n.Be)/(n.De-n.Be);return{Ee:ys(i,a,n.We,n.Re),Zr:ys(i,a,n.ze,n.Oe),tt:(u=a,o=n.Fe,l=n.Pe,o+(l-o)*u)}}var xs=function(){function t(t){this.kt=new ps,this.Rt=!0,this.Ve=!0,this.Ie=performance.now(),this.He=this.Ie-1,this.je=t}return t.prototype.Ue=function(){this.He=this.Ie-1,this.update()},t.prototype.qe=function(){if(this.update(),2===this.je.options().lastPriceAnimation){var t=performance.now(),i=this.He-t;if(i>0)return void(i<650&&(this.He+=2600));this.Ie=t,this.He=t+2600}},t.prototype.update=function(){this.Rt=!0},t.prototype.Ye=function(){this.Ve=!0},t.prototype.lt=function(){return 0!==this.je.options().lastPriceAnimation},t.prototype.$e=function(){switch(this.je.options().lastPriceAnimation){case 0:return!1;case 1:return!0;case 2:return performance.now()<=this.He}},t.prototype.renderer=function(t,i){return this.Rt?(this.ut(t,i),this.Rt=!1,this.Ve=!1):this.Ve&&(this.Ke(),this.Ve=!1),this.kt},t.prototype.ut=function(t,i){this.kt.Z(null);var n=this.je.model().timeScale(),s=n.visibleStrictRange(),r=this.je.firstValue();if(null!==s&&null!==r){var e=this.je.lastValueData(!0);if(!e.noData&&s.contains(e.index)){var u=new h(n.indexToCoordinate(e.index),this.je.priceScale().priceToCoordinate(e.price,r.value)),o=e.color,l=this.je.options().lineWidth,a=ks(this.Ze(),o);this.kt.Z({Ae:o,Le:l,Ee:a.Ee,Zr:a.Zr,tt:a.tt,ye:u})}}},t.prototype.Ke=function(){var t=this.kt.js();if(null!==t){var i=ks(this.Ze(),t.Ae);t.Ee=i.Ee,t.Zr=i.Zr,t.tt=i.tt}},t.prototype.Ze=function(){return this.$e()?performance.now()-this.Ie:2599},t}();function Cs(t,i){return Ai(Math.min(Math.max(t,12),30)*i)}function Ns(t,i){switch(t){case"arrowDown":case"arrowUp":case"triangle":return Cs(i,1);case"circle":return Cs(i,.8);case"square":return Cs(i,.7)}}function Ss(t){return Ti(Cs(t,1))}function Ts(t){return Math.max(Cs(t,.1),3)}function As(t,i,n,s,h){var r=(Ns("arrowUp",h)-1)/2,e=(Ai(h/2)-1)/2;i.beginPath(),t?(i.moveTo(n-r,s),i.lineTo(n,s-r),i.lineTo(n+r,s),i.lineTo(n+e,s),i.lineTo(n+e,s+r),i.lineTo(n-e,s+r),i.lineTo(n-e,s)):(i.moveTo(n-r,s),i.lineTo(n,s+r),i.lineTo(n+r,s),i.lineTo(n+e,s),i.lineTo(n+e,s-r),i.lineTo(n-e,s-r),i.lineTo(n-e,s)),i.fill(),i.stroke()}var Ls=function(t){function i(){var i=null!==t&&t.apply(this,arguments)||this;return i.ot=null,i.Xe=new rt,i.F=-1,i.P="",i.Je="",i}return U(i,t),i.prototype.Z=function(t){this.ot=t},i.prototype.Ce=function(t,i){this.F===t&&this.P===i||(this.F=t,this.P=i,this.Je=st(t,i),this.Xe.reset())},i.prototype.Y=function(t){if(null!==this.ot&&null!==this.ot.X){t.textBaseline="middle",t.font=this.Je;for(var i=this.ot.X.from;i<this.ot.X.to;i++){var n=this.ot.J[i];void 0!==n.At&&(n.At.Zt=this.Xe.measureText(t,n.At.Ge),n.At.Dt=this.F),Es(n,t)}}},i}(ot);function Es(t,i){var n,s,h=t.Qe||("bottom"===t.tu?180:"right"===t.tu?90:"left"===t.tu?-90:0);i.strokeStyle=(null===(n=t.iu)||void 0===n?void 0:n.color)||"transparent",i.lineWidth=(null===(s=t.iu)||void 0===s?void 0:s.width)||1,i.fillStyle=t.bt,void 0!==t.At&&function(t,i,n,s){t.fillText(i,n,s)}(i,t.At.Ge,t.x-t.At.Zt/2,t.At.dt),h&&(i.save(),i.translate(t.x,t.dt),i.rotate(h*(Math.PI/180)),i.translate(-t.x,-t.dt)),function(t,i){if(0===t.nu)return;switch(t.su){case"triangle":return void function(t,i,n,s){var h=s/2;t.beginPath(),t.moveTo(i,n-h),t.lineTo(i+h,n+h),t.lineTo(i-h,n+h),t.closePath(),t.fill(),t.stroke()}(i,t.x,t.dt,t.nu);case"arrowDown":return void As(!1,i,t.x,t.dt,t.nu);case"arrowUp":return void As(!0,i,t.x,t.dt,t.nu);case"circle":return void function(t,i,n,s){var h=(Ns("circle",s)-1)/2;t.beginPath(),t.arc(i,n,h,0,2*Math.PI,!1),t.fill()}(i,t.x,t.dt,t.nu);case"square":return void function(t,i,n,s){var h=Ns("square",s),r=(h-1)/2,e=i-r,u=n-r;t.fillRect(e,u,h,h)}(i,t.x,t.dt,t.nu)}t.su}(t,i),h&&i.restore()}function Bs(t,i,n,s,h,r,e,u,o){var l=Z(n)?n:n.close,a=Z(n)?n:n.high,f=Z(n)?n:n.low,c=Z(i.size)?Math.max(i.size,0):1,v=Ss(u.barSpacing())*c,d=v/2;switch(t.nu=v,i.position){case"price":var _=i.price||l,w=i.anchor||"center",M="top"===w?1:"bottom"===w?-1:0,b="left"===w?1:"right"===w?-1:0;return t.dt=e.priceToCoordinate(_,o)+d*M,t.x=t.x+d*b,void(void 0!==t.At&&(t.At.dt=t.dt+(d+r+.6*h)*M||1));case"inBar":return t.dt=e.priceToCoordinate(l,o),void(void 0!==t.At&&(t.At.dt=t.dt+d+r+.6*h));case"aboveBar":return t.dt=e.priceToCoordinate(a,o)-d-s.hu,void 0!==t.At&&(t.At.dt=t.dt-d-.6*h,s.hu+=1.2*h),void(s.hu+=v+r);case"belowBar":return t.dt=e.priceToCoordinate(f,o)+d+s.ru,void 0!==t.At&&(t.At.dt=t.dt+d+r+.6*h,s.ru+=1.2*h),void(s.ru+=v+r)}i.position}var Ds=function(){function t(t,i){this.Rt=!0,this.eu=!0,this.uu=!0,this.ou=null,this.kt=new Ls,this.je=t,this.Mi=i,this.ot={J:[],X:null}}return t.prototype.update=function(t){this.Rt=!0,this.uu=!0,"data"===t&&(this.eu=!0)},t.prototype.renderer=function(t,i,n){if(!this.je.visible())return null;this.Rt&&this.yr();var s=this.Mi.options().layout;return this.kt.Ce(s.fontSize,s.fontFamily),this.kt.Z(this.ot),this.kt},t.prototype.lu=function(){if(this.uu){if(this.je.indexedMarkers().length>0){var t=this.Mi.timeScale().barSpacing(),i=Ts(t),n=1.5*Ss(t)+2*i;this.ou={above:n,below:n}}else this.ou=null;this.uu=!1}return this.ou},t.prototype.yr=function(){var t=this.je.priceScale(),i=this.Mi.timeScale(),n=this.je.indexedMarkers();this.eu&&(this.ot.J=n.map((function(t){return{time:t.time,x:0,dt:0,nu:0,iu:t.stroke,su:t.shape,tu:t.anchor,bt:t.color,Qe:t.rotation,au:t.internalId,fu:t.id,At:void 0}})),this.eu=!1);var s=this.Mi.options().layout;this.ot.X=null;var h=i.visibleStrictRange();if(null!==h){var r=this.je.firstValue();if(null!==r&&0!==this.ot.J.length){var e=NaN,u=Ts(i.barSpacing()),o={hu:u,ru:u};this.ot.X=$n(this.ot.J,h,!0);for(var l=this.ot.X.from;l<this.ot.X.to;l++){var a=n[l];a.time!==e&&(o.hu=u,o.ru=u,e=a.time);var f=this.ot.J[l];f.x=i.indexToCoordinate(a.time),void 0!==a.text&&a.text.length>0&&(f.At={Ge:a.text,dt:0,Zt:0,Dt:0});var c=this.je.dataAt(a.time);null!==c&&Bs(f,a,c,o,s.fontSize,u,t,i,r.value)}this.Rt=!1}}},t}(),Fs=function(t){function i(i){return t.call(this,i)||this}return U(i,t),i.prototype.ti=function(t,i){var n=this.Te;n.lt=!1;var s=this.pr.options();if(s.priceLineVisible&&this.pr.visible()){var h=this.pr.lastValueData(0===s.priceLineSource);h.noData||(n.lt=!0,n.dt=h.coordinate,n.bt=this.pr.priceLineColor(h.color),n.Zt=i,n.Dt=t,n.Mt=s.priceLineWidth,n.gt=s.priceLineStyle)}},i}(bs),Ps=function(t){function i(i){var n=t.call(this)||this;return n.xt=i,n}return U(i,t),i.prototype.qt=function(t,i,n){t.lt=!1,i.lt=!1;var s=this.xt;if(s.visible()){var h=s.options(),r=h.lastValueVisible,e=""!==s.title(),u=0===h.seriesLastValueMode,o=s.lastValueData(!1);if(!o.noData){r&&(t.At=this.cu(o,r,u),t.lt=0!==t.At.length),(e||u)&&(i.At=this.vu(o,r,e,u),i.lt=i.At.length>0);var l=s.priceLineColor(o.color),a=H(l);n.p=a.p,n.bt=a.g,n.Lt=o.coordinate,i.Bt=s.model().backgroundColorAtYPercentFromTop(o.coordinate/s.priceScale().height()),t.Bt=l}}},i.prototype.vu=function(t,i,n,s){var h="",r=this.xt.title();return n&&0!==r.length&&(h+="".concat(r," ")),i&&s&&(h+=this.xt.priceScale().isPercentage()?t.formattedPriceAbsolute:t.formattedPricePercentage),h.trim()},i.prototype.cu=function(t,i,n){return i?n?this.xt.priceScale().isPercentage()?t.formattedPricePercentage:t.formattedPriceAbsolute:t.text:""},i}(pt),Ws=function(){function t(t,i){this.Kn=t,this.du=i||null}return t.prototype.priceRange=function(){return this.Kn},t.prototype.margins=function(){return this.du},t.prototype.toRaw=function(){return null===this.Kn?null:{priceRange:this.Kn.toRaw(),margins:this.du||void 0}},t.fromRaw=function(i){return null===i?null:new t(xi.fromRaw(i.priceRange),i.margins)},t}(),Rs=function(t){function i(i,n){var s=t.call(this,i)||this;return s._u=n,s}return U(i,t),i.prototype.ti=function(t,i){var n=this._u.options(),s=this.Te;if(s.lt=!1,this.pr.visible()&&n.visible&&n.lineVisible){var h,r=this._u.yCoord();if(null!==r)void 0!==n.index&&(h=this.Qt.timeScale().indexToCoordinate(n.index)),s.lt=!0,s.dt=r,s.vt=h,s.bt=n.color,s.Zt=i,s.Dt=t,s.Mt=n.lineWidth,s.gt=n.lineStyle}},i}(bs),zs=function(t){function i(i,n){var s=t.call(this)||this;return s.je=i,s._u=n,s}return U(i,t),i.prototype.qt=function(t,i,n){t.lt=!1,i.lt=!1;var s=this._u.options(),h=s.axisLabelVisible,r=""!==s.title,e=this.je;if(h&&s.visible&&e.visible()){var u=this._u.yCoord();if(null!==u){r&&(i.At=s.title,i.lt=!0),i.Bt=e.model().backgroundColorAtYPercentFromTop(u/e.priceScale().height()),t.At=e.priceScale().formatPriceAbsolute(s.price),t.lt=!0;var o=H(s.color);n.p=o.p,n.bt=o.g,n.Lt=u}}},i}(pt),Os=function(){function t(t,i){this.je=t,this.bi=i,this.wu=new Rs(t,this),this.Mu=new zs(t,this),this.bu=new ws(this.Mu,t,t.model())}return t.prototype.applyOptions=function(t){K(this.bi,t),this.update(),this.je.model().lightUpdate()},t.prototype.options=function(){return this.bi},t.prototype.paneViews=function(){return[this.wu,this.bu]},t.prototype.priceAxisView=function(){return this.Mu},t.prototype.update=function(){this.wu.Ct(),this.Mu.update()},t.prototype.yCoord=function(){var t=this.je,i=t.priceScale();if(t.model().timeScale().isEmpty()||i.isEmpty())return null;var n=t.firstValue();return null===n?null:i.priceToCoordinate(this.bi.price,n.value)},t}(),Vs=function(t){function i(i){var n=t.call(this)||this;return n.Mi=i,n}return U(i,t),i.prototype.model=function(){return this.Mi},i}(Tt),Is={barColor:"",barBorderColor:"",barWickColor:""},Hs=function(){function t(t){this.je=t}return t.prototype.barStyle=function(t,i){var n=this.je.seriesType(),s=this.je.options();switch(n){case"Line":return this.mu(s,t,i);case"Area":return this.pu(s);case"CloudArea":return this.gu(s);case"BrokenArea":return this.yu(s);case"Baseline":return this.ku(s,t,i);case"Bar":return this.xu(s,t,i);case"Candlestick":return this.Cu(s,t,i);case"Histogram":return this.Nu(s,t,i)}throw new Error("Unknown chart style")},t.prototype.xu=function(t,i,n){var s=q({},Is),h=t.upColor,r=t.downColor,e=h,u=r,o=E(this.Su(i,n)),l=B(o.value[0])<=B(o.value[3]);return void 0!==o.color?(s.barColor=o.color,s.barBorderColor=o.color):(s.barColor=l?h:r,s.barBorderColor=l?e:u),s},t.prototype.Cu=function(t,i,n){var s,h,r,e=q({},Is),u=t.upColor,o=t.downColor,l=t.borderUpColor,a=t.borderDownColor,f=t.wickUpColor,c=t.wickDownColor,v=E(this.Su(i,n)),d=B(v.value[0])<=B(v.value[3]);return e.barColor=null!==(s=v.color)&&void 0!==s?s:d?u:o,e.barBorderColor=null!==(h=v.borderColor)&&void 0!==h?h:d?l:a,e.barWickColor=null!==(r=v.wickColor)&&void 0!==r?r:d?f:c,e},t.prototype.pu=function(t){return q(q({},Is),{barColor:t.lineColor})},t.prototype.ku=function(t,i,n){var s=E(this.Su(i,n)).value[3]>=t.baseValue.price;return q(q({},Is),{barColor:s?t.topLineColor:t.bottomLineColor})},t.prototype.gu=function(t){return q(q({},Is),{barColor:t.higherLineColor})},t.prototype.yu=function(t){return q(q({},Is),{barColor:t.color})},t.prototype.mu=function(t,i,n){var s,h=E(this.Su(i,n));return q(q({},Is),{barColor:null!==(s=h.color)&&void 0!==s?s:t.color})},t.prototype.Nu=function(t,i,n){var s=q({},Is),h=E(this.Su(i,n));return s.barColor=void 0!==h.color?h.color:t.color,s},t.prototype.Su=function(t,i){return void 0!==i?i.value:this.je.bars().valueAt(t)},t}(),js=function(){function t(){this.Tu=[],this.Au=new Map,this.Lu=new Map}return t.prototype.last=function(){return this.size()>0?this.Tu[this.Tu.length-1]:null},t.prototype.firstIndex=function(){return this.size()>0?this.Eu(0):null},t.prototype.lastIndex=function(){return this.size()>0?this.Eu(this.Tu.length-1):null},t.prototype.size=function(){return this.Tu.length},t.prototype.isEmpty=function(){return 0===this.size()},t.prototype.contains=function(t){return null!==this.Bu(t,0)},t.prototype.valueAt=function(t){return this.search(t)},t.prototype.search=function(t,i){void 0===i&&(i=0);var n=this.Bu(t,i);return null===n?null:q(q({},this.Du(n)),{index:this.Eu(n)})},t.prototype.rows=function(){return this.Tu},t.prototype.minMaxOnRangeCached=function(t,i,n){if(this.isEmpty())return null;for(var s=null,h=0,r=n;h<r.length;h++){var e=r[h];s=Us(s,this.Fu(t,i,e))}return s},t.prototype.setData=function(t){this.Lu.clear(),this.Au.clear(),this.Tu=t},t.prototype.Eu=function(t){return this.Tu[t].index},t.prototype.Du=function(t){return this.Tu[t]},t.prototype.Bu=function(t,i){var n=this.Pu(t);if(null===n&&0!==i)switch(i){case-1:return this.Wu(t);case 1:return this.Ru(t);default:throw new TypeError("Unknown search mode")}return n},t.prototype.Wu=function(t){var i=this.zu(t);return i>0&&(i-=1),i!==this.Tu.length&&this.Eu(i)<t?i:null},t.prototype.Ru=function(t){var i=this.Ou(t);return i!==this.Tu.length&&t<this.Eu(i)?i:null},t.prototype.Pu=function(t){var i=this.zu(t);return i===this.Tu.length||t<this.Tu[i].index?null:i},t.prototype.zu=function(t){return jn(this.Tu,t,(function(t,i){return t.index<i}))},t.prototype.Ou=function(t){return Un(this.Tu,t,(function(t,i){return i.index>t}))},t.prototype.Vu=function(t,i,n){for(var s=null,h=t;h<i;h++){var r=this.Tu[h].value[n];Number.isNaN(r)||(null===s?s={min:r,max:r}:(r<s.min&&(s.min=r),r>s.max&&(s.max=r)))}return s},t.prototype.Fu=function(t,i,n){if(this.isEmpty())return null;var s=null,h=E(this.firstIndex()),r=E(this.lastIndex()),e=Math.max(t,h),u=Math.min(i,r),o=30*Math.ceil(e/30),l=Math.max(o,30*Math.floor(u/30)),a=this.zu(e),f=this.Ou(Math.min(u,o,i));s=Us(s,this.Vu(a,f,n));var c=this.Au.get(n);void 0===c&&(c=new Map,this.Au.set(n,c));for(var v=Math.max(o+1,e);v<l;v+=30){var d=Math.floor(v/30),_=c.get(d);if(void 0===_){var w=this.zu(30*d),M=this.Ou(30*(d+1)-1);_=this.Vu(w,M,n),c.set(d,_)}s=Us(s,_)}a=this.zu(l),f=this.Ou(u);return s=Us(s,this.Vu(a,f,n))},t}();function Us(t,i){return null===t?i:null===i?t:{min:Math.min(t.min,i.min),max:Math.max(t.max,i.max)}}var qs=function(t){function i(i,n,s){var h=t.call(this,i)||this;h.ot=new js,h.wu=new Fs(h),h.Iu=[],h.Hu=new ms(h),h.ju=null,h.Uu=null,h.qu=[],h.Yu=[],h.$u=null,h.bi=n,h.Ku=s;var r=new Ps(h);return h.fi=[r],h.Zu=new ws(r,h,i),"Area"!==s&&"Line"!==s&&"Baseline"!==s||(h.ju=new xs(h)),h.Xu(),h.Ju(),h}return U(i,t),i.prototype.destroy=function(){null!==this.$u&&clearTimeout(this.$u)},i.prototype.priceLineColor=function(t){return this.bi.priceLineColor||t},i.prototype.lastValueData=function(t){var i={noData:!0},n=this.priceScale();if(this.model().timeScale().isEmpty()||n.isEmpty()||this.ot.isEmpty())return i;var s,h,r=this.model().timeScale().visibleStrictRange(),e=this.firstValue();if(null===r||null===e)return i;if(t){var u=this.ot.last();if(null===u)return i;s=u,h=u.index}else{var o=this.ot.search(r.right(),-1);if(null===o)return i;if(null===(s=this.ot.valueAt(o.index)))return i;h=o.index}var l=s.value[3],a=this.barColorer().barStyle(h,{value:s}),f=n.priceToCoordinate(l,e.value);return{noData:!1,price:l,text:n.formatPrice(l,e.value),formattedPriceAbsolute:n.formatPriceAbsolute(l),formattedPricePercentage:n.formatPricePercentage(l,e.value),color:a.barColor,coordinate:f,index:h}},i.prototype.barColorer=function(){return null!==this.Uu||(this.Uu=new Hs(this)),this.Uu},i.prototype.options=function(){return this.bi},i.prototype.applyOptions=function(t){var i,n=t.priceScaleId;void 0!==n&&n!==this.bi.priceScaleId&&this.model().moveSeriesToScale(this,n);var s=null!==(i=this.bi.pane)&&void 0!==i?i:0;K(this.bi,t),null!==this._priceScale&&void 0!==t.scaleMargins&&this._priceScale.applyOptions({scaleMargins:t.scaleMargins}),void 0!==t.priceFormat&&(this.Xu(),this.model().fullUpdate()),t.pane&&s!==t.pane&&this.model().moveSeriesToPane(this,s,t.pane),this.model().updateSource(this),this.model().updateCrosshair(),this.ki.update("options")},i.prototype.setData=function(t,i){this.ot.setData(t),this.Gu(),this.ki.update("data"),this.mi.update("data"),null!==this.ju&&(i&&i.lastBarUpdatedOrNewBarsAddedToTheRight?this.ju.qe():0===t.length&&this.ju.Ue());var n=this.model().paneForSource(this);this.model().recalculatePane(n),this.model().updateSource(this),this.model().updateCrosshair(),this.model().lightUpdate()},i.prototype.setMarkers=function(t){this.qu=t.map((function(t){return q({},t)})),this.Gu();var i=this.model().paneForSource(this);this.mi.update("data"),this.model().recalculatePane(i),this.model().updateSource(this),this.model().updateCrosshair(),this.model().lightUpdate()},i.prototype.indexedMarkers=function(){return this.Yu},i.prototype.createPriceLine=function(t){var i=new Os(this,t);return this.Iu.push(i),this.model().updateSource(this),i},i.prototype.removePriceLine=function(t){var i=this.Iu.indexOf(t);-1!==i&&this.Iu.splice(i,1),this.model().updateSource(this)},i.prototype.getPriceLine=function(t,i){var n=this.priceScale(),s=n.priceRange();n.isLog()&&(s=zi(s,n.logFormula()));var h=1e-4;s&&(h=16/n.height()*(Math.abs(s.length())/t));for(var r=0;r<this.Iu.length;r++){var e=this.Iu[r],u=this.Iu[r].options(),o=u.price,l=u.index;if((void 0===i||void 0===l||i>=l)&&Math.abs(Math.abs(o-t)/t)<Math.abs(h))return e}return null},i.prototype.removeAllPriceLines=function(){this.Iu.splice(0,this.Iu.length)},i.prototype.seriesType=function(){return this.Ku},i.prototype.firstValue=function(){var t=this.firstBar();return null===t?null:{value:t.value[3],timePoint:t.time}},i.prototype.firstBar=function(){var t=this.model().timeScale().visibleStrictRange();if(null===t)return null;var i=t.left();return this.ot.search(i,1)},i.prototype.bars=function(){return this.ot},i.prototype.dataAt=function(t){var i=this.ot.valueAt(t);return null===i?null:"Bar"===this.Ku||"Candlestick"===this.Ku?{open:i.value[0],high:i.value[1],low:i.value[2],close:i.value[3]}:i.value[3]},i.prototype.topPaneViews=function(t){var i=this,n=this.ju;return null!==n&&n.lt()?(null===this.$u&&n.$e()&&(this.$u=setTimeout((function(){i.$u=null,i.model().cursorUpdate()}),0)),n.Ye(),[n]):[]},i.prototype.paneViews=function(){var t=[];this.Qu()||t.push(this.Hu);for(var i=0,n=this.Iu;i<n.length;i++){var s=n[i];t.push.apply(t,s.paneViews())}return t.push(this.ki,this.wu,this.Zu,this.mi),t},i.prototype.priceAxisViews=function(t,i){if(i!==this._priceScale&&!this.Qu())return[];for(var n=Y([],this.fi,!0),s=0,h=this.Iu;s<h.length;s++){var r=h[s];n.push(r.priceAxisView())}return n},i.prototype.autoscaleInfo=function(t,i){var n=this;if(void 0!==this.bi.autoscaleInfoProvider){var s=this.bi.autoscaleInfoProvider((function(){var s=n.io(t,i);return null===s?null:s.toRaw()}));return Ws.fromRaw(s)}return this.io(t,i)},i.prototype.minMove=function(){return this.bi.priceFormat.minMove},i.prototype.formatter=function(){return this.ls},i.prototype.updateAllViews=function(){var t;this.ki.update(),this.mi.update();for(var i=0,n=this.fi;i<n.length;i++){n[i].update()}for(var s=0,h=this.Iu;s<h.length;s++){h[s].update()}this.wu.Ct(),this.Hu.Ct(),null===(t=this.ju)||void 0===t||t.update()},i.prototype.priceScale=function(){return E(t.prototype.priceScale.call(this))},i.prototype.markerDataAtIndex=function(t){if(!(("Line"===this.Ku||"Area"===this.Ku||"Baseline"===this.Ku)&&this.bi.crosshairMarkerVisible))return null;var i=this.ot.valueAt(t);return null===i?null:{price:i.value[3],radius:this.no(),borderColor:this.so(),backgroundColor:this.ho(t)}},i.prototype.title=function(){return this.bi.title},i.prototype.visible=function(){return this.bi.visible},i.prototype.setExtensionsBoundaries=function(t){this.ki.se(t)},i.prototype.Qu=function(){return!Lt(this.priceScale().id())},i.prototype.io=function(t,i){if(!X(t)||!X(i)||this.ot.isEmpty())return null;var n="Line"===this.Ku||"Area"===this.Ku||"Baseline"===this.Ku||"Histogram"===this.Ku?[3]:[2,1],s=this.ot.minMaxOnRangeCached(t,i,n),h=null!==s?new xi(s.min,s.max):null;if("Histogram"===this.seriesType()){var r=this.bi.base,e=new xi(r,r);h=null!==h?h.merge(e):e}return new Ws(h,this.mi.lu())},i.prototype.no=function(){switch(this.Ku){case"Line":case"Area":case"Baseline":return this.bi.crosshairMarkerRadius}return 0},i.prototype.so=function(){switch(this.Ku){case"Line":case"Area":case"Baseline":var t=this.bi.crosshairMarkerBorderColor;if(0!==t.length)return t}return null},i.prototype.ho=function(t){switch(this.Ku){case"Line":case"Area":case"Baseline":var i=this.bi.crosshairMarkerBackgroundColor;if(0!==i.length)return i}return this.barColorer().barStyle(t).barColor},i.prototype.Xu=function(){switch(this.bi.priceFormat.type){case"custom":this.ls={format:this.bi.priceFormat.formatter};break;case"volume":this.ls=new Rn(this.bi.priceFormat.precision);break;case"percent":this.ls=new ki(this.bi.priceFormat.precision);break;default:var t=Math.pow(10,this.bi.priceFormat.precision);this.ls=new yi(t,this.bi.priceFormat.minMove*t)}null!==this._priceScale&&this._priceScale.updateFormatter()},i.prototype.Gu=function(){var t=this,i=this.model().timeScale();if(i.isEmpty()||0===this.ot.size())this.Yu=[];else{var n=E(this.ot.firstIndex());this.Yu=this.qu.map((function(s,h){var r=E(i.timeToIndex(s.time,!0)),e=r<n?1:-1;return{time:E(t.ot.search(r,e)).index,position:s.position,rotation:s.rotation,shape:s.shape,color:s.color,stroke:s.stroke,anchor:s.anchor,price:s.price,id:s.id,internalId:h,text:s.text,size:s.size}}))}},i.prototype.Ju=function(){switch(this.mi=new Ds(this,this.model()),this.Ku){case"Bar":this.ki=new Qn(this,this.model());break;case"Candlestick":this.ki=new us(this,this.model());break;case"Line":this.ki=new ds(this,this.model());break;case"Area":this.ki=new Xn(this,this.model());break;case"CloudArea":this.ki=new ls(this,this.model());break;case"BrokenArea":this.ki=new rs(this,this.model());break;case"Baseline":this.ki=new ns(this,this.model());break;case"Histogram":this.ki=new vs(this,this.model());break;default:throw Error("Unknown chart style assigned: "+this.Ku)}},i}(Vs),Ys=function(){function t(t){this.ro=!1,this.eo=t}return t.prototype.enable=function(){this.ro=!0},t.prototype.disable=function(){this.ro=!1},t.prototype.align=function(t,i,n){if(!this.ro)return t;var s=t,h=n.defaultPriceScale(),r=h.firstValue();if(null===r)return s;var e=h.priceToCoordinate(t,r),u=n.dataSources().filter((function(t){return t instanceof qs})).reduce((function(t,s){if(n.isOverlay(s)||!s.visible())return t;var h=s.priceScale(),r=s.bars();if(h.isEmpty()||!r.contains(i))return t;var e=r.valueAt(i);if(null===e)return t;var u=B(s.firstValue());return t.push(h.priceToCoordinate(e.value[3],u.value),h.priceToCoordinate(e.value[2],u.value),h.priceToCoordinate(e.value[1],u.value),h.priceToCoordinate(e.value[0],u.value)),t}),[]);if(0===u.length)return s;u.sort((function(t,i){return Math.abs(t-e)-Math.abs(i-e)}));var o=u[0];return Math.abs(o-e)<this.eo&&(s=h.coordinateToPrice(o,r)),s},t}(),$s=function(t){return t.getUTCFullYear()};function Ks(t,i,n){return i.replace(/yyyy/g,function(t){return gi($s(t),4)}(t)).replace(/yy/g,function(t){return gi($s(t)%100,2)}(t)).replace(/MMMM/g,function(t,i){return new Date(t.getUTCFullYear(),t.getUTCMonth(),1).toLocaleString(i,{month:"long"})}(t,n)).replace(/MMM/g,function(t,i){return new Date(t.getUTCFullYear(),t.getUTCMonth(),1).toLocaleString(i,{month:"short"})}(t,n)).replace(/MM/g,function(t){return gi(function(t){return t.getUTCMonth()+1}(t),2)}(t)).replace(/dd/g,function(t){return gi(function(t){return t.getUTCDate()}(t),2)}(t))}var Zs=function(){function t(t,i){void 0===t&&(t="yyyy-MM-dd"),void 0===i&&(i="default"),this.uo=t,this.oo=i}return t.prototype.lo=function(t){return Ks(t,this.uo,this.oo)},t}(),Xs=function(){function t(t){this.ao=t||"%h:%m:%s"}return t.prototype.lo=function(t){return this.ao.replace("%h",gi(t.getUTCHours(),2)).replace("%m",gi(t.getUTCMinutes(),2)).replace("%s",gi(t.getUTCSeconds(),2))},t}(),Js={fo:"yyyy-MM-dd",co:"%h:%m:%s",vo:" ",do:"default"},Gs=function(){function t(t){void 0===t&&(t={});var i=q(q({},Js),t);this._o=new Zs(i.fo,i.do),this.wo=new Xs(i.co),this.Mo=i.vo}return t.prototype.lo=function(t){return"".concat(this._o.lo(t)).concat(this.Mo).concat(this.wo.lo(t))},t}();var Qs=function(){function t(t,i){void 0===i&&(i=50),this.bo=0,this.mo=1,this.po=1,this.T=new Map,this.yo=new Map,this.ko=t,this.xo=i}return t.prototype.lo=function(t){var i=void 0===t.businessDay?new Date(1e3*t.timestamp).getTime():new Date(Date.UTC(t.businessDay.year,t.businessDay.month-1,t.businessDay.day)).getTime(),n=this.T.get(i);if(void 0!==n)return n.Co;if(this.bo===this.xo){var s=this.yo.get(this.po);this.yo.delete(this.po),this.T.delete(L(s)),this.po++,this.bo--}var h=this.ko(t);return this.T.set(i,{Co:h,No:this.mo}),this.yo.set(this.mo,i),this.bo++,this.mo++,h},t}(),th=function(){function t(t,i){A(t<=i,"right should be >= left"),this.So=t,this.To=i}return t.prototype.left=function(){return this.So},t.prototype.right=function(){return this.To},t.prototype.valueAt=function(t){return this.So+(this.To-this.So)*t},t.prototype.count=function(){return this.To-this.So+1},t.prototype.contains=function(t){return this.So<=t&&t<=this.To},t.prototype.equals=function(t){return this.So===t.left()&&this.To===t.right()},t}();function ih(t,i){return null===t||null===i?t===i:t.equals(i)}var nh,sh,hh=function(){function t(){this.Ao=new Map,this.T=null}return t.prototype.Lo=function(t,i){this.Eo(i),this.T=null;for(var n=i;n<t.length;++n){var s=t[n],h=this.Ao.get(s.timeWeight);void 0===h&&(h=[],this.Ao.set(s.timeWeight,h)),h.push({Bo:n,gi:s.time,Do:s.timeWeight})}},t.prototype.Fo=function(t,i){var n=Math.ceil(i/t);return null!==this.T&&this.T.Po===n||(this.T={qn:this.Wo(n),Po:n}),this.T.qn},t.prototype.Eo=function(t){if(0!==t){var i=[];this.Ao.forEach((function(n,s){t<=n[0].Bo?i.push(s):n.splice(jn(n,t,(function(i){return i.Bo<t})),1/0)}));for(var n=0,s=i;n<s.length;n++){var h=s[n];this.Ao.delete(h)}}else this.Ao.clear()},t.prototype.Wo=function(t){for(var i=[],n=0,s=Array.from(this.Ao.keys()).sort((function(t,i){return i-t}));n<s.length;n++){var h=s[n];if(this.Ao.get(h)){var r=i;i=[];for(var e=r.length,u=0,o=L(this.Ao.get(h)),l=o.length,a=1/0,f=-1/0,c=0;c<l;c++){for(var v=o[c],d=v.Bo;u<e;){var _=r[u],w=_.Bo;if(!(w<d)){a=w;break}u++,i.push(_),f=w,a=1/0}a-d>=t&&d-f>=t&&(i.push(v),f=d)}for(;u<e;u++)i.push(r[u])}}return i},t}(),rh=function(){function t(t){this.Ro=t}return t.prototype.zo=function(){return null===this.Ro?null:new th(Math.floor(this.Ro.left()),Math.ceil(this.Ro.right()))},t.prototype.Oo=function(){return this.Ro},t.Vo=function(){return new t(null)},t}();!function(t){t[t.Year=0]="Year",t[t.Month=1]="Month",t[t.DayOfMonth=2]="DayOfMonth",t[t.Time=3]="Time",t[t.TimeWithSeconds=4]="TimeWithSeconds"}(nh||(nh={})),function(t){t[t.Normal=0]="Normal",t[t.Euclidean=1]="Euclidean"}(sh||(sh={}));var eh=function(){function t(t,i,n){this.As=0,this.Io=null,this.Ho=[],this.os=null,this.us=null,this.jo=new hh,this.Uo=new Map,this.qo=rh.Vo(),this.Yo=rh.Vo(),this.$o=!0,this.Ko=new $,this.Zo=new $,this.Xo=new $,this.Jo=null,this.Go=null,this.Qo=[],this.bi=i,this.vs=n,this.tl=i.rightOffset,this.il=i.barSpacing,this.Mi=t,this.nl()}return t.prototype.options=function(){return this.bi},t.prototype.applyLocalizationOptions=function(t){K(this.vs,t),this.sl(),this.nl()},t.prototype.applyOptions=function(t,i){var n;K(this.bi,t),this.bi.fixLeftEdge&&this.hl(),this.bi.fixRightEdge&&this.rl(),void 0!==t.barSpacing&&this.Mi.setBarSpacing(t.barSpacing),void 0!==t.rightOffset&&this.Mi.setRightOffset(t.rightOffset),void 0!==t.minBarSpacing&&this.Mi.setBarSpacing(null!==(n=t.barSpacing)&&void 0!==n?n:this.il),this.sl(),this.nl(),this.Xo.fire()},t.prototype.indexToTime=function(t){var i;return(null===(i=this.Ho[t])||void 0===i?void 0:i.time)||null},t.prototype.floatIndexToTime=function(t){var i,n,s,h,r=Math.floor(t),e=Math.ceil(t),u=null===(i=this.Ho[r])||void 0===i?void 0:i.time.timestamp,o=null===(n=this.Ho[e])||void 0===n?void 0:n.time.timestamp,l=null===(s=this.Ho[0])||void 0===s?void 0:s.time.timestamp,a=null===(h=this.Ho[this.Ho.length-1])||void 0===h?void 0:h.time.timestamp,f=0;return f=this.Ho.length>=2?this.Ho[1].time.timestamp-this.Ho[0].time.timestamp:0-this.Ho[0].time.timestamp,t>=this.Ho.length-1?a+f*(t-this.Ho.length+1):t<0?l-f*-t:u&&o?u+(o-u)*(t-r):null},t.prototype.timeToIndex=function(t,i){if(this.Ho.length<1)return null;if(t.timestamp>this.Ho[this.Ho.length-1].time.timestamp)return i?this.Ho.length-1:null;var n=jn(this.Ho,t.timestamp,(function(t,i){return t.time.timestamp<i}));return t.timestamp<this.Ho[n].time.timestamp?i?n:null:n},t.prototype.timeToFloatIndex=function(t,i){var n=this.timeToIndex(t,i);if(null===n)return null;var s=Math.max(n-1,0),h=this.Ho[s].time.timestamp,r=this.Ho[n].time.timestamp;return s+(1-(r-t.timestamp)/(r-h))},t.prototype.isEmpty=function(){return 0===this.As||0===this.Ho.length||null===this.Io},t.prototype.visibleStrictRange=function(){return this.el(),this.qo.zo()},t.prototype.visibleLogicalRange=function(){return this.el(),this.qo.Oo()},t.prototype.visibleTimeRange=function(){var t=this.visibleStrictRange();if(null===t)return null;var i={from:t.left(),to:t.right()};return this.timeRangeForLogicalRange(i)},t.prototype.timeRangeForLogicalRange=function(t){var i=Math.round(t.from),n=Math.round(t.to),s=E(this.ul()),h=E(this.ol());return{from:E(this.indexToTime(Math.max(s,i))),to:E(this.indexToTime(Math.min(h,n)))}},t.prototype.logicalRangeForTimeRange=function(t){return{from:E(this.timeToFloatIndex(t.from,!0)),to:E(this.timeToFloatIndex(t.to,!0))}},t.prototype.width=function(){return this.As},t.prototype.setWidth=function(t){if(isFinite(t)&&!(t<=0)&&this.As!==t){if(this.bi.lockVisibleTimeRangeOnResize&&this.As){var i=this.il*t/this.As;this.il=i}if(this.bi.fixLeftEdge){var n=this.visibleStrictRange();if(null!==n)if(n.left()<=0){var s=this.As-t;this.tl-=Math.round(s/this.il)+1}}this.As=t,this.$o=!0,this.ll(),this.al()}},t.prototype.indexToCoordinate=function(t){if(this.isEmpty())return 0;if(1===this.bi.mode){var i=this.indexToTime(t);return i?this.timeToCoordinate(i):0}if(!X(t))return 0;var n=this.baseIndex()+this.tl-t;return this.As-(n+.5)*this.il-1},t.prototype.indexesToCoordinates=function(t,i){var n;if(1===this.bi.mode)for(var s=this.Yo.Oo(),h=(null==s?void 0:s.left())||0,r=(null==s?void 0:s.right())||0,e=0;e<t.length;e++){var u=(null===(n=this.indexToTime(t[e].time))||void 0===n?void 0:n.timestamp)||0;t[e].x=this.As*((u-h)/(r-h))}else{var o=this.baseIndex(),l=void 0===i?0:i.from,a=void 0===i?t.length:i.to;for(e=l;e<a;e++){var f=t[e].time,c=o+this.tl-f,v=this.As-(c+.5)*this.il-1;t[e].x=v}}},t.prototype.timeToCoordinate=function(t){if(1===this.bi.mode){var i=this.Yo.Oo(),n=(null==i?void 0:i.left())||0,s=(null==i?void 0:i.right())||0,h=t.timestamp;return this.As*((h-n)/(s-n))}var r=this.timeToIndex(t,!0),e=this.Ho[r].time.timestamp,u=this.indexToCoordinate(r);if(e===t.timestamp)return u;if(0===r||r===this.Ho.length-1){var o=0-this.Ho[0].time.timestamp;return 2===this.Ho.length&&(o=this.Ho[1].time.timestamp-this.Ho[0].time.timestamp),u+(t.timestamp-e)/o*this.barSpacing()}return u},t.prototype.indexesToCoordinatesExtensions=function(t,i,n){for(var s=this.baseIndex(),h=void 0===n?0:n.from,r=void 0===n?t.length:n.to,e=h;e<r;e++){var u=t[e].time,o=s+this.tl-u,l=this.As-(o+.5)*this.il-1;t[e].x=l,void 0!==t[e].id&&i[t[e].id]?(o=s+this.tl-i[t[e].id],l=this.As-(o+.5)*this.il-1,t[e].end=l):t[e].end=this.As}},t.prototype.coordinateToIndex=function(t){return Math.ceil(this.fl(t))},t.prototype.coordinateToTime=function(t){var i=0-this.Ho[0].time.timestamp;this.Ho.length>=2&&(i=this.Ho[1].time.timestamp-this.Ho[0].time.timestamp);var n=this.coordinateToIndex(t);if(n>=this.Ho.length){var s=i*(n-this.Ho.length+1);return{timestamp:this.Ho[this.Ho.length-1].time.timestamp+s}}if(n<0){s=i*-n;return{timestamp:this.Ho[0].time.timestamp-s}}return this.Ho[n].time},t.prototype.setRightOffset=function(t){this.$o=!0,this.tl=t,this.al(),this.Mi.recalculateAllPanes(),this.Mi.lightUpdate()},t.prototype.barSpacing=function(){return this.il},t.prototype.setBarSpacing=function(t){this.cl(t),this.al(),this.Mi.recalculateAllPanes(),this.Mi.lightUpdate()},t.prototype.rightOffset=function(){return this.tl},t.prototype.marks=function(){if(this.isEmpty())return null;if(null!==this.Go)return this.Go;for(var t=this.il,i=(this.Mi.options().layout.fontSize+4)*(1===this.bi.mode?12:5),n=Math.round(i/t),s=E(this.visibleStrictRange()),h=Math.max(s.left(),s.left()-n),r=Math.max(s.right(),s.right()-n),e=this.jo.Fo(t,i),u=this.ul()+n,o=this.ol()-n,l=this.vl(),a=this.bi.fixLeftEdge||l,f=this.bi.fixRightEdge||l,c=0,v=0,d=e;v<d.length;v++){var _=d[v],w=1===this.bi.mode?this.timeToFloatIndex(_.gi,!0):_.Bo;if(h<=w&&w<=r){var M=void 0;c<this.Qo.length?((M=this.Qo[c]).label=this.dl(_.gi,_.Do),M.weight=_.Do,M.coord=1===this.bi.mode?this.timeToCoordinate(_.gi):this.indexToCoordinate(w)):(M={needAlignCoordinate:!1,label:this.dl(_.gi,_.Do),weight:_.Do,coord:1===this.bi.mode?this.timeToCoordinate(_.gi):this.indexToCoordinate(w)},this.Qo.push(M)),this.il>i/2&&!l?M.needAlignCoordinate=!1:M.needAlignCoordinate=a&&_.Bo<=u||f&&_.Bo>=o,c++}}return this.Qo.length=c,this.Go=this.Qo,this.Qo},t.prototype.restoreDefault=function(){this.$o=!0,this.setBarSpacing(this.bi.barSpacing),this.setRightOffset(this.bi.rightOffset)},t.prototype.setBaseIndex=function(t){this.$o=!0,this.Io=t,this.al(),this.hl()},t.prototype.zoom=function(t,i){var n=this.fl(t),s=this.barSpacing(),h=s+i*(s/10);this.setBarSpacing(h),this.bi.rightBarStaysOnScroll||this.setRightOffset(this.rightOffset()+(n-this.fl(t)))},t.prototype.startScale=function(t){this.os&&this.endScroll(),null===this.us&&null===this.Jo&&(this.isEmpty()||(this.us=t,this._l()))},t.prototype.scaleTo=function(t){if(null!==this.Jo){var i=Ci(this.As-t,0,this.As),n=Ci(this.As-E(this.us),0,this.As);0!==i&&0!==n&&this.setBarSpacing(this.Jo.zr*i/n)}},t.prototype.endScale=function(){null!==this.us&&(this.us=null,this.wl())},t.prototype.startScroll=function(t){null===this.os&&null===this.Jo&&(this.isEmpty()||(this.os=t,this._l()))},t.prototype.scrollTo=function(t){if(null!==this.os){var i=(this.os-t)/this.barSpacing();this.tl=E(this.Jo).Ml+i,this.$o=!0,this.al()}},t.prototype.endScroll=function(){null!==this.os&&(this.os=null,this.wl())},t.prototype.scrollToRealTime=function(){this.scrollToOffsetAnimated(this.bi.rightOffset)},t.prototype.scrollToOffsetAnimated=function(t,i){var n=this;if(void 0===i&&(i=400),!isFinite(t))throw new RangeError("offset is required and must be finite number");if(!isFinite(i)||i<=0)throw new RangeError("animationDuration (optional) must be finite positive number");var s=this.tl,h=performance.now(),r=function(){var e=(performance.now()-h)/i,u=e>=1,o=u?t:s+(t-s)*e;n.setRightOffset(o),u||setTimeout(r,20)};r()},t.prototype.update=function(t,i){if(this.$o=!0,this.Ho=t,1===this.bi.mode){for(var n=t[t.length-1].time.timestamp,s=t[0].time.timestamp,h=(n-s)/t.length,r=Math.pow(10,Math.floor(Math.log10(h))),e=Math.floor(s/r)*r,u=Math.ceil(n/r)*r,o=[],l=e;l<u;l+=r)o.push({time:{timestamp:l},timeWeight:50});this.jo.Lo(o,0)}else this.jo.Lo(t,i);this.al()},t.prototype.visibleBarsChanged=function(){return this.Ko},t.prototype.logicalRangeChanged=function(){return this.Zo},t.prototype.optionsApplied=function(){return this.Xo},t.prototype.baseIndex=function(){return this.Io||0},t.prototype.setVisibleRange=function(t){if(1===this.bi.mode){var i=this.floatIndexToTime(t.left()),n=this.floatIndexToTime(t.right());if(!i||!n)return;var s=this.Ho[this.Ho.length-1].time.timestamp,h=this.Ho[0].time.timestamp,r=(s-h)/this.Ho.length,e=(n-h)/r,u=(i-h)/r,o=e-this.baseIndex(),l=e-u+1,a=this.As/l;this.cl(a),this.tl=o}else{var f=t.count();this.cl(this.As/f),this.tl=t.right()-this.baseIndex()}this.al(),this.$o=!0,this.Mi.recalculateAllPanes(),this.Mi.lightUpdate()},t.prototype.fitContent=function(){var t=this.ul(),i=this.ol();null!==t&&null!==i&&this.setVisibleRange(new th(t,i+this.bi.rightOffset))},t.prototype.setLogicalRange=function(t){var i=new th(t.from,t.to);this.setVisibleRange(i)},t.prototype.formatDateTime=function(t){return void 0!==this.vs.timeFormatter?this.vs.timeFormatter(t.businessDay||t.timestamp):this.bl.lo(new Date(1e3*t.timestamp))},t.prototype.vl=function(){var t=this.Mi.options(),i=t.handleScroll,n=t.handleScale;return!(i.horzTouchDrag||i.mouseWheel||i.pressedMouseMove||i.vertTouchDrag||n.axisDoubleClickReset||n.axisPressedMouseMove.time||n.mouseWheel||n.pinch)},t.prototype.ul=function(){return 0===this.Ho.length?null:0},t.prototype.ol=function(){return 0===this.Ho.length?null:this.Ho.length-1},t.prototype.ml=function(t){return(this.As-1-t)/this.il},t.prototype.fl=function(t){var i=this.Yo.Oo();if(1===this.bi.mode&&i){var n=i.valueAt(t/this.As);return this.timeToFloatIndex({timestamp:n},!0)||0}var s=this.ml(t),h=this.baseIndex()+this.tl-s;return Math.round(1e6*h)/1e6},t.prototype.cl=function(t){var i=this.il;this.il=t,this.ll(),i!==this.il&&(this.$o=!0,this.pl())},t.prototype.el=function(){var t=this;if(this.$o)if(this.$o=!1,this.isEmpty())this.gl(rh.Vo());else{var i,n,s=this.baseIndex(),h=this.As/this.il,r=this.tl+s,e=r-h+1;if(1===this.bi.mode&&this.Ho.length){var u=this.Ho[this.Ho.length-1].time.timestamp,o=this.Ho[0].time.timestamp,l=(u-o)/this.Ho.length,a=o+e*l,f=o+r*l;this.Yo=new rh(new th(a,f)),e=a<o?(a-o)/l:this.Ho.findIndex((function(i,n){return t.Ho[n+1].time.timestamp>=a})),r=f>u?this.Ho.length-1+(f-u)/l:(i=this.Ho,n=function(t){return t.time.timestamp<=f},i.reduce((function(t,i,s){return n(i,s)?s:t}),0))}var c=new th(e,r);this.gl(new rh(c))}},t.prototype.ll=function(){var t=this.yl();if(this.il<t&&(this.il=t,this.$o=!0),0!==this.As){var i=.5*this.As;this.il>i&&(this.il=i,this.$o=!0)}},t.prototype.yl=function(){return this.bi.fixLeftEdge&&this.bi.fixRightEdge&&0!==this.Ho.length?this.As/this.Ho.length:this.bi.minBarSpacing},t.prototype.al=function(){var t=this.kl();this.tl>t&&(this.tl=t,this.$o=!0);var i=this.xl();null!==i&&this.tl<i&&(this.tl=i,this.$o=!0)},t.prototype.xl=function(){var t=this.ul(),i=this.Io;return null===t||null===i?null:t-i-1+(this.bi.fixLeftEdge?this.As/this.il:Math.min(2,this.Ho.length))},t.prototype.kl=function(){return this.bi.fixRightEdge?0:this.As/this.il-Math.min(2,this.Ho.length)},t.prototype._l=function(){this.Jo={zr:this.barSpacing(),Ml:this.rightOffset()}},t.prototype.wl=function(){this.Jo=null},t.prototype.dl=function(t,i){var n=this,s=this.Uo.get(i);return void 0===s&&(s=new Qs((function(t){return n.Cl(t,i)})),this.Uo.set(i,s)),s.lo(t)},t.prototype.Cl=function(t,i){var n,s=function(t,i,n){switch(t){case 0:case 10:return i?n?4:3:2;case 20:case 21:case 22:case 30:case 31:case 32:case 33:return i?3:2;case 50:return 2;case 60:return 1;case 70:return 0}}(i,this.bi.timeVisible,this.bi.secondsVisible);return void 0!==this.bi.tickMarkFormatter?this.bi.tickMarkFormatter(null!==(n=t.businessDay)&&void 0!==n?n:t.timestamp,s,this.vs.locale):function(t,i,n){var s={};switch(i){case 0:s.year="numeric";break;case 1:s.month="short";break;case 2:s.day="numeric";break;case 3:s.hour12=!1,s.hour="2-digit",s.minute="2-digit";break;case 4:s.hour12=!1,s.hour="2-digit",s.minute="2-digit",s.second="2-digit"}var h=void 0===t.businessDay?new Date(1e3*t.timestamp):new Date(Date.UTC(t.businessDay.year,t.businessDay.month-1,t.businessDay.day));return new Date(h.getUTCFullYear(),h.getUTCMonth(),h.getUTCDate(),h.getUTCHours(),h.getUTCMinutes(),h.getUTCSeconds(),h.getUTCMilliseconds()).toLocaleString(n,s)}(t,s,this.vs.locale)},t.prototype.gl=function(t){var i=this.qo;this.qo=t,ih(i.zo(),this.qo.zo())||this.Ko.fire(),ih(i.Oo(),this.qo.Oo())||this.Zo.fire(),this.pl()},t.prototype.pl=function(){this.Go=null},t.prototype.sl=function(){this.pl(),this.Uo.clear()},t.prototype.nl=function(){var t=this.vs.dateFormat;this.bi.timeVisible?this.bl=new Gs({fo:t,co:this.bi.secondsVisible?"%h:%m:%s":"%h:%m",vo:"   ",do:this.vs.locale}):this.bl=new Zs(t,this.vs.locale)},t.prototype.hl=function(){if(this.bi.fixLeftEdge){var t=this.ul();if(null!==t){var i=this.visibleStrictRange();if(null!==i){var n=i.left()-t;if(n<0){var s=this.tl-n-1;this.setRightOffset(s)}this.ll()}}}},t.prototype.rl=function(){this.al(),this.ll()},t}();var uh,oh=function(t){function i(i){var n=t.call(this)||this;return n.Nl=new Map,n.ot=i,n}return U(i,t),i.prototype.Y=function(t){},i.prototype.$=function(t){if(this.ot.lt){t.save();for(var i=0,n=0,s=this.ot.dn;n<s.length;n++){if(0!==(o=s[n]).At.length){t.font=o.Sl;var h=this.Tl(t,o.At);h>this.ot.Zt?o.Al=this.ot.Zt/h:o.Al=1,i+=o.Ll*o.Al}}var r=0;switch(this.ot.El){case"top":r=0;break;case"center":r=Math.max((this.ot.Dt-i)/2,0);break;case"bottom":r=Math.max(this.ot.Dt-i,0)}t.fillStyle=this.ot.bt;for(var e=0,u=this.ot.dn;e<u.length;e++){var o=u[e];t.save();var l=0;switch(this.ot.Bl){case"left":t.textAlign="left",l=o.Ll/2;break;case"center":t.textAlign="center",l=this.ot.Zt/2;break;case"right":t.textAlign="right",l=this.ot.Zt-1-o.Ll/2}t.translate(l,r),t.textBaseline="top",t.font=o.Sl,t.scale(o.Al,o.Al),t.fillText(o.At,0,o.Dl),t.restore(),r+=o.Ll*o.Al}t.restore()}},i.prototype.Tl=function(t,i){var n=this.Fl(t.font),s=n.get(i);return void 0===s&&(s=t.measureText(i).width,n.set(i,s)),s},i.prototype.Fl=function(t){var i=this.Nl.get(t);return void 0===i&&(i=new Map,this.Nl.set(t,i)),i},i}(ot),lh=function(){function t(t){this.Rt=!0,this.yt={lt:!1,bt:"",Dt:0,Zt:0,dn:[],El:"center",Bl:"center"},this.kt=new oh(this.yt),this.xt=t}return t.prototype.update=function(){this.Rt=!0},t.prototype.renderer=function(t,i){return this.Rt&&(this.ut(t,i),this.Rt=!1),this.kt},t.prototype.ut=function(t,i){var n=this.xt.options(),s=this.yt;s.lt=n.visible,s.lt&&(s.bt=n.color,s.Zt=i,s.Dt=t,s.Bl=n.horzAlign,s.El=n.vertAlign,s.dn=[{At:n.text,Sl:st(n.fontSize,n.fontFamily,n.fontStyle),Ll:1.2*n.fontSize,Dl:0,Al:0}])},t}(),ah=function(t){function i(i,n){var s=t.call(this)||this;return s.bi=n,s.ki=new lh(s),s}return U(i,t),i.prototype.priceAxisViews=function(){return[]},i.prototype.paneViews=function(){return[this.ki]},i.prototype.options=function(){return this.bi},i.prototype.updateAllViews=function(){this.ki.update()},i}(Tt);!function(t){t[t.OnTouchEnd=0]="OnTouchEnd",t[t.OnNextTap=1]="OnNextTap"}(uh||(uh={}));var fh,ch,vh,dh,_h,wh,Mh=function(){function t(t,i){this.Pl=[],this.Wl=new Map,this.Rl=[],this.As=0,this.zl=null,this.Ol=null,this.Vl=new $,this.Il=new $,this.Hl=!1,this.jl=null,this.Ul=t,this.bi=i,this.ql=new et(this),this.Bs=new eh(this,i.timeScale,this.bi.localization),this.et=new At(this,i.crosshair),this.Yl=new ah(this,i.watermark),this.$l=new Ys(i.crosshair.magnetThreshold),this.Kl=new Wn(this),this.createPane(),this.Pl[0].setStretchFactor(2e3),this.Zl=this.Xl(0),this.Jl=this.Xl(1)}return t.prototype.fullUpdate=function(){this.Gl(new Et(3))},t.prototype.lightUpdate=function(){this.Gl(new Et(2))},t.prototype.cursorUpdate=function(){this.Gl(new Et(1))},t.prototype.updateSource=function(t){var i=this.Ql(t);this.Gl(i)},t.prototype.hoveredSource=function(){return this.Ol},t.prototype.dataSources=function(){for(var t=[],i=0,n=this.Pl;i<n.length;i++)for(var s=0,h=n[i].dataSources();s<h.length;s++){var r=h[s];t.push(r)}return t},t.prototype.setHoveredSource=function(t){var i=this.Ol;this.Ol=t,null!==i&&this.updateSource(i.source),null!==t&&this.updateSource(t.source)},t.prototype.options=function(){return this.bi},t.prototype.applyOptions=function(t){K(this.bi,t),this.Pl.forEach((function(i){return i.applyScaleOptions(t)})),void 0!==t.timeScale&&this.Bs.applyOptions(t.timeScale),void 0!==t.localization&&this.Bs.applyLocalizationOptions(t.localization),(t.leftPriceScale||t.rightPriceScale)&&this.Vl.fire(),this.Zl=this.Xl(0),this.Jl=this.Xl(1),this.fullUpdate()},t.prototype.applyPriceScaleOptions=function(t,i){if("left"!==t)if("right"!==t){var n=this.findPriceScale(t);null!==n&&(n.priceScale.applyOptions(i),this.Vl.fire())}else this.applyOptions({rightPriceScale:i});else this.applyOptions({leftPriceScale:i})},t.prototype.findPriceScale=function(t){for(var i=0,n=this.Pl;i<n.length;i++){var s=n[i],h=s.priceScaleById(t);if(null!==h)return{pane:s,priceScale:h}}return null},t.prototype.timeScale=function(){return this.Bs},t.prototype.panes=function(){return this.Pl},t.prototype.watermarkSource=function(){return this.Yl},t.prototype.lineToolCreator=function(){return this.Kl},t.prototype.crosshairSource=function(){return this.et},t.prototype.magnet=function(){return this.$l},t.prototype.crosshairMoved=function(){return this.Il},t.prototype.setPaneHeight=function(t,i){t.setHeight(i),this.recalculateAllPanes()},t.prototype.setWidth=function(t){this.As=t,this.Bs.setWidth(this.As),this.Pl.forEach((function(i){return i.setWidth(t)})),this.recalculateAllPanes()},t.prototype.createPane=function(t){if(void 0!==t)if(t>this.Pl.length)for(var i=this.Pl.length;i<t;i++)this.createPane(i);else if(t<this.Pl.length)return this.Pl[t];var n=void 0===t?this.Pl.length-1+1:t,s=new Ki(this.Bs,this,n);void 0!==t?this.Pl.splice(t,0,s):this.Pl.push(s),this.ta();var h=new Et(3);return h.invalidatePane(n,{level:0,autoScale:!0}),this.Gl(h),s},t.prototype.removePane=function(t){var i=this;if(0!==t){if(this.Pl[t].orderedSources().forEach((function(t){t instanceof qs&&i.removeSeries(t)})),this.Hl=!0,t!==this.Pl.length-1)for(var n=function(t){s.Pl[t].orderedSources().forEach((function(i){i instanceof qs&&i.applyOptions({pane:t-1})}))},s=this,h=t+1;h<this.Pl.length;h++)n(h);this.Pl.splice(t,1),this.Hl=!1,this.ta();var r=new Et(3);this.Gl(r)}},t.prototype.swapPane=function(t,i){var n=this.Pl[t],s=this.Pl[i];this.Hl=!0,n.orderedSources().forEach((function(t){t instanceof qs&&t.applyOptions({pane:i})})),s.orderedSources().forEach((function(i){i instanceof qs&&i.applyOptions({pane:t})})),this.Pl[t]=s,this.Pl[i]=n,this.Hl=!1,this.ta(),this.Gl(new Et(3))},t.prototype.startScalePrice=function(t,i,n){t.startScalePrice(i,n)},t.prototype.scalePriceTo=function(t,i,n){t.scalePriceTo(i,n),this.updateCrosshair(),this.Gl(this.ia(t,2))},t.prototype.endScalePrice=function(t,i){t.endScalePrice(i),this.Gl(this.ia(t,2))},t.prototype.startScrollPrice=function(t,i,n){i.isAutoScale()||t.startScrollPrice(i,n)},t.prototype.scrollPriceTo=function(t,i,n){i.isAutoScale()||(t.scrollPriceTo(i,n),this.updateCrosshair(),this.Gl(this.ia(t,2)))},t.prototype.endScrollPrice=function(t,i){i.isAutoScale()||(t.endScrollPrice(i),this.Gl(this.ia(t,2)))},t.prototype.resetPriceScale=function(t,i){t.resetPriceScale(i),this.Gl(this.ia(t,2))},t.prototype.startScaleTime=function(t){this.Bs.startScale(t)},t.prototype.zoomTime=function(t,i){var n=this.timeScale();if(!n.isEmpty()&&0!==i){var s=n.width();t=Math.max(1,Math.min(t,s)),n.zoom(t,i),this.recalculateAllPanes()}},t.prototype.scrollChart=function(t){this.startScrollTime(0),this.scrollTimeTo(t),this.endScrollTime()},t.prototype.scaleTimeTo=function(t){this.Bs.scaleTo(t),this.recalculateAllPanes()},t.prototype.endScaleTime=function(){this.Bs.endScale(),this.lightUpdate()},t.prototype.startScrollTime=function(t){this.zl=t,this.Bs.startScroll(t)},t.prototype.scrollTimeTo=function(t){var i=!1;return null!==this.zl&&Math.abs(t-this.zl)>20&&(this.zl=null,i=!0),this.Bs.scrollTo(t),this.recalculateAllPanes(),i},t.prototype.endScrollTime=function(){this.Bs.endScroll(),this.lightUpdate(),this.zl=null},t.prototype.serieses=function(){return this.Rl},t.prototype.setAndSaveCurrentPosition=function(t,i,n){this.et.saveOriginCoord(t,i);var s=NaN,r=this.Bs.coordinateToIndex(t),e=this.Bs.visibleStrictRange();null!==e&&(r=Math.min(Math.max(e.left(),r),e.right()));var u=n.defaultPriceScale(),o=u.firstValue();null!==o&&(s=u.coordinateToPrice(i,o)),s=this.$l.align(s,r,n),this.et.setPosition(r,s,n),this.cursorUpdate();var l=new h(t,i);l.paneIndex=this.getPaneIndex(n),this.Il.fire(this.et.appliedIndex(),l)},t.prototype.clearCurrentPosition=function(){this.crosshairSource().clearPosition(),this.cursorUpdate(),this.Il.fire(null,null)},t.prototype.updateCrosshair=function(){var t=this.et.pane();if(null!==t){var i=this.et.originCoordX(),n=this.et.originCoordY();this.setAndSaveCurrentPosition(i,n,t)}this.et.updateAllViews()},t.prototype.updateTimeScale=function(t,i,n){var s=this.Bs.indexToTime(0);void 0!==i&&void 0!==n&&this.Bs.update(i,n);var h=this.Bs.indexToTime(0),r=this.Bs.baseIndex(),e=this.Bs.visibleStrictRange();if(null!==e&&null!==s&&null!==h){var u=e.contains(r),o=s.timestamp>h.timestamp,l=null!==t&&t>r&&!o,a=u&&this.Bs.options().shiftVisibleRangeOnNewBar;if(l&&!a){var f=t-r;this.Bs.setRightOffset(this.Bs.rightOffset()-f)}}this.Bs.setBaseIndex(t)},t.prototype.recalculatePane=function(t){null!==t&&t.recalculate()},t.prototype.paneForSource=function(t){var i=this.Pl.find((function(i){return i.orderedSources().includes(t)}));return void 0===i?null:i},t.prototype.recalculateAllPanes=function(){this.Yl.updateAllViews(),this.Pl.forEach((function(t){return t.recalculate()})),this.updateCrosshair()},t.prototype.destroy=function(){this.Pl.forEach((function(t){return t.destroy()})),this.Pl.length=0,this.bi.localization.priceFormatter=void 0,this.bi.localization.timeFormatter=void 0},t.prototype.rendererOptionsProvider=function(){return this.ql},t.prototype.priceAxisRendererOptions=function(){return this.ql.options()},t.prototype.priceScalesOptionsChanged=function(){return this.Vl},t.prototype.createSeries=function(t,i){var n=i.pane||0;this.Pl.length-1<=n&&this.createPane(n);var s=this.Pl[n],h=this.na(i,t,s);return this.Rl.push(h),1===this.Rl.length?this.fullUpdate():this.lightUpdate(),h},t.prototype.removeSeries=function(t){var i=this.paneForSource(t),n=this.Rl.indexOf(t);A(-1!==n,"Series not found"),this.Rl.splice(n,1),E(i).removeDataSource(t),t.destroy&&t.destroy()},t.prototype.createLineTool=function(t,i,n){var s=new Pn[t](this,i,n);return this.Pl[0].addDataSource(s,this.defaultVisiblePriceScaleId()),s},t.prototype.moveSeriesToScale=function(t,i){var n=E(this.paneForSource(t));n.removeDataSource(t);var s=this.findPriceScale(i);if(null===s){var h=t.zorder();n.addDataSource(t,i,h)}else{h=s.pane===n?t.zorder():void 0;s.pane.addDataSource(t,i,h)}},t.prototype.fitContent=function(){var t=new Et(2);t.setFitContent(),this.Gl(t)},t.prototype.setTargetLogicalRange=function(t){var i=new Et(2);i.applyRange(t),this.Gl(i)},t.prototype.resetTimeScale=function(){var t=new Et(2);t.resetTimeScale(),this.Gl(t)},t.prototype.setBarSpacing=function(t){var i=new Et(2);i.setBarSpacing(t),this.Gl(i)},t.prototype.setRightOffset=function(t){var i=new Et(2);i.setRightOffset(t),this.Gl(i)},t.prototype.defaultVisiblePriceScaleId=function(){return this.bi.rightPriceScale.visible?"right":"left"},t.prototype.moveSeriesToPane=function(t,i,n){if(n!==i&&!this.Hl){t.options().pane!==n&&t.applyOptions({pane:n});var s=this.paneForSource(t);null==s||s.removeDataSource(t);var h=this.createPane(n);this.sa(t,h)}},t.prototype.backgroundBottomColor=function(){return this.Jl},t.prototype.backgroundTopColor=function(){return this.Zl},t.prototype.backgroundColorAtYPercentFromTop=function(t){var i=this.Jl,n=this.Zl;if(i===n)return i;if(t=Math.max(0,Math.min(100,Math.round(100*t))),null===this.jl||this.jl.cr!==n||this.jl.vr!==i)this.jl={cr:n,vr:i,ha:new Map};else{var s=this.jl.ha.get(t);if(void 0!==s)return s}var h=function(t,i,n){var s=V(t),h=s[0],r=s[1],e=s[2],u=s[3],o=V(i),l=o[0],a=o[1],f=o[2],c=o[3],v=[F(h+n*(l-h)),F(r+n*(a-r)),F(e+n*(f-e)),P(u+n*(c-u))];return"rgba(".concat(v[0],", ").concat(v[1],", ").concat(v[2],", ").concat(v[3],")")}(n,i,t/100);return this.jl.ha.set(t,h),h},t.prototype.getPaneIndex=function(t){var i;return null!==(i=this.Wl.get(t))&&void 0!==i?i:0},t.prototype.ia=function(t,i){var n=new Et(i);if(null!==t){var s=this.Pl.indexOf(t);n.invalidatePane(s,{level:i})}return n},t.prototype.Ql=function(t,i){return void 0===i&&(i=2),this.ia(this.paneForSource(t),i)},t.prototype.Gl=function(t){this.Ul&&this.Ul(t),this.Pl.forEach((function(t){return t.grid().paneView().update()}))},t.prototype.na=function(t,i,n){var s=new qs(this,t,i);return this.sa(s,n),s},t.prototype.sa=function(t,i){var n=t.options().priceScaleId,s=void 0!==n?n:this.defaultVisiblePriceScaleId();i.addDataSource(t,s),Lt(s)||t.applyOptions(t.options())},t.prototype.Xl=function(t){var i=this.bi.layout;return"gradient"===i.background.type?0===t?i.background.topColor:i.background.bottomColor:i.background.color},t.prototype.ta=function(){this.Wl.clear();for(var t=0;t<this.Pl.length;t++)this.Wl.set(this.Pl[t],t)},t}();function bh(t){void 0!==t.borderColor&&(t.borderUpColor=t.borderColor,t.borderDownColor=t.borderColor),void 0!==t.wickColor&&(t.wickUpColor=t.wickColor,t.wickDownColor=t.wickColor)}function mh(t){return!Z(t)&&!J(t)}function ph(t){return Z(t)}!function(t){t[t.Disabled=0]="Disabled",t[t.Continuous=1]="Continuous",t[t.OnDataUpdate=2]="OnDataUpdate"}(fh||(fh={})),function(t){t[t.LastBar=0]="LastBar",t[t.LastVisible=1]="LastVisible"}(ch||(ch={})),function(t){t.Top="top",t.Middle="middle",t.Bottom="bottom"}(vh||(vh={})),function(t){t.Left="left",t.Center="center",t.Right="right"}(dh||(dh={})),function(t){t.Start="start",t.Center="center",t.End="end",t.Left="left",t.Right="right"}(_h||(_h={})),function(t){t.Solid="solid",t.VerticalGradient="gradient"}(wh||(wh={}));var gh=function(){function t(t,i){this.w=t,this.h=i}return t.prototype.equals=function(t){return this.w===t.w&&this.h===t.h},t}();function yh(t){return t.ownerDocument&&t.ownerDocument.defaultView&&t.ownerDocument.defaultView.devicePixelRatio||1}function kh(t){var i=E(t.getContext("2d"));return i.setTransform(1,0,0,1,0,0),i}function xh(t,i){var n=t.createElement("canvas"),s=yh(n);return n.style.width="".concat(i.w,"px"),n.style.height="".concat(i.h,"px"),n.width=i.w*s,n.height=i.h*s,n}function Ch(i,n){var s=E(i.ownerDocument).createElement("canvas");i.appendChild(s);var h=t(s,{allowDownsampling:!1});return h.resizeCanvas({width:n.w,height:n.h}),h}var Nh="undefined"!=typeof window;function Sh(){return!!Nh&&window.navigator.userAgent.toLowerCase().indexOf("firefox")>-1}function Th(){return!!Nh&&/iPhone|iPad|iPod/.test(window.navigator.platform)}function Ah(t){Nh&&void 0!==window.chrome&&t.addEventListener("mousedown",(function(t){if(1===t.button)return t.preventDefault(),!1}))}var Lh=function(){function t(t,i,n){var s=this;this.ra=0,this.ea=null,this.ua={x:Number.NEGATIVE_INFINITY,y:Number.POSITIVE_INFINITY},this.oa=0,this.la=null,this.aa={x:Number.NEGATIVE_INFINITY,y:Number.POSITIVE_INFINITY},this.fa=null,this.ca=!1,this.va=null,this.da=null,this._a=!1,this.wa=!1,this.Ma=!1,this.ba=null,this.ma=null,this.pa=null,this.ga=null,this.ya=null,this.ka=null,this.xa=null,this.Ca=0,this.Na=!1,this.Sa=!1,this.Ta=!1,this.Aa=0,this.La=null,this.Ea=!Th(),this.Ba=function(t){s.Da(t)},this.Fa=function(t){if(s.Pa(t)){var i=s.Wa(t);if(++s.oa,s.la&&s.oa>1)s.za(Dh(t),s.aa).Ra<30&&!s.Ma&&s.Oa(i,s.Va.doubleTapEvent),s.Ia()}else{i=s.Wa(t);if(++s.ra,s.ea&&s.ra>1)s.za(Dh(t),s.ua).Ra<5&&!s.wa&&s.Ha(i,s.Va.mouseDoubleClickEvent),s.ja()}},this.Ua=t,this.Va=i,this.bi=n,this.qa()}return t.prototype.destroy=function(){null!==this.ba&&(this.ba(),this.ba=null),null!==this.ma&&(this.ma(),this.ma=null),null!==this.ga&&(this.ga(),this.ga=null),null!==this.ya&&(this.ya(),this.ya=null),null!==this.ka&&(this.ka(),this.ka=null),null!==this.pa&&(this.pa(),this.pa=null),this.Ya(),this.ja()},t.prototype.$a=function(t){var i=this;this.ga&&this.ga();var n=this.Ka.bind(this);if(this.ga=function(){i.Ua.removeEventListener("mousemove",n)},this.Ua.addEventListener("mousemove",n),!this.Pa(t)){var s=this.Wa(t);this.Ha(s,this.Va.mouseEnterEvent),this.Ea=!0}},t.prototype.ja=function(){null!==this.ea&&clearTimeout(this.ea),this.ra=0,this.ea=null,this.ua={x:Number.NEGATIVE_INFINITY,y:Number.POSITIVE_INFINITY}},t.prototype.Ia=function(){null!==this.la&&clearTimeout(this.la),this.oa=0,this.la=null,this.aa={x:Number.NEGATIVE_INFINITY,y:Number.POSITIVE_INFINITY}},t.prototype.Ka=function(t){if(!this.Ta&&null===this.da&&!this.Pa(t)){var i=this.Wa(t);this.Ha(i,this.Va.mouseMoveEvent),this.Ea=!0}},t.prototype.Za=function(t){var i=Ph(t.changedTouches,E(this.La));if(null!==i&&(this.Aa=Fh(t),null===this.xa&&!this.Sa)){this.Na=!0;var n=this.za(Dh(i),E(this.da)),s=n.Xa,h=n.Ja,r=n.Ra;if(this._a||!(r<5)){if(!this._a){var e=.5*s,u=h>=e&&!this.bi.Ga(),o=e>h&&!this.bi.Qa();u||o||(this.Sa=!0),this._a=!0,this.Ma=!0,this.Ya(),this.Ia()}if(!this.Sa){var l=this.Wa(t,i);this.Oa(l,this.Va.touchMoveEvent),Bh(t)}}}},t.prototype.tf=function(t){if(0===t.button&&(this.za(Dh(t),E(this.va)).Ra>=5&&(this.wa=!0,this.ja()),this.wa)){var i=this.Wa(t);this.Ha(i,this.Va.pressedMouseMoveEvent)}},t.prototype.za=function(t,i){var n=Math.abs(i.x-t.x),s=Math.abs(i.y-t.y);return{Xa:n,Ja:s,Ra:n+s}},t.prototype.if=function(t){var i=Ph(t.changedTouches,E(this.La));if(null===i&&0===t.touches.length&&(i=t.changedTouches[0]),null!==i){this.La=null,this.Aa=Fh(t),this.Ya(),this.da=null,this.ka&&(this.ka(),this.ka=null);var n=this.Wa(t,i);if(this.Oa(n,this.Va.touchEndEvent),++this.oa,this.la&&this.oa>1)this.za(Dh(i),this.aa).Ra<30&&!this.Ma&&this.Oa(n,this.Va.doubleTapEvent),this.Ia();else this.Ma||(this.Oa(n,this.Va.tapEvent),this.Va.tapEvent&&Bh(t));0===this.oa&&Bh(t),0===t.touches.length&&this.ca&&(this.ca=!1,Bh(t))}},t.prototype.Da=function(t){if(0===t.button){var i=this.Wa(t);if(this.va=null,this.Ta=!1,this.ya&&(this.ya(),this.ya=null),Sh())this.Ua.ownerDocument.documentElement.removeEventListener("mouseleave",this.Ba);if(!this.Pa(t))if(this.Ha(i,this.Va.mouseUpEvent),++this.ra,this.ea&&this.ra>1)this.za(Dh(t),this.ua).Ra<5&&!this.wa&&this.Ha(i,this.Va.mouseDoubleClickEvent),this.ja();else this.wa||this.Ha(i,this.Va.mouseClickEvent)}},t.prototype.Ya=function(){null!==this.fa&&(clearTimeout(this.fa),this.fa=null)},t.prototype.nf=function(t){if(null===this.La){var i=t.changedTouches[0];this.La=i.identifier,this.Aa=Fh(t);var n=this.Ua.ownerDocument.documentElement;this.Ma=!1,this._a=!1,this.Sa=!1,this.da=Dh(i),this.ka&&(this.ka(),this.ka=null);var s=this.Za.bind(this),h=this.if.bind(this);this.ka=function(){n.removeEventListener("touchmove",s),n.removeEventListener("touchend",h)},n.addEventListener("touchmove",s,{passive:!1}),n.addEventListener("touchend",h,{passive:!1}),this.Ya(),this.fa=setTimeout(this.sf.bind(this,t),240);var r=this.Wa(t,i);this.Oa(r,this.Va.touchStartEvent),this.la||(this.oa=0,this.la=setTimeout(this.Ia.bind(this),500),this.aa=Dh(i))}},t.prototype.hf=function(t){if(0===t.button){var i=this.Ua.ownerDocument.documentElement;Sh()&&i.addEventListener("mouseleave",this.Ba),this.wa=!1,this.va=Dh(t),this.ya&&(this.ya(),this.ya=null);var n=this.tf.bind(this),s=this.Da.bind(this);if(this.ya=function(){i.removeEventListener("mousemove",n),i.removeEventListener("mouseup",s)},i.addEventListener("mousemove",n),i.addEventListener("mouseup",s),this.Ta=!0,!this.Pa(t)){var h=this.Wa(t);this.Ha(h,this.Va.mouseDownEvent),this.ea||(this.ra=0,this.ea=setTimeout(this.ja.bind(this),500),this.ua=Dh(t))}}},t.prototype.qa=function(){var t=this;this.Ua.addEventListener("mouseenter",this.$a.bind(this)),this.Ua.addEventListener("touchcancel",this.Ya.bind(this));var i=this.Ua.ownerDocument,n=function(i){t.Va.mouseDownOutsideEvent&&(i.target&&t.Ua.contains(i.target)||t.Va.mouseDownOutsideEvent())};this.ma=function(){i.removeEventListener("touchstart",n)},this.ba=function(){i.removeEventListener("mousedown",n)},i.addEventListener("mousedown",n),i.addEventListener("touchstart",n,{passive:!0}),Th()&&(this.pa=function(){t.Ua.removeEventListener("dblclick",t.Fa)},this.Ua.addEventListener("dblclick",this.Fa)),this.Ua.addEventListener("mouseleave",this.rf.bind(this)),this.Ua.addEventListener("touchstart",this.nf.bind(this),{passive:!0}),Ah(this.Ua),this.Ua.addEventListener("mousedown",this.hf.bind(this)),this.ef(),this.Ua.addEventListener("touchmove",(function(){}),{passive:!1})},t.prototype.ef=function(){var t=this;void 0===this.Va.pinchStartEvent&&void 0===this.Va.pinchEvent&&void 0===this.Va.pinchEndEvent||(this.Ua.addEventListener("touchstart",(function(i){return t.uf(i.touches)}),{passive:!0}),this.Ua.addEventListener("touchmove",(function(i){if(2===i.touches.length&&null!==t.xa&&void 0!==t.Va.pinchEvent){var n=Eh(i.touches[0],i.touches[1])/t.Ca;t.Va.pinchEvent(t.xa,n),Bh(i)}}),{passive:!1}),this.Ua.addEventListener("touchend",(function(i){t.uf(i.touches)})))},t.prototype.uf=function(t){1===t.length&&(this.Na=!1),2!==t.length||this.Na||this.ca?this.lf():this.af(t)},t.prototype.af=function(t){var i=this.Ua.getBoundingClientRect()||{left:0,top:0};this.xa={x:(t[0].clientX-i.left+(t[1].clientX-i.left))/2,y:(t[0].clientY-i.top+(t[1].clientY-i.top))/2},this.Ca=Eh(t[0],t[1]),void 0!==this.Va.pinchStartEvent&&this.Va.pinchStartEvent(),this.Ya()},t.prototype.lf=function(){null!==this.xa&&(this.xa=null,void 0!==this.Va.pinchEndEvent&&this.Va.pinchEndEvent())},t.prototype.rf=function(t){if(this.ga&&this.ga(),!this.Pa(t)&&this.Ea){var i=this.Wa(t);this.Ha(i,this.Va.mouseLeaveEvent),this.Ea=!Th()}},t.prototype.sf=function(t){var i=Ph(t.touches,E(this.La));if(null!==i){var n=this.Wa(t,i);this.Oa(n,this.Va.longTapEvent),this.Ma=!0,this.ca=!0}},t.prototype.Pa=function(t){return t.sourceCapabilities&&void 0!==t.sourceCapabilities.firesTouchEvents?t.sourceCapabilities.firesTouchEvents:Fh(t)<this.Aa+500},t.prototype.Oa=function(t,i){i&&i.call(this.Va,t)},t.prototype.Ha=function(t,i){i&&i.call(this.Va,t)},t.prototype.Wa=function(t,i){var n=i||t,s=this.Ua.getBoundingClientRect()||{left:0,top:0};return{clientX:n.clientX,clientY:n.clientY,pageX:n.pageX,pageY:n.pageY,screenX:n.screenX,screenY:n.screenY,localX:n.clientX-s.left,localY:n.clientY-s.top,ctrlKey:t.ctrlKey,altKey:t.altKey,shiftKey:t.shiftKey,metaKey:t.metaKey,isTouch:!t.type.startsWith("mouse")&&"contextmenu"!==t.type&&"click"!==t.type,srcType:t.type,target:n.target,view:t.view,preventDefault:function(){"touchstart"!==t.type&&Bh(t)}}},t}();function Eh(t,i){var n=t.clientX-i.clientX,s=t.clientY-i.clientY;return Math.sqrt(n*n+s*s)}function Bh(t){t.cancelable&&t.preventDefault()}function Dh(t){return{x:t.pageX,y:t.pageY}}function Fh(t){return t.timeStamp||performance.now()}function Ph(t,i){for(var n=0;n<t.length;++n)if(t[n].identifier===i)return t[n];return null}var Wh=function(){function t(t,i,n,s){if(this.ff=0,this.cf=0,this.vf=0,this.df=0,this._f=0,this.wf=0,this.Mf=0,this.bf=!1,this.mf=t,this.pf=t.paneWidgets()[i],this.gf=t.paneWidgets()[n],this.yf=document.createElement("tr"),this.yf.style.height="1px",this.kf=document.createElement("td"),this.kf.style.position="relative",this.kf.style.padding="0",this.kf.style.margin="0",this.kf.style.height="1.5px",this.kf.setAttribute("colspan","3"),this.xf(),this.yf.appendChild(this.kf),s)this.Cf=null,this.Nf=null;else{this.Cf=document.createElement("div"),this.Cf.style.position="absolute",this.Cf.style.zIndex="50",this.Cf.style.top="-3.75px",this.Cf.style.height="9px",this.Cf.style.width="100%",this.Cf.style.cursor="row-resize",this.Cf.style.backgroundColor="#0092ea",this.Cf.style.opacity="0",this.kf.appendChild(this.Cf);var h={mouseEnterEvent:this.Sf.bind(this),mouseLeaveEvent:this.Tf.bind(this),mouseDownEvent:this.Af.bind(this),touchStartEvent:this.Af.bind(this),pressedMouseMoveEvent:this.Lf.bind(this),touchMoveEvent:this.Lf.bind(this),mouseUpEvent:this.Ef.bind(this),touchEndEvent:this.Ef.bind(this)};this.Nf=new Lh(this.Cf,h,{Ga:function(){return!1},Qa:function(){return!0}})}}return t.prototype.destroy=function(){null!==this.Nf&&this.Nf.destroy()},t.prototype.Bf=function(){return this.yf},t.prototype.Df=function(){return new gh(this.pf.getSize().w,1)},t.prototype.Ff=function(){var t=this.Df(),i=xh(document,t),n=kh(i);return n.fillStyle=this.mf.options().timeScale.borderColor,n.fillRect(0,0,t.w,t.h),i},t.prototype.Ct=function(){this.xf()},t.prototype.xf=function(){this.kf.style.background=this.mf.options().timeScale.borderColor},t.prototype.Sf=function(t){null!==this.Cf&&(this.Cf.style.opacity="0.15",this.kf.style.background="#0092ea")},t.prototype.Tf=function(t){null===this.Cf||this.bf||(this.Cf.style.opacity="0",this.xf())},t.prototype.Af=function(t){this.ff=t.pageY,this.cf=0,this.vf=this.pf.getSize().h+this.gf.getSize().h,this.df=this.pf.stretchFactor()+this.gf.stretchFactor(),this._f=30,this.wf=this.vf-this._f,this.Mf=this.df/this.vf,this.bf=!0},t.prototype.Lf=function(t){this.cf=t.pageY-this.ff;var i=this.pf.getSize().h,n=Ci(i+this.cf,this._f,this.wf)*this.Mf,s=this.df-n;this.pf.setStretchFactor(n),this.gf.setStretchFactor(s),this.mf.adjustSize(),this.pf.getSize().h!==i&&(this.ff=t.pageY),this.mf.model().fullUpdate()},t.prototype.Ef=function(t){this.ff=0,this.cf=0,this.vf=0,this.df=0,this._f=0,this.wf=0,this.Mf=0,this.bf=!1,this.Tf(t)},t}();function Rh(t,i){return t.Pf-i.Pf}function zh(t,i,n){var s=(t.Pf-i.Pf)/(t.gi-i.gi);return Math.sign(s)*Math.min(Math.abs(s),n)}var Oh=function(){function t(t,i,n,s){this.Wf=null,this.Rf=null,this.zf=null,this.Of=null,this.Vf=null,this.If=0,this.Hf=0,this.jf=!1,this.Uf=t,this.qf=i,this.Yf=n,this.An=s}return t.prototype.$f=function(t,i){if(null!==this.Wf){if(this.Wf.gi===i)return void(this.Wf.Pf=t);if(Math.abs(this.Wf.Pf-t)<this.An)return}this.Of=this.zf,this.zf=this.Rf,this.Rf=this.Wf,this.Wf={gi:i,Pf:t}},t.prototype.Be=function(t,i){if(null!==this.Wf&&null!==this.Rf&&!(i-this.Wf.gi>50)){var n=0,s=zh(this.Wf,this.Rf,this.qf),h=Rh(this.Wf,this.Rf),r=[s],e=[h];if(n+=h,null!==this.zf){var u=zh(this.Rf,this.zf,this.qf);if(Math.sign(u)===Math.sign(s)){var o=Rh(this.Rf,this.zf);if(r.push(u),e.push(o),n+=o,null!==this.Of){var l=zh(this.zf,this.Of,this.qf);if(Math.sign(l)===Math.sign(s)){var a=Rh(this.zf,this.Of);r.push(l),e.push(a),n+=a}}}}for(var f,c,v,d=0,_=0;_<r.length;++_)d+=e[_]/n*r[_];if(!(Math.abs(d)<this.Uf))this.Vf={Pf:t,gi:i},this.Hf=d,this.If=(f=Math.abs(d),c=this.Yf,v=Math.log(c),Math.log(1*v/-f)/v)}},t.prototype.Kf=function(t){var i=E(this.Vf),n=t-i.gi;return i.Pf+this.Hf*(Math.pow(this.Yf,n)-1)/Math.log(this.Yf)},t.prototype.Zf=function(t){return null===this.Vf||this.Xf(t)===this.If},t.prototype.Jf=function(){return this.jf},t.prototype.Gf=function(){this.jf=!0},t.prototype.Xf=function(t){var i=t-E(this.Vf).gi;return Math.min(i,this.If)},t}(),Vh=function(){function t(t,i,n,s){this.Xe=new rt(200),this.F=0,this.Qf="",this.Je="",this.L=[],this.tc=new Map,this.F=t,this.Qf=i,this.Je=st(t,n,s)}return t.prototype.destroy=function(){this.Xe.reset(),this.L=[],this.tc.clear()},t.prototype.ic=function(t,i,n,s,h){var r=this.nc(t,i);if("left"!==h){var e=yh(t.canvas);n-=Math.floor(r.sc*e)}s-=Math.floor(r.Dt/2),t.drawImage(r.hc,n,s,r.Zt,r.Dt)},t.prototype.nc=function(t,i){var n,s=this;if(this.tc.has(i))n=L(this.tc.get(i));else{if(this.L.length>=200){var h=L(this.L.shift());this.tc.delete(h)}var r=yh(t.canvas),e=Math.ceil(this.F/4.5),u=Math.round(this.F/10),o=Math.ceil(this.Xe.measureText(t,i)),l=Ti(Math.round(o+2*e)),a=Ti(this.F+2*e),f=xh(document,new gh(l,a));n={At:i,sc:Math.round(Math.max(1,o)),Zt:Math.ceil(l*r),Dt:Math.ceil(a*r),hc:f},0!==o&&(this.L.push(n.At),this.tc.set(n.At,n)),wt(t=kh(n.hc),r,(function(){t.font=s.Je,t.fillStyle=s.Qf,t.fillText(i,0,a-e-u)}))}return n},t}(),Ih=function(){function t(t,i,n,s){var h=this;this.Yt=null,this.rc=null,this.ec=!1,this.uc=new rt(50),this.oc=new Vh(11,"#000"),this.Qf=null,this.Je=null,this.lc=0,this.ac=!1,this.fc=function(){h.cc(h.ql.options()),h.ac||h.ui.chart().model().lightUpdate()},this.vc=function(){h.ac||h.ui.chart().model().lightUpdate()},this.ui=t,this.bi=i,this.ql=n,this.dc="left"===s,this.kf=document.createElement("div"),this.kf.style.height="100%",this.kf.style.overflow="hidden",this.kf.style.width="25px",this.kf.style.left="0",this.kf.style.position="relative",this._c=Ch(this.kf,new gh(16,16)),this._c.subscribeCanvasConfigured(this.fc);var r=this._c.canvas;r.style.position="absolute",r.style.zIndex="1",r.style.left="0",r.style.top="0",this.wc=Ch(this.kf,new gh(16,16)),this.wc.subscribeCanvasConfigured(this.vc);var e=this.wc.canvas;e.style.position="absolute",e.style.zIndex="2",e.style.left="0",e.style.top="0";var u={mouseDownEvent:this.Af.bind(this),touchStartEvent:this.Af.bind(this),pressedMouseMoveEvent:this.Lf.bind(this),touchMoveEvent:this.Lf.bind(this),mouseDownOutsideEvent:this.Mc.bind(this),mouseUpEvent:this.Ef.bind(this),touchEndEvent:this.Ef.bind(this),mouseDoubleClickEvent:this.bc.bind(this),doubleTapEvent:this.bc.bind(this),mouseEnterEvent:this.mc.bind(this),mouseLeaveEvent:this.Tf.bind(this)};this.Nf=new Lh(this.wc.canvas,u,{Ga:function(){return!1},Qa:function(){return!0}})}return t.prototype.destroy=function(){this.Nf.destroy(),this.wc.unsubscribeCanvasConfigured(this.vc),this.wc.destroy(),this._c.unsubscribeCanvasConfigured(this.fc),this._c.destroy(),null!==this.Yt&&this.Yt.onMarksChanged().unsubscribeAll(this),this.Yt=null,this.oc.destroy()},t.prototype.getElement=function(){return this.kf},t.prototype.floating=function(){var t;return!!(null===(t=this.Yt)||void 0===t?void 0:t.options().floating)},t.prototype.lineColor=function(){return E(this.Yt).options().borderColor},t.prototype.textColor=function(){return this.bi.textColor},t.prototype.fontSize=function(){return this.bi.fontSize},t.prototype.baseFont=function(){return st(this.fontSize(),this.bi.fontFamily)},t.prototype.rendererOptions=function(){var t,i=this.ql.options();i.align=this.dc?"right":"left";var n=this.Qf!==i.color,s=this.Je!==i.font;return(n||s)&&(this.cc(i),this.Qf=i.color),s&&(this.uc.reset(),this.Je=i.font),(null===(t=this.Yt)||void 0===t?void 0:t.options().floating)?(this.dc?(this.kf.style.bottom="0",this.kf.style.zIndex="2",this.kf.style.position="absolute"):this.kf.style.left="-100%",this.kf.style.pointerEvents="none"):(this.kf.style.left="initial",this.kf.style.bottom="initial",this.kf.style.zIndex="initial",this.kf.style.position="relative",this.kf.style.pointerEvents="initial"),i},t.prototype.optimalWidth=function(){if(null===this.Yt)return 0;var t=34,i=this.rendererOptions(),n=kh(this._c.canvas),s=this.Yt.marks();n.font=this.baseFont(),s.length>0&&(t=Math.max(this.uc.measureText(n,s[0].label),this.uc.measureText(n,s[s.length-1].label)));for(var h=this.hs().filter((function(t){return t instanceof pt})),r=h.length;r--;){var e=this.uc.measureText(n,h[r].At());e>t&&(t=e)}var u=this.Yt.firstValue();if(null!==u&&null!==this.rc){var o=this.Yt.coordinateToPrice(1,u),l=this.Yt.coordinateToPrice(this.rc.h-2,u);t=Math.max(t,this.uc.measureText(n,this.Yt.formatPrice(Math.floor(Math.min(o,l))+.11111111111111,u)),this.uc.measureText(n,this.Yt.formatPrice(Math.ceil(Math.max(o,l))-.11111111111111,u)))}var a=t||34,f=Math.ceil(i.borderSize+i.tickLength+i.paddingInner+i.paddingOuter+a);return f+=f%2},t.prototype.setSize=function(t){if(t.w<0||t.h<0)throw new Error("Try to set invalid size to PriceAxisWidget "+JSON.stringify(t));null!==this.rc&&this.rc.equals(t)||(this.rc=t,this.ac=!0,this._c.resizeCanvas({width:t.w,height:t.h}),this.wc.resizeCanvas({width:t.w,height:t.h}),this.ac=!1,this.kf.style.width=t.w+"px",this.kf.style.height=t.h+"px",this.kf.style.minWidth=t.w+"px")},t.prototype.getWidth=function(){return E(this.rc).w},t.prototype.setPriceScale=function(t){this.Yt!==t&&(null!==this.Yt&&this.Yt.onMarksChanged().unsubscribeAll(this),this.Yt=t,t.onMarksChanged().subscribe(this.ns.bind(this),this))},t.prototype.priceScale=function(){return this.Yt},t.prototype.reset=function(){var t=this.ui.state();this.ui.chart().model().resetPriceScale(t,E(this.priceScale()))},t.prototype.paint=function(t){if(null!==this.rc){if(1!==t){var i=kh(this._c.canvas),n=this.ui.canvasRenderParams(this._c);this.gc(),this.yc(i,n),this.ue(i,n),this.kc(i,n,!0),this.xc(i,n),this.kc(i,n)}var s=kh(this.wc.canvas),h=this.ui.canvasRenderParams(this.wc),r=this.rc.w,e=this.rc.h;wt(s,h.pixelRatio,(function(){s.clearRect(0,0,r,e)})),this.Cc(s,h)}},t.prototype.getImage=function(){return this._c.canvas},t.prototype.update=function(){var t;null===(t=this.Yt)||void 0===t||t.marks()},t.prototype.Af=function(t){if(null!==this.Yt&&!this.Yt.isEmpty()&&this.ui.chart().options().handleScale.axisPressedMouseMove.price){var i=this.ui.chart().model(),n=this.ui.state();this.ec=!0,i.startScalePrice(n,this.Yt,t.localY)}},t.prototype.Lf=function(t){if(null!==this.Yt&&this.ui.chart().options().handleScale.axisPressedMouseMove.price){var i=this.ui.chart().model(),n=this.ui.state(),s=this.Yt;i.scalePriceTo(n,s,t.localY)}},t.prototype.Mc=function(){if(null!==this.Yt&&this.ui.chart().options().handleScale.axisPressedMouseMove.price){var t=this.ui.chart().model(),i=this.ui.state(),n=this.Yt;this.ec&&(this.ec=!1,t.endScalePrice(i,n))}},t.prototype.Ef=function(t){if(null!==this.Yt&&this.ui.chart().options().handleScale.axisPressedMouseMove.price){var i=this.ui.chart().model(),n=this.ui.state();this.ec=!1,i.endScalePrice(n,this.Yt)}},t.prototype.bc=function(t){this.ui.chart().options().handleScale.axisDoubleClickReset&&this.reset()},t.prototype.mc=function(t){null!==this.Yt&&(!this.ui.chart().model().options().handleScale.axisPressedMouseMove.price||this.Yt.isPercentage()||this.Yt.isIndexedTo100()||this.Nc(1))},t.prototype.Tf=function(t){this.Nc(0)},t.prototype.hs=function(){var t=this,i=[],n=null===this.Yt?void 0:this.Yt;return function(s){for(var h=0;h<s.length;++h)for(var r=s[h].priceAxisViews(t.ui.state(),n),e=0;e<r.length;e++)i.push(r[e])}(this.ui.state().orderedSources()),i},t.prototype.yc=function(t,i){var n=this;if(null!==this.rc){var s=this.rc.w,h=this.rc.h;wt(t,i.pixelRatio,(function(){var i=n.ui.state().model(),r=i.backgroundTopColor(),e=i.backgroundBottomColor();r===e?Mt(t,0,0,s,h,r):bt(t,0,0,s,h,r,e)}))}},t.prototype.ue=function(t,i){if(null!==this.rc&&null!==this.Yt&&this.Yt.options().borderVisible){t.save(),t.fillStyle=this.lineColor();var n,s=i.pixelRatio,h=Math.max(1,Math.floor(this.rendererOptions().borderSize*s));n=this.dc?Math.floor(this.rc.w*s)-h:0,t.fillRect(n,0,h,Math.ceil(this.rc.h*s)),t.restore()}},t.prototype.xc=function(t,i){if(null!==this.rc&&null!==this.Yt){var n=i.pixelRatio,s=this.Yt.marks();t.save(),t.strokeStyle=this.lineColor(),t.font=this.baseFont(),t.fillStyle=this.lineColor();var h=this.rendererOptions(),r=this.Yt.options().borderVisible&&this.Yt.options().drawTicks,e=this.dc?Math.floor((this.rc.w-h.tickLength)*n-h.borderSize*n):Math.floor(h.borderSize*n),u=this.dc?Math.round(e-h.paddingInner*n):Math.round(e+h.tickLength*n+h.paddingInner*n),o=this.dc?"right":"left",l=Math.max(1,Math.floor(n)),a=Math.floor(.5*n);if(r){var f=Math.round(h.tickLength*n);t.beginPath();for(var c=0,v=s;c<v.length;c++){var d=v[c];t.rect(e,Math.round(d.coord*n)-a,f,l)}t.fill()}t.fillStyle=this.textColor();for(var _=0,w=s;_<w.length;_++){d=w[_];this.oc.ic(t,d.label,u,Math.round(d.coord*n),o)}t.restore()}},t.prototype.gc=function(){if(null!==this.rc&&null!==this.Yt){var t=this.rc.h/2,i=[],n=this.Yt.orderedSources().slice(),s=this.ui.state(),h=this.rendererOptions();this.Yt===s.defaultVisiblePriceScale()&&this.ui.state().orderedSources().forEach((function(t){s.isOverlay(t)&&n.push(t)}));var r=this.Yt.dataSources()[0],e=this.Yt;n.forEach((function(n){var h=n.priceAxisViews(s,e).filter((function(t){return t instanceof pt}));h.forEach((function(t){t.Ht(void 0),t.jt()&&i.push(t)})),r===n&&h.length>0&&(t=h[0].Lt())}));var u=i.filter((function(i){return i.Lt()<=t})),o=i.filter((function(i){return i.Lt()>t}));if(u.sort((function(t,i){return i.Lt()-t.Lt()})),u.length&&o.length&&o.push(u[0]),o.sort((function(t,i){return t.Lt()-i.Lt()})),i.forEach((function(t){return t.Ht(t.Lt())})),this.Yt.options().alignLabels){for(var l=1;l<u.length;l++){var a=u[l],f=(v=u[l-1]).Dt(h,!1);a.Lt()>(d=v.It())-f&&a.Ht(d-f)}for(var c=1;c<o.length;c++){var v,d;a=o[c],f=(v=o[c-1]).Dt(h,!0);a.Lt()<(d=v.It())+f&&a.Ht(d+f)}}}},t.prototype.kc=function(t,i,n){if(null!==this.rc){t.save();var s=this.hs(),h=this.rendererOptions();s.forEach((function(s){var r=s.renderer();t.save(),n&&r.drawBackground?r.drawBackground(t,h,i):r.draw&&r.draw(t,h,i),t.restore()})),t.restore()}},t.prototype.Cc=function(t,i){if(null!==this.rc&&null!==this.Yt){t.save();var n=this.ui.chart().model(),s=[],h=this.ui.state(),r=n.crosshairSource().priceAxisViews(h,this.Yt);r.length&&s.push(r);var e=this.rendererOptions();s.forEach((function(n){n.forEach((function(n){var s=n.renderer();t.save(),s.draw&&(s.draw(t,e,i),t.restore())}))})),t.restore()}},t.prototype.Nc=function(t){this.kf.style.cursor=1===t?"ns-resize":"default"},t.prototype.ns=function(){var t=this.optimalWidth();this.lc<t&&this.ui.chart().model().fullUpdate(),this.lc=t},t.prototype.cc=function(t){this.oc.destroy(),this.oc=new Vh(t.fontSize,t.color,t.fontFamily)},t}();var Hh=function(){if(!Nh)return!1;var t=!!navigator.maxTouchPoints||!!navigator.msMaxTouchPoints||!!Nh&&("ontouchstart"in window||Boolean(window.DocumentTouch&&document instanceof window.DocumentTouch));return"onorientationchange"in window&&t}();var jh=function(){if(!Nh)return!1;var t=/Android/i.test(navigator.userAgent),i=/iPhone|iPad|iPod|AppleWebKit.+Mobile/i.test(navigator.userAgent);return t||i}();function Uh(t,i,n){t.drawBackground&&t.drawBackground(i,n)}function qh(t,i,n){t.draw(i,n)}function Yh(t,i){return t.paneViews()}function $h(t,i){return void 0!==t.topPaneViews?t.topPaneViews(i):[]}var Kh=function(){function t(t,i){var n=this;this.rc=new gh(0,0),this.Sc=null,this.Tc=null,this.Ac=null,this.Lc=!1,this.Ec=new $,this.Bc=0,this.Dc=!1,this.Fc=null,this.Pc=!1,this.Wc=null,this.Rc=null,this.fc=function(){return n.zc&&n.Mi().lightUpdate()},this.vc=function(){return n.zc&&n.Mi().lightUpdate()},this.Oc=t,this.zc=i,this.zc.onDestroyed().subscribe(this.Vc.bind(this),this,!0);var s=this.Mi().getPaneIndex(E(this.zc));this.Ic=document.createElement("td"),this.Ic.style.padding="0",this.Ic.style.position="relative",this.Ic.className+="pane-".concat(s);var h=document.createElement("div");h.style.width="100%",h.style.height="100%",h.style.position="relative",h.style.overflow="hidden",h.style.transform="translateZ(0px)",this.Hc=document.createElement("td"),this.Hc.style.position="relative",this.Hc.style.padding="0",this.jc=document.createElement("td"),this.jc.style.padding="0",this.Ic.appendChild(h),this._c=Ch(h,new gh(16,16)),this._c.subscribeCanvasConfigured(this.fc);var r=this._c.canvas;r.style.position="absolute",r.style.zIndex="1",r.style.left="0",r.style.top="0",this.wc=Ch(h,new gh(16,16)),this.wc.subscribeCanvasConfigured(this.vc);var e=this.wc.canvas;e.style.position="absolute",e.style.zIndex="2",e.style.left="0",e.style.top="0",this.yf=document.createElement("tr"),this.yf.appendChild(this.Hc),this.yf.appendChild(this.Ic),this.yf.appendChild(this.jc),this.updatePriceAxisWidgetsStates(),this.Nf=new Lh(this.wc.canvas,this,{Ga:function(){return null===n.Fc&&!n.Oc.options().handleScroll.vertTouchDrag},Qa:function(){return null===n.Fc&&!n.Oc.options().handleScroll.horzTouchDrag}})}return t.prototype.destroy=function(){null!==this.Sc&&this.Sc.destroy(),null!==this.Tc&&this.Tc.destroy(),this.wc.unsubscribeCanvasConfigured(this.vc),this.wc.destroy(),this._c.unsubscribeCanvasConfigured(this.fc),this._c.destroy(),null!==this.zc&&this.zc.onDestroyed().unsubscribeAll(this),this.Nf.destroy()},t.prototype.state=function(){return E(this.zc)},t.prototype.setState=function(i){null!==this.zc&&this.zc.onDestroyed().unsubscribeAll(this),this.zc=i,null!==this.zc&&this.zc.onDestroyed().subscribe(t.prototype.Vc.bind(this),this,!0),this.updatePriceAxisWidgetsStates()},t.prototype.setCursor=function(t){var i=t.toString();this.Ic.style.cursor!==i&&(this.Ic.style.cursor=i)},t.prototype.chart=function(){return this.Oc},t.prototype.getElement=function(){return this.yf},t.prototype.updatePriceAxisWidgetsStates=function(){if(null!==this.zc&&(this.Uc(),0!==this.Mi().serieses().length)){if(null!==this.Sc){var t=this.zc.leftPriceScale();this.Sc.setPriceScale(E(t))}if(null!==this.Tc){var i=this.zc.rightPriceScale();this.Tc.setPriceScale(E(i))}}},t.prototype.updatePriceAxisWidgets=function(){null!==this.Sc&&this.Sc.update(),null!==this.Tc&&this.Tc.update()},t.prototype.stretchFactor=function(){return null!==this.zc?this.zc.stretchFactor():0},t.prototype.setStretchFactor=function(t){this.zc&&this.zc.setStretchFactor(t)},t.prototype.mouseEnterEvent=function(t){if(this.zc){this.qc();var i=t.localX,n=t.localY;this.Yc(i,n)}},t.prototype.mouseDownEvent=function(t){this.qc(),this.$c(),this.Yc(t.localX,t.localY)},t.prototype.mouseMoveEvent=function(t){if(this.zc){var i=t.localX,n=t.localY;if(t){if(this.Kc(),document.activeElement!==document.body&&document.activeElement!==document.documentElement)E(document.activeElement).blur();else{var s=document.getSelection();null!==s&&s.removeAllRanges()}var r=this.Mi();if(this.zc.defaultPriceScale().isEmpty()||r.timeScale().isEmpty())return;if(null!==this.Fc){var e=r.crosshairSource();this.Wc=new h(e.appliedX(),e.appliedY()),this.Fc=new h(t.localX,t.localY)}}else this.Zc()&&this.Xc();Hh||(this.Yc(i,n),this.Jc(9,t))}},t.prototype.mouseClickEvent=function(t){if(null!==this.zc){this.qc(),this.Jc(3,t);var i=t.localX,n=t.localY;if(this.Ec.hasListeners()){var s=this.Mi().crosshairSource().appliedIndex(),r=this.Mi().getPaneIndex(E(this.zc)),e=new h(i,n);e.paneIndex=r,this.Ec.fire(s,e)}this.Gc()}},t.prototype.pressedMouseMoveEvent=function(t){if(null!==this.zc){var i=this.Mi(),n=t.localX,s=t.localY;if(null!==this.Fc){this.Pc=!1;var r=E(this.Wc),e=r.x+(n-this.Fc.x),u=r.y+(s-this.Fc.y);this.Yc(e,u)}else this.Zc()||this.Yc(n,s);if(null===this.Ac&&this.Jc(11,t),!i.timeScale().isEmpty()&&!t.consumed){var o=this.Oc.options(),l=o.handleScroll,a=o.kineticScroll;if(l.pressedMouseMove&&"touch"!==t.type||(l.horzTouchDrag||l.vertTouchDrag)&&"mouse"!==t.type){var f=this.zc.defaultPriceScale(),c=performance.now();null!==this.Ac||this.Qc()||(this.Ac=new h(t.clientX,t.clientY),this.Ac.ir=c,this.Ac.tv=t.localX,this.Ac.iv=t.localY),null!==this.Rc&&this.Rc.$f(t.localX,c),null===this.Ac||this.Lc||this.Ac.x===t.clientX&&this.Ac.y===t.clientY||(null===this.Rc&&("touch"===t.type&&a.touch||"mouse"===t.type&&a.mouse)&&(this.Rc=new Oh(.2,7,.997,15),this.Rc.$f(this.Ac.tv,this.Ac.ir),this.Rc.$f(t.localX,c)),f.isEmpty()||i.startScrollPrice(this.zc,f,t.localY),i.startScrollTime(t.localX),this.Lc=!0),this.Lc&&(f.isEmpty()||i.scrollPriceTo(this.zc,f,t.localY),i.scrollTimeTo(t.localX))}}}},t.prototype.mouseUpEvent=function(t){null!==this.zc&&(this.qc(),this.Jc(10,t),this.Dc=!1,this.nv(t))},t.prototype.longTapEvent=function(t){if(this.Dc=!0,null===this.Fc&&jh){var i=new h(t.localX,t.localY);this.sv(i,i)}},t.prototype.mouseLeaveEvent=function(t){null!==this.zc&&(this.qc(),this.zc.model().setHoveredSource(null),this.Xc())},t.prototype.clicked=function(){return this.Ec},t.prototype.pinchStartEvent=function(){this.Bc=1,this.Kc()},t.prototype.pinchEvent=function(t,i){if(this.Oc.options().handleScale.pinch){var n=5*(i-this.Bc);this.Bc=i,this.Mi().zoomTime(t.x,n)}},t.prototype.touchStartEvent=function(t){if(this.Dc=!1,this.Pc=null!==this.Fc,this.$c(),null!==this.Fc){var i=this.Mi().crosshairSource();this.Wc=new h(i.appliedX(),i.appliedY()),this.Fc=new h(t.localX,t.localY)}},t.prototype.touchMoveEvent=function(t){if(null!==this.zc){var i=t.localX,n=t.localY;if(null===this.Fc)this.hv(t);else{this.Pc=!1;var s=E(this.Wc),h=s.x+(i-this.Fc.x),r=s.y+(n-this.Fc.y);this.Yc(h,r)}}},t.prototype.touchEndEvent=function(t){0===this.chart().options().trackingMode.exitMode&&(this.Pc=!0),this.Gc(),this.nv(t)},t.prototype.setPriceAxisSize=function(t,i){E("left"===i?this.Sc:this.Tc).setSize(new gh(t,this.rc.h))},t.prototype.getSize=function(){return this.rc},t.prototype.setSize=function(t){if(t.w<0||t.h<0)throw new Error("Try to set invalid size to PaneWidget "+JSON.stringify(t));this.rc.equals(t)||(this.rc=t,this._c.resizeCanvas({width:t.w,height:t.h}),this.wc.resizeCanvas({width:t.w,height:t.h}),this.Ic.style.width=t.w+"px",this.Ic.style.height=t.h+"px")},t.prototype.recalculatePriceScales=function(){var t=E(this.zc);t.recalculatePriceScale(t.leftPriceScale()),t.recalculatePriceScale(t.rightPriceScale());for(var i=0,n=t.dataSources();i<n.length;i++){var s=n[i];if(t.isOverlay(s)){var h=s.priceScale();null!==h&&t.recalculatePriceScale(h),s.updateAllViews()}}},t.prototype.getImage=function(){return this._c.canvas},t.prototype.paint=function(t){if(0!==t&&null!==this.zc){if(t>1&&this.recalculatePriceScales(),null!==this.Sc&&this.Sc.paint(t),null!==this.Tc&&this.Tc.paint(t),1!==t){var i=kh(this._c.canvas),n=this.canvasRenderParams(this._c);i.save(),this.yc(i,n),this.zc&&(this.rv(i,n),this.ev(i,n),this.kc(i,n,Yh)),i.restore()}var s=kh(this.wc.canvas),h=this.canvasRenderParams(this.wc);s.clearRect(0,0,Math.ceil(this.rc.w*this.wc.pixelRatio),Math.ceil(this.rc.h*this.wc.pixelRatio)),this.kc(s,h,$h),this.uv(s,h)}},t.prototype.leftPriceAxisWidget=function(){return this.Sc},t.prototype.getPaneCell=function(){return this.Ic},t.prototype.rightPriceAxisWidget=function(){return this.Tc},t.prototype.canvasRenderParams=function(t){return t||(t=this._c),{pixelRatio:t.pixelRatio,physicalWidth:t.canvas.width,physicalHeight:t.canvas.height,cssWidth:this.chart().model().timeScale().width(),cssHeight:this.state().height()}},t.prototype.Jc=function(t,i){var n=this;if(null!==this.zc){this.setCursor(Ui.Crosshair),this.Mi().lineToolCreator().onInputEvent(this,t,i);for(var s=this.zc.orderedSources(),h=s.length-1;h>=0;h--){s[h].paneViews().forEach((function(s){void 0!==s.onInputEvent&&s.onInputEvent(n,t,i)}))}}},t.prototype.Vc=function(){null!==this.zc&&this.zc.onDestroyed().unsubscribeAll(this),this.zc=null},t.prototype.yc=function(t,i){var n=this;wt(t,i.pixelRatio,(function(){var i=n.Mi(),s=i.backgroundTopColor(),h=i.backgroundBottomColor();s===h?Mt(t,0,0,n.rc.w,n.rc.h,h):bt(t,0,0,n.rc.w,n.rc.h,s,h)}))},t.prototype.rv=function(t,i){var n=E(this.zc),s=n.grid().paneView().renderer(n.height(),n.width(),n);null!==s&&(t.save(),s.draw(t,i),t.restore())},t.prototype.ev=function(t,i){var n=this.Mi().watermarkSource();this.ov(t,i,Yh,Uh,n),this.ov(t,i,Yh,qh,n)},t.prototype.uv=function(t,i){this.ov(t,i,Yh,qh,this.Mi().crosshairSource())},t.prototype.kc=function(t,i,n){for(var s=E(this.zc).orderedSources(),h=0,r=s;h<r.length;h++){var e=r[h];this.ov(t,i,n,Uh,e)}for(var u=0,o=s;u<o.length;u++){e=o[u];this.ov(t,i,n,qh,e)}},t.prototype.ov=function(t,i,n,s,h){for(var r=E(this.zc),e=n(h,r),u=r.height(),o=r.width(),l=0,a=e;l<a.length;l++){var f=a[l].renderer(u,o,r);null!==f&&(t.save(),s(f,t,i),t.restore())}},t.prototype.Uc=function(){if(null!==this.zc){var t=this.Oc,i=this.zc.leftPriceScale().options().visible,n=this.zc.rightPriceScale().options().visible;i||null===this.Sc||(this.Hc.removeChild(this.Sc.getElement()),this.Sc.destroy(),this.Sc=null),n||null===this.Tc||(this.jc.removeChild(this.Tc.getElement()),this.Tc.destroy(),this.Tc=null);var s=t.model().rendererOptionsProvider();i&&null===this.Sc&&(this.Sc=new Ih(this,t.options().layout,s,"left"),this.Hc.appendChild(this.Sc.getElement())),n&&null===this.Tc&&(this.Tc=new Ih(this,t.options().layout,s,"right"),this.jc.appendChild(this.Tc.getElement()))}},t.prototype.Zc=function(){return jh&&null===this.Fc},t.prototype.Qc=function(){return jh&&this.Dc||null!==this.Fc},t.prototype.lv=function(t){return Math.max(0,Math.min(t,this.rc.w-1))},t.prototype.av=function(t){return Math.max(0,Math.min(t,this.rc.h-1))},t.prototype.Yc=function(t,i){this.Mi().setAndSaveCurrentPosition(this.lv(t),this.av(i),E(this.zc))},t.prototype.Xc=function(){this.Mi().clearCurrentPosition()},t.prototype.Gc=function(){this.Pc&&(this.Fc=null,this.Xc())},t.prototype.sv=function(t,i){this.Fc=t,this.Pc=!1,this.Yc(i.x,i.y);var n=this.Mi().crosshairSource();this.Wc=new h(n.appliedX(),n.appliedY())},t.prototype.Mi=function(){return this.Oc.model()},t.prototype.fv=function(){var t=this.Mi(),i=this.state(),n=i.defaultPriceScale();t.endScrollPrice(i,n),t.endScrollTime(),this.Ac=null,this.Lc=!1},t.prototype.nv=function(t){var i=this;if(this.Lc){var n=performance.now();if(null!==this.Rc&&this.Rc.Be(t.localX,n),null===this.Rc||this.Rc.Zf(n))this.fv();else{var s=this.Mi(),h=s.timeScale(),r=this.Rc,e=function(){if(!r.Jf()){var t=performance.now(),n=r.Zf(t);if(!r.Jf()){var u=h.rightOffset();s.scrollTimeTo(r.Kf(t)),u===h.rightOffset()&&(n=!0,i.Rc=null)}n?i.fv():requestAnimationFrame(e)}};requestAnimationFrame(e)}}},t.prototype.qc=function(){this.Fc=null},t.prototype.$c=function(){if(this.zc){if(this.Kc(),document.activeElement!==document.body&&document.activeElement!==document.documentElement)E(document.activeElement).blur();else{var t=document.getSelection();null!==t&&t.removeAllRanges()}!this.zc.defaultPriceScale().isEmpty()&&this.Mi().timeScale().isEmpty()}},t.prototype.hv=function(t){if(null!==this.zc){var i=this.Mi();if(!i.timeScale().isEmpty()){var n=this.Oc.options(),s=n.handleScroll,r=n.kineticScroll;if(s.pressedMouseMove&&!t.isTouch||(s.horzTouchDrag||s.vertTouchDrag)&&t.isTouch){var e=this.zc.defaultPriceScale(),u=performance.now();null!==this.Ac||this.Qc()||(this.Ac=new h(t.clientX,t.clientY),this.Ac.ir=u,this.Ac.tv=t.localX,this.Ac.iv=t.localY),null!==this.Rc&&this.Rc.$f(t.localX,u),null===this.Ac||this.Lc||this.Ac.x===t.clientX&&this.Ac.y===t.clientY||(null===this.Rc&&(t.isTouch&&r.touch||!t.isTouch&&r.mouse)&&(this.Rc=new Oh(.2,7,.997,15),this.Rc.$f(this.Ac.tv,this.Ac.ir),this.Rc.$f(t.localX,u)),e.isEmpty()||i.startScrollPrice(this.zc,e,t.localY),i.startScrollTime(t.localX),this.Lc=!0),this.Lc&&(e.isEmpty()||i.scrollPriceTo(this.zc,e,t.localY),i.scrollTimeTo(t.localX))}}}},t.prototype.Kc=function(){var t=performance.now(),i=null===this.Rc||this.Rc.Zf(t);null!==this.Rc&&(i||this.fv()),null!==this.Rc&&(this.Rc.Gf(),this.Rc=null)},t}(),Zh=function(){function t(t,i,n,s,h){var r=this;this.Rt=!0,this.rc=new gh(0,0),this.fc=function(){return r.paint(3)},this.dc="left"===t,this.ql=n.rendererOptionsProvider,this.bi=i,this.cv=s,this.vv=h,this.kf=document.createElement("div"),this.kf.style.width="25px",this.kf.style.height="100%",this.kf.style.overflow="hidden",this._c=Ch(this.kf,new gh(16,16)),this._c.subscribeCanvasConfigured(this.fc)}return t.prototype.destroy=function(){this._c.unsubscribeCanvasConfigured(this.fc),this._c.destroy()},t.prototype.getElement=function(){return this.kf},t.prototype.getSize=function(){return this.rc},t.prototype.setSize=function(t){if(t.w<0||t.h<0)throw new Error("Try to set invalid size to PriceAxisStub "+JSON.stringify(t));this.rc.equals(t)||(this.rc=t,this._c.resizeCanvas({width:t.w,height:t.h}),this.kf.style.width="".concat(t.w,"px"),this.kf.style.minWidth="".concat(t.w,"px"),this.kf.style.height="".concat(t.h,"px"),this.Rt=!0)},t.prototype.paint=function(t){if((!(t<3)||this.Rt)&&0!==this.rc.w&&0!==this.rc.h){this.Rt=!1;var i=kh(this._c.canvas),n={pixelRatio:this._c.pixelRatio};this.yc(i,n),this.ue(i,n)}},t.prototype.getImage=function(){return this._c.canvas},t.prototype.ue=function(t,i){if(this.cv()){var n=this.rc.w,s=i.pixelRatio;t.save(),t.fillStyle=this.bi.timeScale.borderColor;var h=Math.floor(this.ql.options().borderSize*s),r=this.dc?Math.round(n*s)-h:0;t.fillRect(r,0,h,h),t.restore()}},t.prototype.yc=function(t,i){var n=this;wt(t,i.pixelRatio,(function(){Mt(t,0,0,n.rc.w,n.rc.h,n.vv())}))},t}();function Xh(t,i){return t.weight>i.weight?t:i}var Jh=function(){function t(t){var i=this;this.dv=null,this._v=null,this.B=null,this.wv=!1,this.rc=new gh(0,0),this.Mv=new $,this.uc=new rt(5),this.ac=!1,this.fc=function(){i.ac||i.Oc.model().lightUpdate()},this.vc=function(){i.ac||i.Oc.model().lightUpdate()},this.Oc=t,this.bi=t.options().layout,this.bv=document.createElement("tr"),this.mv=document.createElement("td"),this.mv.style.padding="0",this.pv=document.createElement("td"),this.pv.style.padding="0",this.kf=document.createElement("td"),this.kf.style.height="25px",this.kf.style.padding="0",this.gv=document.createElement("div"),this.gv.style.width="100%",this.gv.style.height="100%",this.gv.style.position="relative",this.gv.style.overflow="hidden",this.kf.appendChild(this.gv),this._c=Ch(this.gv,new gh(16,16)),this._c.subscribeCanvasConfigured(this.fc);var n=this._c.canvas;n.style.position="absolute",n.style.zIndex="1",n.style.left="0",n.style.top="0",this.wc=Ch(this.gv,new gh(16,16)),this.wc.subscribeCanvasConfigured(this.vc);var s=this.wc.canvas;s.style.position="absolute",s.style.zIndex="2",s.style.left="0",s.style.top="0",this.bv.appendChild(this.mv),this.bv.appendChild(this.kf),this.bv.appendChild(this.pv),this.yv(),this.Oc.model().priceScalesOptionsChanged().subscribe(this.yv.bind(this),this),this.Nf=new Lh(this.wc.canvas,this,{Ga:function(){return!0},Qa:function(){return!1}})}return t.prototype.destroy=function(){this.Nf.destroy(),null!==this.dv&&this.dv.destroy(),null!==this._v&&this._v.destroy(),this.wc.unsubscribeCanvasConfigured(this.vc),this.wc.destroy(),this._c.unsubscribeCanvasConfigured(this.fc),this._c.destroy()},t.prototype.getElement=function(){return this.bv},t.prototype.leftStub=function(){return this.dv},t.prototype.rightStub=function(){return this._v},t.prototype.mouseDownEvent=function(t){if(!this.wv){this.wv=!0;var i=this.Oc.model();!i.timeScale().isEmpty()&&this.Oc.options().handleScale.axisPressedMouseMove.time&&i.startScaleTime(t.localX)}},t.prototype.touchStartEvent=function(t){this.mouseDownEvent(t)},t.prototype.mouseDownOutsideEvent=function(){var t=this.Oc.model();!t.timeScale().isEmpty()&&this.wv&&(this.wv=!1,this.Oc.options().handleScale.axisPressedMouseMove.time&&t.endScaleTime())},t.prototype.pressedMouseMoveEvent=function(t){var i=this.Oc.model();!i.timeScale().isEmpty()&&this.Oc.options().handleScale.axisPressedMouseMove.time&&i.scaleTimeTo(t.localX)},t.prototype.touchMoveEvent=function(t){this.pressedMouseMoveEvent(t)},t.prototype.mouseUpEvent=function(){this.wv=!1;var t=this.Oc.model();t.timeScale().isEmpty()&&!this.Oc.options().handleScale.axisPressedMouseMove.time||t.endScaleTime()},t.prototype.touchEndEvent=function(){this.mouseUpEvent()},t.prototype.mouseDoubleClickEvent=function(){this.Oc.options().handleScale.axisDoubleClickReset&&this.Oc.model().resetTimeScale()},t.prototype.doubleTapEvent=function(){this.mouseDoubleClickEvent()},t.prototype.mouseEnterEvent=function(){this.Oc.model().options().handleScale.axisPressedMouseMove.time&&this.Nc(1)},t.prototype.mouseLeaveEvent=function(){this.Nc(0)},t.prototype.getSize=function(){return this.rc},t.prototype.sizeChanged=function(){return this.Mv},t.prototype.setSizes=function(t,i,n){this.rc&&this.rc.equals(t)||(this.rc=t,this.ac=!0,this._c.resizeCanvas({width:t.w,height:t.h}),this.wc.resizeCanvas({width:t.w,height:t.h}),this.ac=!1,this.kf.style.minWidth=t.w+"px",this.kf.style.width=t.w+"px",this.kf.style.height=t.h+"px",this.Mv.fire(t)),null!==this.dv&&this.dv.setSize(new gh(i,t.h)),null!==this._v&&this._v.setSize(new gh(n,t.h))},t.prototype.optimalHeight=function(){var t=this.kv();return Math.ceil(t.borderSize+t.tickLength+t.fontSize+t.paddingTop+t.paddingBottom)},t.prototype.update=function(){this.Oc.model().timeScale().marks()},t.prototype.getImage=function(){return this._c.canvas},t.prototype.paint=function(t){if(0!==t){if(1!==t){var i=kh(this._c.canvas),n=this.Oc.paneWidgets()[0].canvasRenderParams(this._c);this.yc(i,n),this.ue(i,n),this.kc(this.Oc.model().dataSources(),i,n,!0),this.xc(i,n),this.kc(this.Oc.model().dataSources(),i,n),null!==this.dv&&this.dv.paint(t),null!==this._v&&this._v.paint(t)}var s=kh(this.wc.canvas),h=this.Oc.paneWidgets()[0].canvasRenderParams(this.wc),r=this.wc.pixelRatio;s.clearRect(0,0,Math.ceil(this.rc.w*r),Math.ceil(this.rc.h*r)),this.kc([this.Oc.model().crosshairSource()],s,h)}},t.prototype.yc=function(t,i){var n=this;wt(t,i.pixelRatio,(function(){Mt(t,0,0,n.rc.w,n.rc.h,n.Oc.model().backgroundBottomColor())}))},t.prototype.ue=function(t,i){if(this.Oc.options().timeScale.borderVisible){t.save(),t.fillStyle=this.xv();var n=i.pixelRatio,s=Math.max(1,Math.floor(this.kv().borderSize*n));t.fillRect(0,0,Math.ceil(this.rc.w*n),s),t.restore()}},t.prototype.xc=function(t,i){var n=this,s=this.Oc.model().timeScale().marks();if(s&&0!==s.length){var h=i.pixelRatio,r=s.reduce(Xh,s[0]).weight;r>30&&r<50&&(r=30),t.save(),t.strokeStyle=this.xv();var e=this.kv(),u=e.borderSize+e.tickLength+e.paddingTop+e.fontSize-e.baselineOffset;t.textAlign="center",t.fillStyle=this.xv();var o=Math.floor(this.kv().borderSize*h),l=Math.max(1,Math.floor(h)),a=Math.floor(.5*h);if(this.Oc.model().timeScale().options().borderVisible){t.beginPath();for(var f=Math.round(e.tickLength*h),c=s.length;c--;){var v=Math.round(s[c].coord*h);t.rect(v-a,o,l,f)}t.fill()}t.fillStyle=this.W(),wt(t,i.pixelRatio,(function(){t.font=n.Cv();for(var i=0,h=s;i<h.length;i++){if((a=h[i]).weight<r){var e=a.needAlignCoordinate?n.Nv(t,a.coord,a.label):a.coord;t.fillText(a.label,e,u)}}t.font=n.Sv();for(var o=0,l=s;o<l.length;o++){var a;if((a=l[o]).weight>=r){e=a.needAlignCoordinate?n.Nv(t,a.coord,a.label):a.coord;t.fillText(a.label,e,u)}}})),t.restore()}},t.prototype.Nv=function(t,i,n){var s=this.uc.measureText(t,n),h=s/2,r=Math.floor(i-h)+.5;return r<0?i+=Math.abs(0-r):r+s>this.rc.w&&(i-=Math.abs(this.rc.w-(r+s))),i},t.prototype.kc=function(t,i,n,s){for(var h=this.kv(),r=0,e=t;r<e.length;r++)for(var u=0,o=e[r].timeAxisViews();u<o.length;u++){var l=o[u].renderer();i.save(),s&&l.drawBackground?l.drawBackground(i,h,n):l.draw&&l.draw(i,h,n),i.restore()}},t.prototype.xv=function(){return this.Oc.options().timeScale.borderColor},t.prototype.W=function(){return this.bi.textColor},t.prototype.F=function(){return this.bi.fontSize},t.prototype.Cv=function(){return st(this.F(),this.bi.fontFamily)},t.prototype.Sv=function(){return st(this.F(),this.bi.fontFamily,"bold")},t.prototype.kv=function(){null===this.B&&(this.B={borderSize:1,baselineOffset:NaN,paddingTop:NaN,paddingBottom:NaN,paddingHorizontal:NaN,tickLength:3,fontSize:NaN,font:"",widthCache:new rt});var t=this.B,i=this.Cv();if(t.font!==i){var n=this.F();t.fontSize=n,t.font=i,t.paddingTop=Math.ceil(n/2.5),t.paddingBottom=t.paddingTop,t.paddingHorizontal=Math.ceil(n/2),t.baselineOffset=Math.round(this.F()/5),t.widthCache.reset()}return this.B},t.prototype.Nc=function(t){this.kf.style.cursor=1===t?"ew-resize":"default"},t.prototype.yv=function(){var t=this.Oc.model(),i=t.options();i.leftPriceScale.visible||null===this.dv||(this.mv.removeChild(this.dv.getElement()),this.dv.destroy(),this.dv=null),i.rightPriceScale.visible||null===this._v||(this.pv.removeChild(this._v.getElement()),this._v.destroy(),this._v=null);var n={rendererOptionsProvider:this.Oc.model().rendererOptionsProvider()},s=function(){return i.leftPriceScale.borderVisible&&t.timeScale().options().borderVisible},h=function(){return t.backgroundBottomColor()};i.leftPriceScale.visible&&null===this.dv&&(this.dv=new Zh("left",i,n,s,h),this.mv.appendChild(this.dv.getElement())),i.rightPriceScale.visible&&null===this._v&&(this._v=new Zh("right",i,n,s,h),this.pv.appendChild(this._v.getElement()))},t}(),Gh=function(){function t(t,i){var n;this.Tv=[],this.Av=[],this.Lv=0,this.Yn=0,this.As=0,this.Ev=0,this.Bv=0,this.Dv=null,this.Fv=!1,this.Ec=new $,this.Il=new $,this.bi=i,this.bv=document.createElement("div"),this.bv.classList.add("tv-lightweight-charts"),this.bv.style.overflow="hidden",this.bv.style.width="100%",this.bv.style.height="100%",(n=this.bv).style.userSelect="none",n.style.webkitUserSelect="none",n.style.msUserSelect="none",n.style.MozUserSelect="none",n.style.webkitTapHighlightColor="transparent",this.Pv=document.createElement("table"),this.Pv.setAttribute("cellspacing","0"),this.bv.appendChild(this.Pv),this.Wv=this.Rv.bind(this),this.bv.addEventListener("wheel",this.Wv,{passive:!1}),this.Mi=new Mh(this.Ul.bind(this),this.bi),this.model().crosshairMoved().subscribe(this.zv.bind(this),this),this.Ov=new Jh(this),this.Pv.appendChild(this.Ov.getElement());var s=this.bi.width,h=this.bi.height;if(0===s||0===h){var r=t.getBoundingClientRect();0===s&&(s=Math.floor(r.width),s-=s%2),0===h&&(h=Math.floor(r.height),h-=h%2)}this.resize(s,h),this.Vv(),t.appendChild(this.bv),this.Iv(),this.Mi.timeScale().optionsApplied().subscribe(this.Mi.fullUpdate.bind(this.Mi),this),this.Mi.priceScalesOptionsChanged().subscribe(this.Mi.fullUpdate.bind(this.Mi),this)}return t.prototype.model=function(){return this.Mi},t.prototype.options=function(){return this.bi},t.prototype.paneWidgets=function(){return this.Tv},t.prototype.timeAxisWidget=function(){return this.Ov},t.prototype.destroy=function(){this.bv.removeEventListener("wheel",this.Wv),0!==this.Lv&&window.cancelAnimationFrame(this.Lv),this.Mi.crosshairMoved().unsubscribeAll(this),this.Mi.timeScale().optionsApplied().unsubscribeAll(this),this.Mi.priceScalesOptionsChanged().unsubscribeAll(this),this.Mi.destroy();for(var t=0,i=this.Tv;t<i.length;t++){var n=i[t];this.Pv.removeChild(n.getElement()),n.clicked().unsubscribeAll(this),n.destroy()}this.Tv=[];for(var s=0,h=this.Av;s<h.length;s++){var r=h[s];this.Hv(r)}this.Av=[],E(this.Ov).destroy(),null!==this.bv.parentElement&&this.bv.parentElement.removeChild(this.bv),this.Il.destroy(),this.Ec.destroy()},t.prototype.resize=function(t,i,n){if(void 0===n&&(n=!1),this.Yn!==i||this.As!==t){this.Yn=i,this.As=t;var s=i+"px",h=t+"px";E(this.bv).style.height=s,E(this.bv).style.width=h,this.Pv.style.height=s,this.Pv.style.width=h,n?this.jv(new Et(3)):this.Mi.fullUpdate()}},t.prototype.paint=function(t){void 0===t&&(t=new Et(3));for(var i=0;i<this.Tv.length;i++)this.Tv[i].paint(t.invalidateForPane(i).level);this.bi.timeScale.visible&&this.Ov.paint(t.fullInvalidation())},t.prototype.applyOptions=function(t){this.Mi.applyOptions(t),this.Iv();var i=t.width||this.As,n=t.height||this.Yn;this.resize(i,n)},t.prototype.clicked=function(){return this.Ec},t.prototype.crosshairMoved=function(){return this.Il},t.prototype.takeScreenshot=function(){var t=this;null!==this.Dv&&(this.jv(this.Dv),this.Dv=null);var i=this.Tv[0],n=xh(document,new gh(this.As,this.Yn)),s=kh(n),h=yh(n);return wt(s,h,(function(){var n=0,h=0,r=function(i){for(var r=0;r<t.Tv.length;r++){var e=t.Tv[r],u=e.getSize().h,o=E("left"===i?e.leftPriceAxisWidget():e.rightPriceAxisWidget()),l=o.getImage();if(s.drawImage(l,n,h,o.getWidth(),u),h+=u,r<t.Tv.length-1){var a=t.Av[r],f=a.Df(),c=a.Ff();s.drawImage(c,n,h,f.w,f.h),h+=f.h}}};t.Uv()&&(r("left"),n=E(i.leftPriceAxisWidget()).getWidth()),h=0;for(var e=0;e<t.Tv.length;e++){var u=t.Tv[e],o=u.getSize(),l=u.getImage();if(s.drawImage(l,n,h,o.w,o.h),h+=o.h,e<t.Tv.length-1){var a=t.Av[e],f=a.Df(),c=a.Ff();s.drawImage(c,n,h,f.w,f.h),h+=f.h}}n+=i.getSize().w,t.qv()&&(h=0,r("right"));var v=function(i){var r=E("left"===i?t.Ov.leftStub():t.Ov.rightStub()),e=r.getSize(),u=r.getImage();s.drawImage(u,n,h,e.w,e.h)};if(t.bi.timeScale.visible){n=0,t.Uv()&&(v("left"),n=E(i.leftPriceAxisWidget()).getWidth());var d=t.Ov.getSize();l=t.Ov.getImage();s.drawImage(l,n,h,d.w,d.h),t.qv()&&(n+=i.getSize().w,v("right"),s.restore())}})),n},t.prototype.getPriceAxisWidth=function(t){return"none"===t?0:("left"!==t||this.Uv())&&("right"!==t||this.qv())?0===this.Tv.length?0:E("left"===t?this.Tv[0].leftPriceAxisWidget():this.Tv[0].rightPriceAxisWidget()).getWidth():0},t.prototype.adjustSize=function(){this.Yv()},t.prototype.Yv=function(){for(var t,i=0,n=0,s=0,h=!1,r=!1,e=0,u=this.Tv;e<u.length;e++){var o=u[e];this.Uv()&&(n=Math.max(n,E(o.leftPriceAxisWidget()).optimalWidth()),h=E(o.leftPriceAxisWidget()).floating()),this.qv()&&(s=Math.max(s,E(o.rightPriceAxisWidget()).optimalWidth()),r=E(o.rightPriceAxisWidget()).floating()),i+=o.stretchFactor()}var l=this.As,a=this.Yn,f=Math.max(l-(h?0:n)-(r?0:s),0),c=1*this.Av.length,v=this.bi.timeScale.visible,d=this.bi.timeScale.visible?this.Ov.optimalHeight():0;d%2&&(d+=1);for(var _=c+d,w=a<_?0:a-_,M=w/i,b=0,m=(null===(t=document.body.ownerDocument.defaultView)||void 0===t?void 0:t.devicePixelRatio)||1,p=0;p<this.Tv.length;++p){(o=this.Tv[p]).setState(this.Mi.panes()[p]);var g,y=0;y=p===this.Tv.length-1?Math.ceil((w-b)*m)/m:Math.round(o.stretchFactor()*M*m)/m,b+=g=Math.max(y,2),o.setSize(new gh(f,g)),this.Uv()&&o.setPriceAxisSize(n,"left"),this.qv()&&o.setPriceAxisSize(s,"right"),o.state()&&this.Mi.setPaneHeight(o.state(),g)}this.Ov.setSizes(new gh(v?f:0,d),v&&!h?n:0,v&&!r?s:0),this.Mi.setWidth(f),this.Ev!==n&&(this.Ev=n),this.Bv!==s&&(this.Bv=s)},t.prototype.Rv=function(t){var i=t.deltaX/100,n=-t.deltaY/100;if(0!==i&&this.bi.handleScroll.mouseWheel||0!==n&&this.bi.handleScale.mouseWheel){switch(t.cancelable&&t.preventDefault(),t.deltaMode){case t.DOM_DELTA_PAGE:i*=120,n*=120;break;case t.DOM_DELTA_LINE:i*=32,n*=32}if(0!==n&&this.bi.handleScale.mouseWheel){var s=Math.sign(n)*Math.min(1,Math.abs(n)),h=t.clientX-this.bv.getBoundingClientRect().left;this.model().zoomTime(h,s)}0!==i&&this.bi.handleScroll.mouseWheel&&this.model().scrollChart(-80*i)}},t.prototype.jv=function(t){var i,n=t.fullInvalidation();3===n&&this.$v(),3!==n&&2!==n||(this.Kv(t),this.Zv(t),this.Ov.update(),this.Tv.forEach((function(t){t.updatePriceAxisWidgets()})),3===(null===(i=this.Dv)||void 0===i?void 0:i.fullInvalidation())&&(this.Dv.merge(t),this.$v(),this.Kv(this.Dv),this.Zv(this.Dv),t=this.Dv,this.Dv=null)),this.paint(t)},t.prototype.Zv=function(t){for(var i=0,n=t.timeScaleInvalidations();i<n.length;i++){var s=n[i];this.Bi(s)}},t.prototype.Kv=function(t){for(var i=this.Mi.panes(),n=0;n<i.length;n++)t.invalidateForPane(n).autoScale&&i[n].momentaryAutoScale()},t.prototype.Bi=function(t){var i=this.Mi.timeScale();switch(t.type){case 0:i.fitContent();break;case 1:i.setLogicalRange(t.value);break;case 2:i.setBarSpacing(t.value);break;case 3:i.setRightOffset(t.value);break;case 4:i.restoreDefault()}},t.prototype.Ul=function(t){var i=this;null!==this.Dv?this.Dv.merge(t):this.Dv=t,this.Fv||(this.Fv=!0,this.Lv=window.requestAnimationFrame((function(){if(i.Fv=!1,i.Lv=0,null!==i.Dv){var t=i.Dv;i.Dv=null,i.jv(t)}})))},t.prototype.$v=function(){this.Vv()},t.prototype.Hv=function(t){this.Pv.removeChild(t.Bf()),t.destroy()},t.prototype.Vv=function(){for(var t=this.Mi.panes(),i=t.length,n=this.Tv.length,s=i;s<n;s++){var h=L(this.Tv.pop());this.Pv.removeChild(h.getElement()),h.clicked().unsubscribeAll(this),h.destroy(),void 0!==(r=this.Av.pop())&&this.Hv(r)}for(s=n;s<i;s++){if((h=new Kh(this,t[s])).clicked().subscribe(this.Xv.bind(this),this),this.Tv.push(h),s>0){var r=new Wh(this,s-1,s,!1);this.Av.push(r),this.Pv.insertBefore(r.Bf(),this.Ov.getElement())}this.Pv.insertBefore(h.getElement(),this.Ov.getElement())}for(s=0;s<i;s++){var e=t[s];(h=this.Tv[s]).state()!==e?h.setState(e):h.updatePriceAxisWidgetsStates()}this.Iv(),this.Yv()},t.prototype.Jv=function(t,i){var n,s=new Map;null!==t&&this.Mi.serieses().forEach((function(i){var n=i.dataAt(t);null!==n&&s.set(i,n)}));if(null!==t){var r=this.Mi.timeScale().indexToTime(t);null!==r&&(n=r)}var e=this.model().hoveredSource(),u=null!==e&&e.source instanceof qs?e.source:void 0,o=null!==e&&void 0!==e.object?e.object.externalId:void 0;return{time:n,point:i&&new h(i.x,i.y)||void 0,paneIndex:null==i?void 0:i.paneIndex,hoveredSeries:u,seriesPrices:s,hoveredObject:o}},t.prototype.Xv=function(t,i){var n=this;this.Ec.fire((function(){return n.Jv(t,i)}))},t.prototype.zv=function(t,i){var n=this;this.Il.fire((function(){return n.Jv(t,i)}))},t.prototype.Iv=function(){var t=this.bi.timeScale.visible?"":"none";this.Ov.getElement().style.display=t},t.prototype.Uv=function(){return this.Tv[0].state().leftPriceScale().options().visible},t.prototype.qv=function(){return this.Tv[0].state().rightPriceScale().options().visible},t}();function Qh(t,i,n){var s=n.value;return{index:i,time:t,value:[s,s,s,s]}}function tr(t,i,n){var s=n.value,h={index:i,time:t,value:[s,s,s,s]};return"color"in n&&void 0!==n.color&&(h.color=n.color),h}function ir(t){return void 0!==t.value}function nr(t){return function(i,n,s){return void 0===(h=s).lowerValue&&void 0===h.open&&void 0===h.value?{time:i,index:n}:t(i,n,s);var h}}var sr={Candlestick:nr((function(t,i,n){var s={index:i,time:t,value:[n.open,n.high,n.low,n.close]};return"color"in n&&void 0!==n.color&&(s.color=n.color),"borderColor"in n&&void 0!==n.borderColor&&(s.borderColor=n.borderColor),"wickColor"in n&&void 0!==n.wickColor&&(s.wickColor=n.wickColor),s})),Bar:nr((function(t,i,n){var s={index:i,time:t,value:[n.open,n.high,n.low,n.close]};return"color"in n&&void 0!==n.color&&(s.color=n.color),s})),Area:nr(Qh),Baseline:nr(Qh),CloudArea:nr((function(t,i,n){return{index:i,time:t,value:[n.higherValue,n.higherValue,n.lowerValue,n.lowerValue]}})),BrokenArea:nr((function(t,i,n){var s={index:i,time:t,value:[n.higherValue,n.higherValue,n.lowerValue,n.lowerValue]};return void 0!==n.color&&(s.color=n.color),void 0!==n.label&&(s.label=n.label),void 0!==n.extendRight&&(s.extendRight=n.extendRight),void 0!==n.id&&(s.id=n.id),s})),Histogram:nr(tr),Line:nr(tr)};function hr(t){return sr[t]}function rr(t){return 60*t*60*1e3}function er(t){return 60*t*1e3}var ur,or=[{Gv:(ur=1,1e3*ur),Do:10},{Gv:er(1),Do:20},{Gv:er(5),Do:21},{Gv:er(30),Do:22},{Gv:rr(1),Do:30},{Gv:rr(3),Do:31},{Gv:rr(6),Do:32},{Gv:rr(12),Do:33}];function lr(t,i){if(t.getUTCFullYear()!==i.getUTCFullYear())return 70;if(t.getUTCMonth()!==i.getUTCMonth())return 60;if(t.getUTCDate()!==i.getUTCDate())return 50;for(var n=or.length-1;n>=0;--n)if(Math.floor(i.getTime()/or[n].Gv)!==Math.floor(t.getTime()/or[n].Gv))return or[n].Do;return 0}function ar(t,i){if(void 0===i&&(i=0),0!==t.length){for(var n=0===i?null:t[i-1].time.timestamp,s=null!==n?new Date(1e3*n):null,h=0,r=i;r<t.length;++r){var e=t[r],u=new Date(1e3*e.time.timestamp);null!==s&&(e.timeWeight=lr(u,s)),h+=e.time.timestamp-(n||e.time.timestamp),n=e.time.timestamp,s=u}if(0===i&&t.length>1){var o=Math.ceil(h/(t.length-1)),l=new Date(1e3*(t[0].time.timestamp-o));t[0].timeWeight=lr(new Date(1e3*t[0].time.timestamp),l)}}}function fr(t){if(!mh(t))throw new Error("time must be of type BusinessDay");var i=new Date(Date.UTC(t.year,t.month-1,t.day,0,0,0,0));return{timestamp:Math.round(i.getTime()/1e3),businessDay:t}}function cr(t){if(!ph(t))throw new Error("time must be of type isUTCTimestamp");return{timestamp:t}}function vr(t){return 0===t.length?null:mh(t[0].time)?fr:cr}function dr(t){return ph(t)?cr(t):mh(t)?fr(t):fr(_r(t))}function _r(t){var i=new Date(t);if(isNaN(i.getTime()))throw new Error("Invalid date string=".concat(t,", expected format=yyyy-mm-dd"));return{day:i.getUTCDate(),month:i.getUTCMonth()+1,year:i.getUTCFullYear()}}function wr(t){J(t.time)&&(t.time=_r(t.time))}function Mr(t){return{Bo:0,Qv:new Map,td:t}}function br(t){if(void 0!==t&&0!==t.length)return{nd:t[0].time.timestamp,sd:t[t.length-1].time.timestamp}}var mr=function(){function t(){this.hd=new Map,this.rd=new Map,this.ed=new Map,this.ud=[]}return t.prototype.od=function(){this.hd.clear(),this.rd.clear(),this.ed.clear(),this.ud=[]},t.prototype.ld=function(t,i){var n=this,s=0!==this.hd.size,h=!1,r=this.rd.get(t);if(void 0!==r)if(1===this.rd.size)s=!1,h=!0,this.hd.clear();else for(var e=0,u=this.ud;e<u.length;e++){u[e].pointData.Qv.delete(t)&&(h=!0)}var o=[];if(0!==i.length){!function(t){t.forEach(wr)}(i);var l=E(vr(i)),a=hr(t.seriesType());o=i.map((function(i){var s=l(i.time),r=n.hd.get(s.timestamp);void 0===r&&(r=Mr(s),n.hd.set(s.timestamp,r),h=!0);var e=a(s,r.Bo,i);return r.Qv.set(t,e),e}))}s&&this.ad(),this.fd(t,o);var f=-1;if(h){var c=[];this.hd.forEach((function(t){c.push({timeWeight:0,time:t.td,pointData:t})})),c.sort((function(t,i){return t.time.timestamp-i.time.timestamp})),f=this.vd(c)}return this.dd(t,f,function(t,i){var n=br(t),s=br(i);if(void 0!==n&&void 0!==s)return{lastBarUpdatedOrNewBarsAddedToTheRight:n.sd>=s.sd&&n.nd>=s.nd}}(this.rd.get(t),r))},t.prototype._d=function(t){return this.ld(t,[])},t.prototype.wd=function(t,i){wr(i);var n=E(vr([i]))(i.time),s=this.ed.get(t);if(void 0!==s&&n.timestamp<s.timestamp)throw new Error("Cannot update oldest data, last time=".concat(s.timestamp,", new time=").concat(n.timestamp));var h=this.hd.get(n.timestamp),r=void 0===h;void 0===h&&(h=Mr(n),this.hd.set(n.timestamp,h));var e=hr(t.seriesType())(n,h.Bo,i);h.Qv.set(t,e),this.Md(t,e);var u={lastBarUpdatedOrNewBarsAddedToTheRight:ir(e)};if(!r)return this.dd(t,-1,u);var o={timeWeight:0,time:h.td,pointData:h},l=jn(this.ud,o.time.timestamp,(function(t,i){return t.time.timestamp<i}));this.ud.splice(l,0,o);for(var a=l;a<this.ud.length;++a)pr(this.ud[a].pointData,a);return ar(this.ud,l),this.dd(t,l,u)},t.prototype.Md=function(t,i){var n=this.rd.get(t);void 0===n&&(n=[],this.rd.set(t,n));var s=0!==n.length?n[n.length-1]:null;null===s||i.time.timestamp>s.time.timestamp?ir(i)&&n.push(i):ir(i)?n[n.length-1]=i:n.splice(-1,1),this.ed.set(t,i.time)},t.prototype.fd=function(t,i){0!==i.length?(this.rd.set(t,i.filter(ir)),this.ed.set(t,i[i.length-1].time)):(this.rd.delete(t),this.ed.delete(t))},t.prototype.ad=function(){for(var t=0,i=this.ud;t<i.length;t++){var n=i[t];0===n.pointData.Qv.size&&this.hd.delete(n.time.timestamp)}},t.prototype.vd=function(t){for(var i=-1,n=0;n<this.ud.length&&n<t.length;++n){var s=this.ud[n],h=t[n];if(s.time.timestamp!==h.time.timestamp){i=n;break}h.timeWeight=s.timeWeight,pr(h.pointData,n)}if(-1===i&&this.ud.length!==t.length&&(i=Math.min(this.ud.length,t.length)),-1===i)return-1;for(n=i;n<t.length;++n)pr(t[n].pointData,n);return ar(t,i),this.ud=t,i},t.prototype.bd=function(){if(0===this.rd.size)return null;var t=0;return this.rd.forEach((function(i){0!==i.length&&(t=Math.max(t,i[i.length-1].index))})),t},t.prototype.dd=function(t,i,n){var s={md:new Map,pd:{gd:this.bd()}};if(-1!==i)this.rd.forEach((function(i,h){s.md.set(h,{js:i,yd:h===t?n:void 0})})),this.rd.has(t)||s.md.set(t,{js:[],yd:n}),s.pd.Vi=this.ud,s.pd.kd=i;else{var h=this.rd.get(t);s.md.set(t,{js:h||[],yd:n})}return s},t}();function pr(t,i){t.Bo=i,t.Qv.forEach((function(t){t.index=i}))}var gr={color:"#FF0000",price:0,visible:!0,lineStyle:2,lineWidth:1,lineVisible:!0,axisLabelVisible:!0,title:""},yr=function(){function t(t){this._u=t}return t.prototype.applyOptions=function(t){this._u.applyOptions(t)},t.prototype.options=function(){return this._u.options()},t.prototype.xd=function(){return this._u},t}();function kr(t){var i=t.overlay,n=function(t,i){var n={};for(var s in t)Object.prototype.hasOwnProperty.call(t,s)&&i.indexOf(s)<0&&(n[s]=t[s]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var h=0;for(s=Object.getOwnPropertySymbols(t);h<s.length;h++)i.indexOf(s[h])<0&&Object.prototype.propertyIsEnumerable.call(t,s[h])&&(n[s[h]]=t[s[h]])}return n}(t,["overlay"]);return i&&(n.priceScaleId=""),n}var xr=function(){function t(t,i,n){this._series=t,this._dataUpdatesConsumer=i,this.Cd=n}return t.prototype.priceFormatter=function(){return this._series.formatter()},t.prototype.priceToCoordinate=function(t){var i=this._series.firstValue();return null===i?null:this._series.priceScale().priceToCoordinate(t,i.value)},t.prototype.coordinateToPrice=function(t){var i=this._series.firstValue();return null===i?null:this._series.priceScale().coordinateToPrice(t,i.value)},t.prototype.barsInLogicalRange=function(t){if(null===t)return null;var i=new rh(new th(t.from,t.to)).zo(),n=this._series.bars();if(n.isEmpty())return null;var s=n.search(i.left(),1),h=n.search(i.right(),-1),r=E(n.firstIndex()),e=E(n.lastIndex());if(null!==s&&null!==h&&s.index>h.index)return{barsBefore:t.from-r,barsAfter:e-t.to};var u={barsBefore:null===s||s.index===r?t.from-r:s.index-r,barsAfter:null===h||h.index===e?e-t.to:e-h.index};return null!==s&&null!==h&&(u.from=s.time.businessDay||s.time.timestamp,u.to=h.time.businessDay||h.time.timestamp),u},t.prototype.setData=function(t){this._series.seriesType(),this._dataUpdatesConsumer.applyNewData(this._series,t)},t.prototype.update=function(t){this._series.seriesType(),this._dataUpdatesConsumer.updateData(this._series,t)},t.prototype.setMarkers=function(t){var i=t.map((function(t){return q(q({},t),{time:dr(t.time)})}));this._series.setMarkers(i)},t.prototype.applyOptions=function(t){var i=kr(t);this._series.applyOptions(i)},t.prototype.options=function(){return Q(this._series.options())},t.prototype.priceScale=function(){return this.Cd.priceScale(this._series.priceScale().id())},t.prototype.createPriceLine=function(t){var i=K(Q(gr),t),n=this._series.createPriceLine(i);return new yr(n)},t.prototype.removePriceLine=function(t){this._series.removePriceLine(t.xd())},t.prototype.removeAllPriceLines=function(){this._series.removeAllPriceLines()},t.prototype.getPriceLine=function(t,i){var n=this._series.getPriceLine(t,i);if(n)return new yr(n)},t.prototype.seriesType=function(){return this._series.seriesType()},t.prototype.setExtensionsBoundaries=function(t){return this._series.setExtensionsBoundaries(t)},t}(),Cr=function(t){function i(){return null!==t&&t.apply(this,arguments)||this}return U(i,t),i.prototype.applyOptions=function(i){bh(i),t.prototype.applyOptions.call(this,i)},i}(xr),Nr=function(){function t(t){this.Nd=t}return t.prototype.setPoints=function(t){throw new Error("Method not implemented.")},t.prototype.applyOptions=function(t){this.Nd.applyOptions(t)},t.prototype.options=function(){return Q(this.Nd.options())},t.prototype.toolType=function(){return this.Nd.toolType()},t}(),Sr={autoScale:!0,mode:0,invertScale:!1,alignLabels:!0,borderVisible:!0,borderColor:"#2B2B43",entireTextOnly:!1,visible:!1,floating:!1,drawTicks:!1,scaleMargins:{bottom:.1,top:.2}},Tr={color:"rgba(0, 0, 0, 0)",visible:!1,fontSize:48,fontFamily:nt,fontStyle:"",text:"",horzAlign:"center",vertAlign:"center"},Ar={width:0,height:0,layout:{background:{type:"solid",color:"#FFFFFF"},textColor:"#191919",fontSize:11,fontFamily:nt},crosshair:{vertLine:{color:"#758696",width:1,style:3,visible:!0,labelVisible:!0,labelBackgroundColor:"#4c525e"},horzLine:{color:"#758696",width:1,style:3,visible:!0,labelVisible:!0,labelBackgroundColor:"#4c525e"},magnetThreshold:14},grid:{vertLines:{color:"#D6DCDE",style:0,visible:!0},horzLines:{color:"#D6DCDE",style:0,visible:!0}},overlayPriceScales:q({},Sr),leftPriceScale:q(q({},Sr),{visible:!1}),rightPriceScale:q(q({},Sr),{visible:!0}),nonPrimaryPriceScale:q(q({},Sr),{visible:!0}),timeScale:{rightOffset:0,barSpacing:6,minBarSpacing:.5,fixLeftEdge:!1,fixRightEdge:!1,lockVisibleTimeRangeOnResize:!1,rightBarStaysOnScroll:!1,borderVisible:!0,borderColor:"#2B2B43",mode:0,visible:!0,timeVisible:!1,secondsVisible:!0,shiftVisibleRangeOnNewBar:!0},watermark:Tr,localization:{locale:Nh?navigator.language:"",dateFormat:"dd MMM 'yy"},handleScroll:{mouseWheel:!0,pressedMouseMove:!0,horzTouchDrag:!0,vertTouchDrag:!0},handleScale:{axisPressedMouseMove:{time:!0,price:!0},axisDoubleClickReset:!0,mouseWheel:!0,pinch:!0},kineticScroll:{mouse:!1,touch:!0},trackingMode:{exitMode:1}},Lr={upColor:"#26a69a",downColor:"#ef5350",wickVisible:!0,borderVisible:!0,borderColor:"#378658",borderUpColor:"#26a69a",borderDownColor:"#ef5350",wickColor:"#737375",wickUpColor:"#26a69a",wickDownColor:"#ef5350"},Er={upColor:"#26a69a",downColor:"#ef5350",openVisible:!0,thinBars:!0},Br={color:"#2196f3",lineStyle:0,lineWidth:3,lineType:0,crosshairMarkerVisible:!0,crosshairMarkerRadius:4,crosshairMarkerBorderColor:"",crosshairMarkerBackgroundColor:"",lastPriceAnimation:0},Dr={topColor:"rgba( 46, 220, 135, 0.4)",bottomColor:"rgba( 40, 221, 100, 0)",lineColor:"#33D778",lineStyle:0,lineWidth:3,lineType:0,crosshairMarkerVisible:!0,crosshairMarkerRadius:4,crosshairMarkerBorderColor:"",crosshairMarkerBackgroundColor:"",lastPriceAnimation:0},Fr={positiveColor:"rgba( 76, 175, 80, 0.1)",negativeColor:"rgba( 255, 82, 82, 0.1)",higherLineColor:"#4CAF50",higherLineStyle:0,higherLineWidth:3,higherLineType:0,lowerLineColor:"#FF5252",lowerLineStyle:0,lowerLineWidth:3,lowerLineType:0,crosshairMarkerVisible:!0,crosshairMarkerRadius:4,crosshairMarkerBorderColor:"",crosshairMarkerBackgroundColor:""},Pr={baseValue:{type:"price",price:0},topFillColor1:"rgba(38, 166, 154, 0.28)",topFillColor2:"rgba(38, 166, 154, 0.05)",topLineColor:"rgba(38, 166, 154, 1)",bottomFillColor1:"rgba(239, 83, 80, 0.05)",bottomFillColor2:"rgba(239, 83, 80, 0.28)",bottomLineColor:"rgba(239, 83, 80, 1)",lineWidth:3,lineStyle:0,lineType:0,crosshairMarkerVisible:!0,crosshairMarkerRadius:4,crosshairMarkerBorderColor:"",crosshairMarkerBackgroundColor:"",lastPriceAnimation:0},Wr={color:"#26a69a",base:0},Rr={title:"",visible:!0,lastValueVisible:!0,priceLineVisible:!0,priceLineSource:0,priceLineWidth:1,priceLineColor:"",priceLineStyle:1,baseLineVisible:!0,baseLineWidth:1,baseLineColor:"#B2B5BE",baseLineStyle:0,priceFormat:{type:"price",precision:2,minMove:.01}},zr=function(){function t(t,i){this.mf=t,this.Sd=i}return t.prototype.applyOptions=function(t){this.mf.model().applyPriceScaleOptions(this.Sd,t)},t.prototype.options=function(){return this._priceScale().options()},t.prototype.width=function(){return Lt(this.Sd)?this.mf.getPriceAxisWidth("left"===this.Sd?"left":"right"):0},t.prototype._priceScale=function(){return E(this.mf.model().findPriceScale(this.Sd)).priceScale},t}(),Or=function(){function t(t,i){this.Td=new $,this.Zo=new $,this.Mv=new $,this.Mi=t,this.Bs=t.timeScale(),this.Ov=i,this.Bs.visibleBarsChanged().subscribe(this.Ad.bind(this)),this.Bs.logicalRangeChanged().subscribe(this.Ld.bind(this)),this.Ov.sizeChanged().subscribe(this.Ed.bind(this))}return t.prototype.destroy=function(){this.Bs.visibleBarsChanged().unsubscribeAll(this),this.Bs.logicalRangeChanged().unsubscribeAll(this),this.Ov.sizeChanged().unsubscribeAll(this),this.Td.destroy(),this.Zo.destroy(),this.Mv.destroy()},t.prototype.scrollPosition=function(){return this.Bs.rightOffset()},t.prototype.scrollToPosition=function(t,i){i?this.Bs.scrollToOffsetAnimated(t,1e3):this.Mi.setRightOffset(t)},t.prototype.scrollToRealTime=function(){this.Bs.scrollToRealTime()},t.prototype.getVisibleRange=function(){var t,i,n=this.Bs.visibleTimeRange();return null===n?null:{from:null!==(t=n.from.businessDay)&&void 0!==t?t:n.from.timestamp,to:null!==(i=n.to.businessDay)&&void 0!==i?i:n.to.timestamp}},t.prototype.setVisibleRange=function(t){var i={from:dr(t.from),to:dr(t.to)},n=this.Bs.logicalRangeForTimeRange(i);this.Mi.setTargetLogicalRange(n)},t.prototype.getVisibleLogicalRange=function(){var t=this.Bs.visibleLogicalRange();return null===t?null:{from:t.left(),to:t.right()}},t.prototype.setVisibleLogicalRange=function(t){A(t.from<=t.to,"The from index cannot be after the to index."),this.Mi.setTargetLogicalRange(t)},t.prototype.resetTimeScale=function(){this.Mi.resetTimeScale()},t.prototype.fitContent=function(){this.Mi.fitContent()},t.prototype.logicalToCoordinate=function(t){var i=this.Mi.timeScale();return i.isEmpty()?null:i.indexToCoordinate(t)},t.prototype.coordinateToLogical=function(t){return this.Bs.isEmpty()?null:this.Bs.coordinateToIndex(t)},t.prototype.timeToCoordinate=function(t){var i=dr(t),n=this.Bs.timeToIndex(i,!1);return null===n?null:this.Bs.indexToCoordinate(n)},t.prototype.coordinateToTime=function(t){var i,n=this.Mi.timeScale(),s=n.coordinateToIndex(t),h=n.indexToTime(s);return null===h?null:null!==(i=h.businessDay)&&void 0!==i?i:h.timestamp},t.prototype.width=function(){return this.Ov.getSize().w},t.prototype.height=function(){return this.Ov.getSize().h},t.prototype.subscribeVisibleTimeRangeChange=function(t){this.Td.subscribe(t)},t.prototype.unsubscribeVisibleTimeRangeChange=function(t){this.Td.unsubscribe(t)},t.prototype.subscribeVisibleLogicalRangeChange=function(t){this.Zo.subscribe(t)},t.prototype.unsubscribeVisibleLogicalRangeChange=function(t){this.Zo.unsubscribe(t)},t.prototype.subscribeSizeChange=function(t){this.Mv.subscribe(t)},t.prototype.unsubscribeSizeChange=function(t){this.Mv.unsubscribe(t)},t.prototype.applyOptions=function(t){this.Bs.applyOptions(t)},t.prototype.options=function(){return Q(this.Bs.options())},t.prototype.Ad=function(){this.Td.hasListeners()&&this.Td.fire(this.getVisibleRange())},t.prototype.Ld=function(){this.Zo.hasListeners()&&this.Zo.fire(this.getVisibleLogicalRange())},t.prototype.Ed=function(t){this.Mv.fire(t.w,t.h)},t}();function Vr(t){if(void 0!==t&&"custom"!==t.type){var i=t;void 0!==i.minMove&&void 0===i.precision&&(i.precision=function(t){if(t>=1)return 0;for(var i=0;i<8;i++){var n=Math.round(t);if(Math.abs(n-t)<1e-8)return i;t*=10}return i}(i.minMove))}}function Ir(t){return function(t){if(G(t.handleScale)){var i=t.handleScale;t.handleScale={axisDoubleClickReset:i,axisPressedMouseMove:{time:i,price:i},mouseWheel:i,pinch:i}}else if(void 0!==t.handleScale&&G(t.handleScale.axisPressedMouseMove)){var n=t.handleScale.axisPressedMouseMove;t.handleScale.axisPressedMouseMove={time:n,price:n}}var s=t.handleScroll;G(s)&&(t.handleScroll={horzTouchDrag:s,vertTouchDrag:s,mouseWheel:s,pressedMouseMove:s})}(t),function(t){if(t.priceScale){t.leftPriceScale=t.leftPriceScale||{},t.rightPriceScale=t.rightPriceScale||{};var i=t.priceScale.position;delete t.priceScale.position,t.leftPriceScale=K(t.leftPriceScale,t.priceScale),t.rightPriceScale=K(t.rightPriceScale,t.priceScale),"left"===i&&(t.leftPriceScale.visible=!0,t.rightPriceScale.visible=!1),"right"===i&&(t.leftPriceScale.visible=!1,t.rightPriceScale.visible=!0),"none"===i&&(t.leftPriceScale.visible=!1,t.rightPriceScale.visible=!1),t.overlayPriceScales=t.overlayPriceScales||{},void 0!==t.priceScale.invertScale&&(t.overlayPriceScales.invertScale=t.priceScale.invertScale),void 0!==t.priceScale.scaleMargins&&(t.overlayPriceScales.scaleMargins=t.priceScale.scaleMargins)}}(t),function(t){t.layout&&t.layout.backgroundColor&&!t.layout.background&&(t.layout.background={type:"solid",color:t.layout.backgroundColor})}(t),t}var Hr=function(){function t(t,i){var n=this;this.Bd=new mr,this.Dd=new Map,this.Fd=new Map,this.Pd=new $,this.Wd=new $;var s=void 0===i?Q(Ar):K(Q(Ar),Ir(i));this._chartWidget=new Gh(t,s),this._chartWidget.clicked().subscribe((function(t){n.Pd.hasListeners()&&n.Pd.fire(n.Rd(t()))}),this),this._chartWidget.crosshairMoved().subscribe((function(t){n.Wd.hasListeners()&&n.Wd.fire(n.Rd(t()))}),this);var h=this._chartWidget.model();this.zd=new Or(h,this._chartWidget.timeAxisWidget())}return t.prototype.get=function(){return this},t.prototype.remove=function(){this._chartWidget.clicked().unsubscribeAll(this),this._chartWidget.crosshairMoved().unsubscribeAll(this),this.zd.destroy(),this._chartWidget.destroy(),this.Dd.clear(),this.Fd.clear(),this.Pd.destroy(),this.Wd.destroy(),this.Bd.od()},t.prototype.resize=function(t,i,n){this._chartWidget.resize(t,i,n)},t.prototype.addAreaSeries=function(t){void 0===t&&(t={}),Vr((t=kr(t)).priceFormat);var i=K(Q(Rr),Dr,t),n=this._chartWidget.model().createSeries("Area",i),s=new xr(n,this,this);return this.Dd.set(s,n),this.Fd.set(n,s),s},t.prototype.addBaselineSeries=function(t){void 0===t&&(t={}),Vr((t=kr(t)).priceFormat);var i=K(Q(Rr),Q(Pr),t),n=this._chartWidget.model().createSeries("Baseline",i),s=new xr(n,this,this);return this.Dd.set(s,n),this.Fd.set(n,s),s},t.prototype.addCloudAreaSeries=function(t){void 0===t&&(t={}),Vr((t=kr(t)).priceFormat);var i=K(Q(Rr),Fr,t),n=this._chartWidget.model().createSeries("CloudArea",i),s=new xr(n,this,this);return this.Dd.set(s,n),this.Fd.set(n,s),s},t.prototype.addBrokenAreaSeries=function(t){void 0===t&&(t={}),t=kr(t);var i=K(Q(Rr),t),n=this._chartWidget.model().createSeries("BrokenArea",i),s=new xr(n,this,this);return this.Dd.set(s,n),this.Fd.set(n,s),s},t.prototype.addBarSeries=function(t){void 0===t&&(t={}),Vr((t=kr(t)).priceFormat);var i=K(Q(Rr),Er,t),n=this._chartWidget.model().createSeries("Bar",i),s=new xr(n,this,this);return this.Dd.set(s,n),this.Fd.set(n,s),s},t.prototype.addCandlestickSeries=function(t){void 0===t&&(t={}),bh(t=kr(t)),Vr(t.priceFormat);var i=K(Q(Rr),Lr,t),n=this._chartWidget.model().createSeries("Candlestick",i),s=new Cr(n,this,this);return this.Dd.set(s,n),this.Fd.set(n,s),s},t.prototype.addHistogramSeries=function(t){void 0===t&&(t={}),Vr((t=kr(t)).priceFormat);var i=K(Q(Rr),Wr,t),n=this._chartWidget.model().createSeries("Histogram",i),s=new xr(n,this,this);return this.Dd.set(s,n),this.Fd.set(n,s),s},t.prototype.addLineSeries=function(t){void 0===t&&(t={}),Vr((t=kr(t)).priceFormat);var i=K(Q(Rr),Br,t),n=this._chartWidget.model().createSeries("Line",i),s=new xr(n,this,this);return this.Dd.set(s,n),this.Fd.set(n,s),s},t.prototype.removeSeries=function(t){var i=L(this.Dd.get(t)),n=this.Bd._d(i);this._chartWidget.model().removeSeries(i),this.Od(n),this.Dd.delete(t),this.Fd.delete(i)},t.prototype.addLineTool=function(t,i,n){var s=K(Q(It[t]),n||{}),h=this._chartWidget.model().createLineTool(t,s,i);return new Nr(h)},t.prototype.setActiveLineTool=function(t,i){this._chartWidget.model().lineToolCreator().setActiveLineTool(t,i)},t.prototype.applyNewData=function(t,i){this.Od(this.Bd.ld(t,i))},t.prototype.updateData=function(t,i){this.Od(this.Bd.wd(t,i))},t.prototype.subscribeClick=function(t){this.Pd.subscribe(t)},t.prototype.unsubscribeClick=function(t){this.Pd.unsubscribe(t)},t.prototype.subscribeCrosshairMove=function(t){this.Wd.subscribe(t)},t.prototype.unsubscribeCrosshairMove=function(t){this.Wd.unsubscribe(t)},t.prototype.clearCrosshairPosition=function(){this._chartWidget.model().clearCurrentPosition()},t.prototype.priceScale=function(t){return void 0===t&&(t=this._chartWidget.model().defaultVisiblePriceScaleId()),new zr(this._chartWidget,t)},t.prototype.timeScale=function(){return this.zd},t.prototype.applyOptions=function(t){this._chartWidget.applyOptions(Ir(t))},t.prototype.options=function(){return this._chartWidget.options()},t.prototype.takeScreenshot=function(){return this._chartWidget.takeScreenshot()},t.prototype.fullUpdate=function(){return this._chartWidget.model().fullUpdate()},t.prototype.removePane=function(t){this._chartWidget.model().removePane(t)},t.prototype.swapPane=function(t,i){this._chartWidget.model().swapPane(t,i)},t.prototype.getPaneElements=function(){return this._chartWidget.paneWidgets().map((function(t){return t.getPaneCell()}))},t.prototype.Od=function(t){var i=this._chartWidget.model();i.updateTimeScale(t.pd.gd,t.pd.Vi,t.pd.kd),t.md.forEach((function(t,i){return i.setData(t.js,t.yd)})),i.recalculateAllPanes()},t.prototype.Vd=function(t){return L(this.Fd.get(t))},t.prototype.Rd=function(t){var i=this,n=new Map;t.seriesPrices.forEach((function(t,s){n.set(i.Vd(s),t)}));var s=void 0===t.hoveredSeries?void 0:this.Vd(t.hoveredSeries);return{time:t.time&&(t.time.businessDay||t.time.timestamp),point:t.point,paneIndex:t.paneIndex,hoveredSeries:s,hoveredMarkerId:t.hoveredObject,seriesPrices:n}},t}();function jr(t,i){var n;if(J(t)){var s=document.getElementById(t);A(null!==s,"Cannot find element in DOM with id=".concat(t)),n=s}else n=t;return new Hr(n,i)}function Ur(){return"3.8.0-dev+202211041912"}export{dh as BoxHorizontalAlignment,vh as BoxVerticalAlignment,wh as ColorType,St as CrosshairMode,fh as LasPriceAnimationMode,fh as LastPriceAnimationMode,n as LineEnd,s as LineStyle,i as LineType,ch as PriceLineSource,Vi as PriceScaleMode,_h as TextAlignment,nh as TickMarkType,sh as TimeScaleMode,uh as TrackingModeExitMode,jr as createChart,mh as isBusinessDay,ph as isUTCTimestamp,Ur as version};
